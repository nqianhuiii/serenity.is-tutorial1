var sa=Object.defineProperty;var na=Object.getOwnPropertyDescriptor;var h=(c,n,e,t)=>{for(var i=t>1?void 0:t?na(n,e):n,r=c.length-1,a;r>=0;r--)(a=c[r])&&(i=(t?a(n,e,i):a(i))||i);return t&&i&&sa(n,e,i),i};var _e=(c,n,e)=>new Promise((t,i)=>{var r=l=>{try{o(e.next(l))}catch(d){i(d)}},a=l=>{try{o(e.throw(l))}catch(d){i(d)}},o=l=>l.done?t(l.value):Promise.resolve(l.value).then(r,a);o((e=e.apply(c,n)).next())});import{ColumnSelection as GC,RetrieveColumnSelection as AC,SummaryType as qC,Criteria as WC}from"@serenity-is/corelib/q";import{addAttribute as M,addTypeMember as aa,MemberType as _s,ISlickFormatter as Ds,registerClass as Pi,registerEditor as Ps,registerInterface as Fs,registerEnum as oa,startsWith as Es,EditorAttribute as la}from"@serenity-is/corelib/q";function D(c){return function(n){return Pi(n,"Serenity."+c+"Attribute")}}var z=class{constructor(n){this.value=n}};z=h([D("EnumKey")],z);var De=class{constructor(n){this.displayName=n}};De=h([D("DisplayName")],De);var gi=class{constructor(n){this.category=n}};gi=h([D("Category")],gi);var kt=class{constructor(n){this.value=n}};kt=h([D("ColumnsKey")],kt);var fi=class{constructor(n){this.cssClass=n}};fi=h([D("CssClass")],fi);var yi=class{constructor(n){this.value=n}};yi=h([D("DefaultValue")],yi);var st=class{constructor(n){this.value=n}};st=h([D("DialogType")],st);var vi=class{constructor(n,e){this.key=n;this.value=e}};vi=h([D("EditorOption")],vi);var Fi=class{constructor(n){this.editorType=n}setParams(n){}};Pi(Fi,"Serenity.EditorTypeAttributeBase");var bi=class extends Fi{constructor(n){super(n)}};bi=h([D("EditorType")],bi);var nt=class{constructor(n){this.value=n}};nt=h([D("Element")],nt);var qe=class{constructor(n){this.value=n}};qe=h([D("EntityType")],qe);var at=class{constructor(n=!0){this.value=n}};at=h([D("Filterable")],at);var ot=class{constructor(n=!0){this.value=n}};ot=h([D("Flexify")],ot);var fe=class{constructor(n){this.value=n}};fe=h([D("FormKey")],fe);var Ci=class{constructor(n){this.origin=n}};Ci=h([D("GeneratedCode")],Ci);var xi=class{constructor(){}};xi=h([D("Hidden")],xi);var Ii=class{constructor(n){this.hint=n}};Ii=h([D("Hint")],Ii);var We=class{constructor(n){this.value=n}};We=h([D("IdProperty")],We);var Si=class{constructor(n=!0){this.value=n}};Si=h([D("Insertable")],Si);var Je=class{constructor(n){this.value=n}};Je=h([D("IsActiveProperty")],Je);var Pe=class{constructor(n){this.value=n}};Pe=h([D("ItemName")],Pe);var Me=class{constructor(n){this.value=n}};Me=h([D("LocalTextPrefix")],Me);var lt=class{constructor(n=!0){this.value=n}};lt=h([D("Maximizable")],lt);var Ti=class{constructor(n){this.maxLength=n}};Ti=h([D("MaxLength")],Ti);var Ot=class{constructor(n){this.value=n}};Ot=h([D("NameProperty")],Ot);var ki=class{};ki=h([D("OneWay")],ki);var $e=class{};$e=h([D("Option")],$e);var dt=class{constructor(n){this.value=n}};dt=h([D("OptionsType")],dt);var ut=class{constructor(n=!0){this.value=n}};ut=h([D("Panel")],ut);var Oi=class{constructor(n){this.value=n}};Oi=h([D("Placeholder")],Oi);var wi=class{constructor(n=!0){this.value=n}};wi=h([D("ReadOnly")],wi);var _i=class{constructor(n=!0){this.isRequired=n}};_i=h([D("Required")],_i);var pt=class{constructor(n=!0){this.value=n}};pt=h([D("Resizable")],pt);var ct=class{constructor(n=!0){this.value=n}};ct=h([D("Responsive")],ct);var Fe=class{constructor(n){this.value=n}};Fe=h([D("Service")],Fe);var Di=class{constructor(n=!0){this.value=n}};Di=h([D("Updatable")],Di);var m;(_=>{function c(x,I){return function(E){typeof x=="string"?Pi(E,x,I):Pi(E,null,x)}}_.registerClass=c;function n(x,I){return function(E){typeof x=="string"?Fs(E,x,I):Fs(E,null,x)}}_.registerInterface=n;function e(x,I){return function(E){typeof x=="string"?Ps(E,x,I):Ps(E,null,x)}}_.registerEditor=e;function t(x,I,E){oa(x,E,I),I&&M(x,new z(I))}_.registerEnum=t;function i(x,I,E){t(x,E!=null?E:I,I)}_.registerEnumType=i;function r(x=[Ds],I=[Ds]){return c(x,I)}_.registerFormatter=r;function a(x){return function(I){M(I,new z(x))}}_.enumKey=a;function o(){return function(x,I){var E=Es(I,"get_")||Es(I,"set_"),j=E?I.substr(4):I;aa(x.constructor,{name:j,attr:[new $e],type:E?_s.property:_s.field,getter:E?"get_"+j:null,setter:E?"set_"+j:null})}}_.option=o;function l(x){return function(I){M(I,new st(x))}}_.dialogType=l;function d(){return function(x){var I=new la;M(x,I)}}_.editor=d;function p(x){return function(I){M(I,new nt(x))}}_.element=p;function u(x=!0){return function(I){M(I,new at(x))}}_.filterable=u;function g(x=!0){return function(I){M(I,new ot(x))}}_.flexify=g;function v(x){return function(I){M(I,new Pe(x))}}_.itemName=v;function f(x=!0){return function(I){M(I,new lt(x))}}_.maximizable=f;function y(x){return function(I){M(I,new dt(x))}}_.optionsType=y;function C(x=!0){return function(I){M(I,new ut(x))}}_.panel=C;function S(x=!0){return function(I){M(I,new pt(x))}}_.resizable=S;function O(x=!0){return function(I){M(I,new ct(x))}}_.responsive=O;function T(x){return function(I){M(I,new Fe(x))}}_.service=T})(m||(m={}));var Ee=class{};Ee=h([m.registerInterface("Serenity.IBooleanValue")],Ee);var Y=class{};Y=h([m.registerInterface("Serenity.IDoubleValue")],Y);var ye=class{};ye=h([m.registerInterface("Serenity.IDialog")],ye);var Re=class{};Re=h([m.registerInterface("Serenity.IEditDialog")],Re);var X=class{};X=h([m.registerInterface("Serenity.IGetEditValue")],X);var R=class{};R=h([m.registerInterface("Serenity.IReadOnly")],R);var Z=class{};Z=h([m.registerInterface("Serenity.ISetEditValue")],Z);var P=class{};P=h([m.registerInterface("Serenity.IStringValue")],P);var Ve=class{};Ve=h([m.registerInterface("Serenity.IValidateRequired")],Ve);import{registerEnum as da}from"@serenity-is/corelib/q";var Rs=(i=>(i[i.Before=0]="Before",i[i.Delete=1]="Delete",i[i.Insert=2]="Insert",i[i.Update=3]="Update",i))(Rs||{});da(Rs,"Serenity.CaptureOperationType");import{isEmptyOrNull as ua}from"@serenity-is/corelib/q";var re;(t=>{function c(i,r){var a=i,o=a["get_"+r];if(typeof o!="undefined")return o.apply(i);var l=e(r);return o=a["get_"+l],typeof o!="undefined"?o.apply(i):a[l]}t.getPropertyValue=c;function n(i,r,a){var o=i,l=o["set_"+r];if(typeof l!="undefined"){l.apply(i,[a]);return}var d=e(r);if(l=o["set_"+d],typeof l!="undefined"){l.apply(i,[a]);return}o[d]=a}t.setPropertyValue=n;function e(i){if(ua(i))return i;if(i==="ID")return"id";for(var r=!1,a=0,o=0;o<i.length;o++)if(i.charCodeAt(o)>=65&&i.charCodeAt(o)<=90)a++;else{r=!0;break}return!r&&i.length!==1||a===0?i:a>1?i.substr(0,a-1).toLowerCase()+i.substr(a-1):i.length===1?i.toLowerCase():i.substr(0,1).toLowerCase()+i.substr(1)}t.makeCamelCase=e})(re||(re={}));import{ArgumentNullException as ga,Exception as fa,htmlEncode as ya,isAssignableFrom as va,isEmptyOrNull as ba,notifyError as Ca}from"@serenity-is/corelib/q";import{Config as pa,endsWith as ca,getType as Vs,getTypeNameProp as ha,getTypes as ma}from"@serenity-is/corelib/q";function ze(c,n,e){let t;function i(){t=null}function r(l){var d=Vs(l);if(d!=null&&c(d))return d;for(var p of pa.rootNamespaces){var u=p+"."+l;if(d=t[u],d||(d=Vs(p+"."+l),d!=null&&c(d)))return d}}function a(){t={};for(var l of ma())if(c(l)){var d=ha(l);t[d]=l;var p=n&&n(l);p&&p!==d&&(t[p]=l)}if(e){for(var u of Object.keys(t))if(u.endsWith(e)){var g=u.substring(0,u.length-e.length);g&&!t[g]&&(t[g]=t[u])}}}function o(l){var g;if(!l)return null;var d;t==null&&a();var d=t[l];if(d)return d;if(d=r(l),d==null&&e&&!ca(l,e)&&(d=(g=t[l+e])!=null?g:r(l+e)),d){t[l]=d;var p=n&&n(d);if(p&&l!=p&&(t[p]=d),e&&l.endsWith(e)){var u=l.substring(0,l.length-e.length);u&&!t[u]&&(t[u]=t[l])}return d}return d}return{reset:i,tryGet:o}}var ht;(i=>{let c=ze(r=>va(ye,r),null,"Dialog");function n(r){if(ba(r))throw new ga("key");var a=c.tryGet(r);if(a)return a;var o=`"${ya(r)}" dialog class not found! 
Make sure there is such a dialog type under the project root namespace, 
and its namespace parts start with capital letters like MyProject.MyModule.MyDialog.

If using ES modules, make sure the dialog type has a decorator like 
@Decorators.registerClass('MyProject.MyModule.MyDialog') with the full name
and "side-effect-import" this dialog class from the current 
"page.ts/grid.ts/dialog.ts file (import "./path/to/MyDialog.ts").

If you had this error from an editor with the InplaceAdd option, verify that the lookup key
and dialog type name match case-sensitively, excluding the Dialog suffix.
Specify the DialogType property in the LookupEditor attribute if it is not.

After applying fixes, build and run "node ./tsbuild.js" (or "tsc" if using namespaces) 
from the project folder.`;throw Ca(o.replace(/\r?\n\r?\n/g,"<br/><br/>"),"",{escapeHtml:!1,timeOut:5e3}),new fa(o)}i.get=n;function e(){c.reset()}i.reset=e;function t(r){return c.tryGet(r)}i.tryGet=t})(ht||(ht={}));import{ArgumentNullException as Da,EditorAttribute as Pa,Exception as Fa,getAttributes as Ea,htmlEncode as Ra,isAssignableFrom as Va,isEmptyOrNull as Qa,notifyError as Na}from"@serenity-is/corelib/q";function Qs(c){function n(){if(typeof c=="undefined"||!c.ui||!c.ui.dialog||!c.ui.dialog.prototype)return!1;c.ui.dialog.prototype._allowInteraction=function(e){return c(e.target).closest(".ui-dialog").length?!0:!!c(e.target).closest(".ui-datepicker, .select2-drop, .cke, .cke_dialog, .modal, #support-modal").length},function(e){c.ui.dialog.prototype._focusTabbable=function(){if(c(document.documentElement).hasClass("mobile-device")){this.uiDialog&&this.uiDialog.focus();return}e.call(this)}}(c.ui.dialog.prototype._focusTabbable),function(e){c.ui.dialog.prototype._createTitlebar=function(){e.call(this),this.uiDialogTitlebar.find(".ui-dialog-titlebar-close").html('<i class="fa fa-times" />')}}(c.ui.dialog.prototype._createTitlebar)}!n()&&typeof c!="undefined"&&c.fn&&c(n),typeof c!="undefined"&&c.fn&&(c.toJSON||(c.toJSON=JSON.stringify),c.parseJSON||(c.parseJSON=JSON.parse),c.cleanData=function(e){return function(t){var i,r,a,o,l=t;for(a=0;(r=l[a])!=null;a++)try{i=c._data(r,"events"),i&&i.remove&&(l===t&&(l=Array.prototype.slice.call(t)),c(r).triggerHandler("remove"),delete i.remove)}catch(d){}e(t)}}(c.cleanData))}import{addValidationRule as xa,ArgumentNullException as Ia,Config as Sa,Exception as Ur,format as jr,getAttributes as Ta,getInstanceType as Ri,getTypeFullName as Vi,getTypeShortName as ka,isAssignableFrom as Ei,notifyError as Oa,replaceAll as Ns,startsWith as wa}from"@serenity-is/corelib/q";function _a(){var n,e;let c=typeof global!="undefined"?global:typeof window!="undefined"?window:typeof self!="undefined"?self:null;typeof React=="undefined"&&typeof c!="undefined"&&(c.preact!=null?(c.React=c.ReactDOM=c.preact,React.Fragment=(n=React.Fragment)!=null?n:"x-fragment"):c.Nerv!=null?(c.React=c.ReactDOM=c.Nerv,React.Fragment=(e=React.Fragment)!=null?e:"x-fragment"):(c.React={Component:function(){},Fragment:"x-fragment",createElement:function(){return{_reactNotLoaded:!0}}},c.ReactDOM={render:function(){throw Error("To use React, it should be included before Serenity.CoreLib.js")}}))}_a();var b=class{constructor(n,e){if(this.element=n,this.options=e||{},this.widgetName=b.getWidgetName(Ri(this)),this.uniqueName=this.widgetName+(b.nextWidgetNumber++).toString(),n.data(this.widgetName))throw new Ur(jr("The element already has widget '{0}'!",this.widgetName));n.on("remove."+this.widgetName,t=>{t.bubbles||t.cancelable||this.destroy()}).data(this.widgetName,this),this.addCssClass(),this.idPrefix=this.uniqueName+"_",this.renderContents()}destroy(){this.element&&(this.element.removeClass(this.getCssClass()),this.element.off("."+this.widgetName).off("."+this.uniqueName).removeData(this.widgetName),this.element=null)}addCssClass(){this.element.addClass(this.getCssClass())}getCssClass(){var n=Ri(this),e=[],t=Ns(Vi(n),".","-");e.push(t);for(let i of Sa.rootNamespaces)if(wa(t,i+"-")){e.push(t.substr(i.length+1));break}return e.push(ka(n)),e.filter((i,r,a)=>a.indexOf(i)===r).map(i=>"s-"+i).join(" ")}static getWidgetName(n){return Ns(Vi(n),".","_")}static elementFor(n){var e=Ta(n,nt,!0),t=e.length>0?e[0].value:"<input/>";return $(t)}addValidationRule(n,e){return xa(this.element,n,e)}getGridField(){return this.element.closest(".field")}change(n){this.element.on("change."+this.uniqueName,n)}changeSelect2(n){this.element.on("change."+this.uniqueName,function(e,t){t!==!0&&n(e)})}static create(n){let e;if(Ei(ye,n.type))e=new n.type(n.options),n.container&&e.element.appendTo(n.container),n.element&&n.element(e.element);else{var t=b.elementFor(n.type);n.container&&t.appendTo(n.container),n.element&&n.element(t),e=new n.type(t,n.options)}return e.init(null),n.init&&n.init(e),e}initialize(){}init(n){return n&&n(this),this}renderContents(){}};b.nextWidgetNumber=0,b.__isWidgetType=!0,b=h([m.registerClass("Serenity.Widget")],b);typeof $!="undefined"&&$.fn&&($.fn.tryGetWidget=function(c){var n=this,e;if(Ei(b,c)){var t=b.getWidgetName(c);if(e=n.data(t),e!=null&&!Ei(c,Ri(e))&&(e=null),e!=null)return e}var i=n.data();if(i==null)return null;for(var r of Object.keys(i))if(e=i[r],e!=null&&Ei(c,Ri(e)))return e;return null},$.fn.getWidget=function(c){if(this==null)throw new Ia("element");if(this.length===0)throw new Ur(jr("Searching for widget of type '{0}' on a non-existent element! ({1})",Vi(c),this.selector));var n=this.tryGetWidget(c);if(n==null){var e=jr("Element has no widget of type '{0}'! If you have recently changed editor type of a property in a form class, or changed data type in row (which also changes editor type) your script side Form definition might be out of date. Make sure your project builds successfully and transform T4 templates",Vi(c));throw Oa(e,"",null),new Ur(e)}return n});typeof jQuery=="function"&&Qs(jQuery);var mt;(i=>{let c=ze(r=>!!Ea(r,Pa).length||Va(b,r),null,"Editor");function n(r){if(Qa(r))throw new Da("key");var a=c.tryGet(r);if(a)return a;var o=`"${Ra(r)}" editor class not found! 
Make sure there is such a editor type under the project root namespace,
and its namespace parts start with capital letters like MyProject.MyModule.MyEditor.

If using ES modules, make sure the editor type has a decorator like 
@Decorators.registerEditor('MyProject.MyModule.MyFormatter') with the full name 
and "side-effect-import" this editor class from the current 
"page.ts/grid.ts/dialog.ts file (import "./path/to/MyEditor.ts").

After applying fixes, build and run "node ./tsbuild.js" (or "tsc" if using namespaces) 
from the project folder.`;throw Na(o.replace(/\r?\n\r?\n/g,"<br/><br/>"),"",{escapeHtml:!1,timeOut:5e3}),new Fa(o)}i.get=n;function e(){c.reset()}i.reset=e;function t(r){return c.tryGet(r)}i.tryGet=t})(mt||(mt={}));import{Exception as Ba,getAttributes as La,htmlEncode as Ga,isEnum as Aa,notifyError as qa}from"@serenity-is/corelib/q";var He;(i=>{let c=ze(Aa,r=>{var a;return(a=La(r,z)[0])==null?void 0:a.value},null);function n(r){var a=c.tryGet(r);if(a)return a;var o=`Can't find "${Ga(r)}" enum type! 
If you have recently defined this enum type in server side code, make sure 
your project builds successfully and run "dotnet sergen t". 

Also verify there is such an enum type under the project root namespace, 
and its namespace parts start with capital letters like MyProject.MyModule.MyEnum.

If using ES modules, make sure the enum type is registered with 
Q.registerEnum('MyProject.MyModule.MyDialog') with the full name of 
your enum type and "side-effect-import" this enum from the current 
"page.ts/grid.ts/dialog.ts file (import "./path/to/MyEnum.ts").

After applying fixes, build and run "node ./tsbuild.js" (or "tsc" if using namespaces) 
from the project folder.`;throw qa(o.replace(/\r?\n\r?\n/g,"<br/><br/>"),"",{escapeHtml:!1,timeOut:5e3}),new Ba(o)}i.get=n;function e(){c.reset()}i.reset=e;function t(r){return c.tryGet(r)}i.tryGet=t})(He||(He={}));import{ISlickFormatter as Wp}from"@serenity-is/corelib/q";import{executeOnceWhenVisible as Wa,executeEverytimeWhenVisible as Ja}from"@serenity-is/corelib/q";var ve;(e=>(e.executeOnceWhenShown=Wa,e.executeEverytimeWhenShown=Ja))(ve||(ve={}));var Bs=class{constructor(n){this.idPrefix=n}byId(n){return $("#"+this.idPrefix+n)}w(n,e){return $("#"+this.idPrefix+n).getWidget(e)}};import{htmlEncode as Ls,isEmptyOrNull as Kr,startsWith as Yr}from"@serenity-is/corelib/q";var gt=class extends b{constructor(n,e){super(n,e),n.addClass("s-PopupMenuButton"),n.click(t=>{var a,o;t.preventDefault(),t.stopPropagation(),this.options.onPopup!=null&&this.options.onPopup();var i=this.options.menu;i.show().position({my:(a=this.options.positionMy)!=null?a:"left top",at:(o=this.options.positionAt)!=null?o:"left bottom",of:this.element});var r=this.uniqueName;$(document).one("click."+r,function(l){i.hide()})}),this.options.menu.hide().appendTo(document.body).addClass("s-PopupMenu").menu()}destroy(){this.options.menu!=null&&(this.options.menu.remove(),this.options.menu=null),super.destroy()}};gt=h([m.registerEditor("Serenity.PopupMenuButton")],gt);var Qi=class extends gt{constructor(n,e){super(n,e),n.addClass("s-PopupToolButton"),$("<b/>").appendTo(n.children(".button-outer").children("span"))}};Qi=h([m.registerEditor("Serenity.PopupToolButton")],Qi);var A=class extends b{constructor(e,t){super(e,t);this.element.addClass("s-Toolbar clearfix").html('<div class="tool-buttons"><div class="buttons-outer"><div class="buttons-inner"></div></div></div>'),this.createButtons()}destroy(){this.element.find("div.tool-button").unbind("click"),this.mouseTrap&&(this.mouseTrap.destroy?this.mouseTrap.destroy():this.mouseTrap.reset(),this.mouseTrap=null),super.destroy()}createButtons(){for(var e=$("div.buttons-inner",this.element).last(),t=this.options.buttons,i=0,r=0;r<t.length;r++){var a=t[r];a.separator&&i>0&&(e=$('<div class="buttons-inner"></div>').appendTo(e.parent()),i=0),this.createButton(e,a),i++}}createButton(e,t){var l;var i=(l=t.cssClass)!=null?l:"",r=$('<div class="tool-button"><div class="button-outer"><span class="button-inner"></span></div></div>').appendTo(e);(t.separator==="right"||t.separator==="both")&&$('<div class="separator"></div>').appendTo(e),i.length>0&&r.addClass(i),Kr(t.hint)||r.attr("title",t.hint),r.click(function(d){r.hasClass("disabled")||t.onClick(d)});var a=t.title;if(t.htmlEncode!==!1&&(a=Ls(t.title)),!Kr(t.icon)){r.addClass("icon-tool-button");var o=t.icon;Yr(o,"fa-")?o="fa "+o:Yr(o,"glyphicon-")&&(o="glyphicon "+o),a="<i class='"+Ls(o)+"'></i> "+a}a==null||a.length===0?r.addClass("no-text"):r.find("span").html(a),t.visible===!1&&r.hide(),t.disabled!=null&&typeof t.disabled!="function"&&r.toggleClass("disabled",!!t.disabled),(typeof t.visible=="function"||typeof t.disabled=="function")&&r.on("updateInterface",()=>{typeof t.visible=="function"&&r.toggle(!!t.visible()),typeof t.disabled=="function"&&r.toggleClass("disabled",!!t.disabled())}),!Kr(t.hotkey)&&window.Mousetrap!=null&&(this.mouseTrap=this.mouseTrap||window.Mousetrap(t.hotkeyContext||this.options.hotkeyContext||window.document.documentElement),this.mouseTrap.bind(t.hotkey,function(d,p){return r.is(":visible")&&r.triggerHandler("click"),t.hotkeyAllowDefault}))}findButton(e){return e!=null&&Yr(e,".")&&(e=e.substr(1)),$("div.tool-button."+e,this.element)}updateInterface(){this.element.find(".tool-button").each(function(e,t){$(t).triggerHandler("updateInterface")})}};A=h([m.registerClass("Serenity.Toolbar")],A);import{canLoadScriptData as Ni,Config as Ma,format as $a,getBaseType as za,getInstanceType as Xr,getTemplate as Ha,getTypeFullName as Zr,getTypeShortName as Gs,replaceAll as Ua,startsWith as ja,localText as Ka}from"@serenity-is/corelib/q";var B=class extends b{byId(n){return $("#"+this.idPrefix+n)}byID(n,e){return this.byId(n).getWidget(e)}static noGeneric(n){var e=n.indexOf("$");return e>=0?n.substr(0,e):n}getDefaultTemplateName(){return B.noGeneric(Gs(Xr(this)))}getTemplateName(){var n=Xr(this),e=Zr(n),t=B.templateNames,i=B.templateNames[e];if(i!=null)return i;for(;n&&n!==b;){var r=B.noGeneric(Zr(n));for(let a of Ma.rootNamespaces)if(ja(r,a+".")){r=r.substr(a.length+1);break}if(Ni("Template."+r)||(r=Ua(r,".","_"),Ni("Template."+r)||$("script#Template_"+r).length>0))return t[e]=r,r;if(r=B.noGeneric(Gs(n)),Ni("Template."+r)||$("script#Template_"+r).length>0)return B.templateNames[e]=r,r;n=za(n)}return t[e]=i=this.getDefaultTemplateName(),i}getFallbackTemplate(){return null}getTemplate(){var n=this.getTemplateName(),e=$("script#Template_"+n);if(e.length>0)return e.html();let t;if(!Ni("Template."+n)&&this.getDefaultTemplateName()==n&&(t=this.getFallbackTemplate(),t!=null))return t;if(t=Ha(n),t==null)throw new Error($a("Can't locate template for widget '{0}' with name '{1}'!",Zr(Xr(this)),n));return t}renderContents(){for(var n=this.getTemplate().replace(new RegExp("~_","g"),this.idPrefix),e=0;;){var t=n.indexOf('{{text:"',e);if(t<0)break;var e=n.indexOf('"}}',t);if(e<0)break;var i=n.substr(t+8,e-t-8),r=Ka(i);n=n.substr(0,t)+r+n.substr(e+3),e=t+r.length}this.element.html(n)}};B.templateNames={},B=h([m.registerClass("Serenity.TemplatedWidget")],B);import{bsModalMarkup as Ya,closePanel as Xa,Config as Za,dialogButtonToBS as eo,dialogButtonToUI as to,endsWith as io,getAttributes as Zt,getInstanceType as Li,isEmptyOrNull as ro,layoutFillHeight as so,newBodyDiv as no,parseInteger as ao,positionToastContainer as oo,validateOptions as lo}from"@serenity-is/corelib/q";typeof $!="undefined"&&$.fn&&($.fn.flexHeightOnly=function(c=1){return this.flexWidthHeight(0,c)},$.fn.flexWidthOnly=function(c=1){return this.flexWidthHeight(c,0)},$.fn.flexWidthHeight=function(c=1,n=1){return this.addClass("flexify").data("flex-x",c).data("flex-y",n)},$.fn.flexX=function(c){return this.data("flex-x",c)},$.fn.flexY=function(c){return this.data("flex-y",c)});var Bi=class extends b{constructor(e,t){super(e,t);this.xDifference=0;this.yDifference=0;ve.executeOnceWhenShown(e,()=>{this.storeInitialSize()})}storeInitialSize(){if(!this.element.data("flexify-init")){var e=this.options.designWidth;e==null&&(e=this.element.width()),this.element.data("flexify-width",e);var t=this.options.designHeight;t==null&&(t=this.element.height()),this.element.data("flexify-height",t),this.element.data("flexify-init",!0),this.element.on("resize."+this.uniqueName,()=>this.resizeElements()),this.element.on("resizestop."+this.uniqueName,()=>this.resizeElements());var i=this.element.find(".ui-tabs");i.length>0&&i.on("tabsactivate."+this.uniqueName,()=>this.resizeElements()),(this.options.designWidth!=null||this.options.designHeight!=null)&&this.resizeElements()}}getXFactor(e){var t=null;return this.options.getXFactor!=null&&(t=this.options.getXFactor(e)),t==null&&(t=e.data("flex-x")),t!=null?t:1}getYFactor(e){var t=null;return this.options.getYFactor!=null&&(t=this.options.getYFactor(e)),t==null&&(t=e.data("flex-y")),t!=null?t:0}resizeElements(){var e=this.element.width(),t=this.element.data("flexify-width");t==null&&(this.element.data("flexify-width",e),t=e);var i=this.element.height(),r=this.element.data("flexify-height");r==null&&(this.element.data("flexify-height",i),r=i),this.xDifference=e-t,this.yDifference=i-r;var a=this.element,o=this.element.find(".ui-tabs-panel");o.length>0&&(a=o.filter(":visible")),a.find(".flexify").add(o.filter(".flexify:visible")).each((l,d)=>{this.resizeElement($(d))})}resizeElement(e){var t=this.getXFactor(e);if(t!==0){var i=e.data("flexify-width");if(i==null){var r=e.width();e.data("flexify-width",r),i=r}e.width(i+t*this.xDifference|0)}var a=this.getYFactor(e);if(a!==0){var o=e.data("flexify-height");if(o==null){var l=e.height();e.data("flexify-height",l),o=l}e.height(o+a*this.yDifference|0)}e.hasClass("require-layout")&&e.triggerHandler("layout")}};var Ue;(t=>{function c(i,r,a,o,l){var d=i.dialog();return d.dialog("option","resizable",!0),o!=null&&d.dialog("option","minWidth",o),r!=null&&d.dialog("option","width",r),l!=null&&d.dialog("option","minHeight",l),a!=null&&d.dialog("option","height",a),i}t.dialogResizable=c;function n(i){return i.dialogExtend({closable:!0,maximizable:!0,dblclick:"maximize",icons:{maximize:"ui-icon-maximize-window"}}),i}t.dialogMaximizable=n;function e(i){return new Bi(i.closest(".ui-dialog"),{}),i}t.dialogFlexify=e})(Ue||(Ue={}));var Q=class extends B{constructor(e){super(no().addClass("s-TemplatedDialog hidden"),e);this.element.attr("id",this.uniqueName),this.initValidator(),this.initTabs(),this.initToolbar()}get isMarkedAsPanel(){var e=Zt(Li(this),ut,!0);return e.length>0&&e[e.length-1].value!==!1}get isResponsive(){return Za.responsiveDialogs||Zt(Li(this),ct,!0).length>0}static getCssSize(e,t){var i=e.css(t);if(i==null||!io(i,"px"))return null;i=i.substr(0,i.length-2);let r=ao(i);return r==null||isNaN(r)||r==0?null:r}static applyCssSizes(e,t){let i,r=$("<div/>").hide().addClass(t).appendTo(document.body);try{var a=$("<div/>").addClass("size").appendTo(r);i=Q.getCssSize(a,"minWidth"),i!=null&&(e.minWidth=i),i=Q.getCssSize(a,"width"),i!=null&&(e.width=i),i=Q.getCssSize(a,"height"),i!=null&&(e.height=i),i=Q.getCssSize(a,"minHeight"),i!=null&&(e.minHeight=i)}finally{r.remove()}}destroy(){if(this.tabs&&this.tabs.tabs("destroy"),this.tabs=null,this.toolbar&&this.toolbar.destroy(),this.toolbar=null,this.validator&&this.byId("Form").remove(),this.validator=null,this.element!=null&&this.element.hasClass("ui-dialog-content"))this.element.dialog("destroy"),this.element.removeClass("ui-dialog-content");else if(this.element!=null&&this.element.hasClass("modal-body")){var e=this.element.closest(".modal").data("bs.modal",null);this.element&&this.element.removeClass("modal-body"),window.setTimeout(()=>e.remove(),0)}$(window).unbind("."+this.uniqueName),super.destroy()}initDialog(){if(this.element.hasClass("ui-dialog-content"))return;this.element.removeClass("hidden"),this.element.dialog(this.getDialogOptions()),this.element.closest(".ui-dialog").on("resize",i=>this.arrange());let e=Li(this);this.isResponsive?(Ue.dialogResizable(this.element),$(window).bind("resize."+this.uniqueName,i=>{this.element&&this.element.is(":visible")&&this.handleResponsive()}),this.element.closest(".ui-dialog").addClass("flex-layout")):Ue.dialogFlexify&&Zt(e,ot,!0).length>0&&(Ue.dialogFlexify(this.element),Ue.dialogResizable(this.element)),Zt(e,lt,!0).length>0&&Ue.dialogMaximizable(this.element);var t=this;this.element.bind("dialogopen."+this.uniqueName,()=>{$(document.body).addClass("modal-dialog-open"),this.isResponsive&&this.handleResponsive(),t.onDialogOpen()}),this.element.bind("dialogclose."+this.uniqueName,()=>{$(document.body).toggleClass("modal-dialog-open",$(".ui-dialog:visible").length>0),t.onDialogClose()})}getModalOptions(){return{backdrop:!1,keyboard:!1,size:"lg",modalClass:this.getCssClass()}}initModal(){var p,u;if(!this.element.hasClass("modal-body")){var e=(u=(p=this.element.data("dialogtitle"))!=null?p:this.getDialogTitle())!=null?u:"",t=this.getModalOptions();t.show=!1;var i="s-Modal";t.modalClass&&(i+=" "+t.modalClass);var r=Ya(e,"",i),a=$(r).eq(0).appendTo(document.body).addClass("flex-layout");a.one("shown.bs.modal."+this.uniqueName,()=>{this.element.triggerHandler("shown.bs.modal"),this.onDialogOpen()}),a.one("hidden.bs.modal."+this.uniqueName,()=>{$(document.body).toggleClass("modal-open",$(".modal.show").length+$(".modal.in").length>0),this.onDialogClose()}),t.size&&a.find(".modal-dialog").addClass("modal-"+t.size);var o=a.find(".modal-footer"),l=this.getDialogButtons();if(l!=null)for(var d of l)$(eo(d)).appendTo(o).click(d.click);else o.hide();a.modal(t),a.find(".modal-body").replaceWith(this.element.removeClass("hidden").addClass("modal-body")),$(window).on("resize."+this.uniqueName,this.arrange.bind(this))}}initToolbar(){var e=this.byId("Toolbar");if(e.length!==0){var t=this.element.closest(".ui-dialog");t.length===0&&(t=this.element.closest(".modal"),t.length==0&&(t=this.element));var i={buttons:this.getToolbarButtons(),hotkeyContext:t[0]};this.toolbar=new A(e,i)}}getToolbarButtons(){return[]}getValidatorOptions(){return{}}initValidator(){var e=this.byId("Form");if(e.length>0){var t=this.getValidatorOptions();this.validator=e.validate(lo(t))}}resetValidation(){this.validator&&this.validator.resetAll()}validateForm(){return this.validator==null||!!this.validator.form()}dialogOpen(e){e=e!=null?e:this.isMarkedAsPanel,e?(this.element.hasClass("s-Panel")||(this.element.on("panelopen."+this.uniqueName,()=>{this.onDialogOpen()}),this.element.on("panelclose."+this.uniqueName,()=>{this.onDialogClose()})),Q.openPanel(this.element,this.uniqueName),this.setupPanelTitle()):this.useBSModal()?(this.initModal(),this.element.closest(".modal").modal("show")):(this.initDialog(),this.element.dialog("open"))}useBSModal(){return!!(!$.ui||!$.ui.dialog||Q.bootstrapModal)}static openPanel(e,t){var i=$(".panels-container");i.length||(i=$("section.content")),e.data("paneluniquename",t),i.length&&(i=i.last(),i.children().not(e).not(".panel-hidden").addClass("panel-hidden panel-hidden-"+t),e[0].parentElement!==i[0]&&e.appendTo(i)),$(".ui-dialog:visible, .ui-widget-overlay:visible, .modal.show, .modal.in").not(e).addClass("panel-hidden panel-hidden-"+t),e.removeClass("hidden").removeClass("panel-hidden").addClass("s-Panel").trigger("panelopen")}static closePanel(e,t){return Xa(e,t)}onDialogOpen(){$(document.documentElement).hasClass("mobile-device")||$(":input",this.element).not("button").eq(0).focus(),this.arrange(),this.tabs&&this.tabs.tabs("option","active",0)}arrange(){this.element.find(".require-layout").filter(":visible").each(function(e,t){$(t).triggerHandler("layout")})}onDialogClose(){$(document).trigger("click"),$.qtip&&$(document.body).children(".qtip").each(function(e,t){$(t).qtip("hide")}),window.setTimeout(()=>{var e=this.element;this.destroy(),e.remove(),oo(!1,null)},0)}addCssClass(){this.isMarkedAsPanel&&(super.addCssClass(),this.isResponsive&&this.element.addClass("flex-layout"))}getDialogButtons(){}getDialogOptions(){var a,o;var e={},t="s-Dialog "+this.getCssClass();e.dialogClass=t;var i=this.getDialogButtons();i!=null&&(e.buttons=i.map(to)),e.width=920,Q.applyCssSizes(e,t),e.autoOpen=!1;let r=Li(this);return e.resizable=Zt(r,pt,!0).length>0,e.modal=!0,e.position={my:"center",at:"center",of:$(window.window)},e.title=(o=(a=this.element.data("dialogtitle"))!=null?a:this.getDialogTitle())!=null?o:"",e}getDialogTitle(){return""}dialogClose(){this.element.hasClass("ui-dialog-content")?this.element.dialog().dialog("close"):this.element.hasClass("modal-body")?this.element.closest(".modal").modal("hide"):this.element.hasClass("s-Panel")&&!this.element.hasClass("hidden")&&Q.closePanel(this.element)}get dialogTitle(){return this.element.hasClass("ui-dialog-content")?this.element.dialog("option","title"):this.element.hasClass("modal-body")?this.element.closest(".modal").find(".modal-header").children("h5").text():this.element.data("dialogtitle")}setupPanelTitle(){var i;var e=(i=this.dialogTitle)!=null?i:this.getDialogTitle(),t=this.element.children(".panel-titlebar");ro(e)?t.remove():(this.element.children(".panel-titlebar").length||(t=$("<div class='panel-titlebar'><div class='panel-titlebar-text'></div></div>").prependTo(this.element)),t.children(".panel-titlebar-text").text(e),this.element.hasClass("s-Panel")&&(t.children(".panel-titlebar-close").length||$('<button class="panel-titlebar-close">&nbsp;</button>').prependTo(t).click(r=>{Q.closePanel(this.element,r)})))}set dialogTitle(e){var t=this.dialogTitle;this.element.data("dialogtitle",e),this.element.hasClass("ui-dialog-content")?this.element.dialog("option","title",e):this.element.hasClass("modal-body")?this.element.closest(".modal").find(".modal-header").children("h5").text(e!=null?e:""):this.element.hasClass("s-Panel")&&t!=this.dialogTitle&&(this.setupPanelTitle(),this.arrange())}set_dialogTitle(e){this.dialogTitle=e}initTabs(){var e=this.byId("Tabs");e.length!==0&&(this.tabs=e.tabs({}),this.tabs.bind("tabsactivate",()=>this.arrange()))}handleResponsive(){var e=this.element.dialog(),t=this.element.closest(".ui-dialog");if($(document.documentElement).hasClass("mobile-device")){var i=this.element.data("responsiveData");if(!i){i={},i.draggable=e.dialog("option","draggable"),i.resizable=e.dialog("option","resizable"),i.position=e.css("position");var r=t.position();i.left=r.left,i.top=r.top,i.width=t.width(),i.height=t.height(),i.contentHeight=this.element.height(),this.element.data("responsiveData",i),e.dialog("option","draggable",!1),e.dialog("option","resizable",!1)}t.addClass("mobile-layout"),t.css({left:"0px",top:"0px",width:$(window).width()+"px",height:$(window).height()+"px",position:"fixed"}),$(document.body).scrollTop(0),so(this.element)}else{var a=this.element.data("responsiveData");a&&(e.dialog("option","draggable",a.draggable),e.dialog("option","resizable",a.resizable),this.element.closest(".ui-dialog").css({left:"0px",top:"0px",width:a.width+"px",height:a.height+"px",position:a.position}),this.element.height(a.contentHeight),t.removeClass("mobile-layout"),this.element.removeData("responsiveData"))}}};Q=h([m.registerClass("Serenity.TemplatedDialog",[ye])],Q);import{validateOptions as uo}from"@serenity-is/corelib/q";var wt=class extends B{constructor(e,t){super(e,t);this.initValidator(),this.initTabs(),this.initToolbar()}destroy(){this.tabs&&(this.tabs.tabs("destroy"),this.tabs=null),this.toolbar&&(this.toolbar.destroy(),this.toolbar=null),this.validator&&(this.byId("Form").remove(),this.validator=null),super.destroy()}arrange(){this.element.find(".require-layout").filter(":visible").each(function(e,t){$(t).triggerHandler("layout")})}getToolbarButtons(){return[]}getValidatorOptions(){return{}}initTabs(){var e=this.byId("Tabs");e.length!==0&&(this.tabs=e.tabs({}))}initToolbar(){var e=this.byId("Toolbar");if(e.length!==0){var t={buttons:this.getToolbarButtons()};this.toolbar=new A(e,t)}}initValidator(){var e=this.byId("Form");if(e.length>0){var t=this.getValidatorOptions();this.validator=e.validate(uo(t))}}resetValidation(){this.validator&&this.validator.resetAll()}validateForm(){return this.validator==null||!!this.validator.form()}};wt=h([m.registerClass("Serenity.TemplatedPanel")],wt);import{Exception as po,validatorAbortHandler as co}from"@serenity-is/corelib/q";var _t;(t=>{function c(i,r,a){var o=i.validate(),l=o.settings;return l.abortHandler||r!=null&&r()===!1?!1:(l.abortHandler=co,l.submitHandler=function(){return a!=null&&a(),!1},i.trigger("submit"),!0)}t.asyncSubmit=c;function n(i,r,a){var o=i.validate(),l=o.settings;return l.abortHandler!=null||r!=null&&r()===!1||!o.form()?!1:(a!=null&&a(),!0)}t.submit=n;function e(i){var r=i.closest("form");return r.length===0?null:r.data("validator")}t.getValidator=e})(_t||(_t={}));var As;(t=>{function c(i,r,a){if(!i.length)return i;if(a==null)throw new po("rule is null!");return i.addClass("customValidate").bind("customValidate."+r,a),i}t.addValidationRule=c;function n(i,r){return i.unbind("customValidate."+r),i}t.removeValidationRule=n;function e(i,r){return i.element(r.element[0])}t.validateElement=e})(As||(As={}));import{findElementWithRelativeId as qs,isEmptyOrNull as Ws,notifyError as ho}from"@serenity-is/corelib/q";var je=class{constructor(n,e,t){this.parentType=n;this.widget=e;this.parentChange=t;this.bind(),this.widget.element.bind("remove."+e.uniqueName+"cwh",i=>{this.unbind(),this.widget=null,this.parentChange=null})}bind(){if(Ws(this._parentID))return null;var n=qs(this.widget.element,this._parentID).tryGetWidget(this.parentType);return n!=null?(n.element.bind("change."+this.widget.uniqueName,()=>{this.parentChange(n)}),n):(ho("Can't find cascaded parent element with ID: "+this._parentID+"!","",null),null)}unbind(){if(Ws(this._parentID))return null;var n=qs(this.widget.element,this._parentID).tryGetWidget(this.parentType);return n!=null&&n.element.unbind("."+this.widget.uniqueName),n}get_parentID(){return this._parentID}set_parentID(n){this._parentID!==n&&(this.unbind(),this._parentID=n,this.bind())}};je=h([m.registerClass("Serenity.CascadedWidgetLink")],je);var Gi;(r=>{function c(a,o,l){if(a){var d=t(a);if(d){var p=d[o];p!=null&&(l&&p===a.tabs("option","active")&&a.tabs("option","active",0),a.tabs(l?"disable":"enable",p))}}}r.setDisabled=c;function n(a,o,l){if(a){var d=t(a);if(d){var p=d[o];p!=null&&(!l&&p===a.tabs("option","active")&&a.tabs("option","active",0),a.children("ul").children("li").eq(p).toggle(l))}}}r.toggle=n;function e(a){var o=a.children("ul").children("li").eq(a.tabs("option","active")).children("a").attr("href").toString(),l="_Tab",d=o.lastIndexOf(l);return d>=0&&(o=o.substr(d+l.length)),o}r.activeTabKey=e;function t(a){var o=a.data("indexByKey");return o||(o={},a.children("ul").children("li").children("a").each(function(l,d){var p=d.getAttribute("href").toString(),u="_Tab",g=p.lastIndexOf(u);g>=0&&(p=p.substr(g+u.length)),o[p]=l}),a.data("indexByKey",o)),o}r.indexByKey=t;function i(a,o){var l=t(a);if(l){var d=l[o];d!=null&&d!==a.tabs("option","active")&&a.tabs("option","active",d)}}r.selectTab=i})(Gi||(Gi={}));import{getInstanceType as mo,getMembers as Js,isInstanceOfType as Ai,MemberType as Ms}from"@serenity-is/corelib/q";var be;(n=>{function c(e,t){if(t!=null){var i=mo(e);if(i!==Object){var r=i.__propByName,a=i.__fieldByName;if(r==null){var o=Js(i,Ms.property),l=o.filter(function(x){return!!x.setter&&((x.attr||[]).filter(function(I){return Ai(I,$e)}).length>0||(x.attr||[]).filter(function(I){return Ai(I,De)}).length>0)});r={};for(var d of l)r[re.makeCamelCase(d.name)]=d;i.__propByName=r}if(a==null){var p=Js(i,Ms.field),u=p.filter(function(x){return(x.attr||[]).filter(function(I){return Ai(I,$e)}).length>0||(x.attr||[]).filter(function(I){return Ai(I,De)}).length>0});a={};for(var g=0;g<u.length;g++){var v=u[g];a[re.makeCamelCase(v.name)]=v}i.__fieldByName=a}var f=Object.keys(t);for(var y of f){var C=t[y],S=re.makeCamelCase(y),O=r[S]||r[y];if(O!=null){var T=e[O.setter];T&&T.call(e,C)}else{var _=a[S]||a[y];_&&(e[_.name]=C)}}}}}n.set=c})(be||(be={}));import{any as zs,Authorization as ts,Culture as vo,extend as Hs,getAttributes as bo,getTypeShortName as Us,isBS3 as is,isBS5Plus as Co,isEmptyOrNull as Qe,startsWith as js,localText as xo,trimToEmpty as Ks,trimToNull as Ys,tryGetText as Xs}from"@serenity-is/corelib/q";import{cast as ei,isInstanceOfType as es,isTrimmedEmpty as go,parseDecimal as fo,safeCast as Ce,localText as yo,tryGetText as $s}from"@serenity-is/corelib/q";var w;(p=>{function c(u){var y,C,S;var g=u.element.data("select2");if(g!=null){var v=u.element.select2("data");return v==null?"":(y=v.text)!=null?y:""}var f=e(u);return f==null?"":typeof f=="string"?f:f instanceof Boolean?f?(C=$s("Controls.FilterPanel.OperatorNames.true"))!=null?C:"True":(S=$s("Controls.FilterPanel.OperatorNames.true"))!=null?S:"False":f.toString()}p.getDisplayText=c;var n={name:"_"};function e(u){var g={};return t(u,n,g),g._}p.getValue=e;function t(u,g,v){var f=Ce(u,X);if(f!=null){f.getEditValue(g,v);return}var y=Ce(u,P);if(y!=null){v[g.name]=y.get_value();return}var C=Ce(u,Ee);if(C!=null){v[g.name]=C.get_value();return}var S=Ce(u,Y);if(S!=null){var O=S.get_value();v[g.name]=isNaN(O)?null:O;return}if(u.getEditValue!=null){u.getEditValue(g,v);return}if(u.element.is(":input")){v[g.name]=u.element.val();return}}p.saveValue=t;function i(u,g){var v={_:g};r(u,n,v)}p.setValue=i;function r(u,g,v){var f=Ce(u,Z);if(f!=null){f.setEditValue(v,g);return}var y=Ce(u,P);if(y!=null){var C=v[g.name];C!=null&&(C=C.toString()),y.set_value(ei(C,String));return}var S=Ce(u,Ee);if(S!=null){var O=v[g.name];typeof O=="number"?S.set_value(O>0):S.set_value(!!O);return}var T=Ce(u,Y);if(T!=null){var _=v[g.name];_==null||es(_,String)&&go(ei(_,String))?T.set_value(null):es(_,String)?T.set_value(ei(fo(ei(_,String)),Number)):es(_,Boolean)?T.set_value(_?1:0):T.set_value(ei(_,Number));return}if(u.setEditValue!=null){u.setEditValue(v,g);return}if(u.element.is(":input")){var x=v[g.name];x==null?u.element.val(""):u.element.val(x);return}}p.loadValue=r;function a(u,g){return u.each(function(v,f){var y=$(f),C=y.attr("type");return y.is("select")||C==="radio"||C==="checkbox"?g?y.addClass("readonly").attr("disabled","disabled"):y.removeClass("readonly").removeAttr("disabled"):g?y.addClass("readonly").attr("readonly","readonly"):y.removeClass("readonly").removeAttr("readonly"),!0}),u}p.setReadonly=a;function o(u,g){var v=Ce(u,R);v!=null?v.set_readOnly(g):u.element.is(":input")&&a(u.element,g)}p.setReadOnly=o;function l(u,g){var v=Ce(u,Ve);v!=null?v.set_required(g):u.element.is(":input")&&u.element.toggleClass("required",!!g);var f=u.element.closest(".field"),y=f.find("sup").get().length>0;g&&!y?$("<sup>*</sup>").attr("title",yo("Controls.PropertyGrid.RequiredHint")).prependTo(f.find(".caption")[0]):!g&&y&&$(f.find("sup")[0]).remove()}p.setRequired=l;function d(u,g){if(!g){if(!u.hasClass("readonly-container"))return;u.removeClass("readonly-container").find(".editor.container-readonly").removeClass("container-readonly").each((v,f)=>{var y=$(f).tryGetWidget(b);y!=null?p.setReadOnly(y,!1):p.setReadonly($(f),!1)});return}u.addClass("readonly-container").find(".editor").not(".container-readonly").each((v,f)=>{var y=$(f).tryGetWidget(b);if(y!=null){if(y.get_readOnly){if(y.get_readOnly())return}else if($(f).is("[readonly]")||$(f).is("[disabled]")||$(f).is(".readonly")||$(f).is(".disabled"))return;$(f).addClass("container-readonly"),p.setReadOnly(y,!0)}else{if($(f).is("[readonly]")||$(f).is("[disabled]")||$(f).is(".readonly")||$(f).is(".disabled"))return;p.setReadonly($(f).addClass("container-readonly"),!0)}})}p.setContainerReadOnly=d})(w||(w={}));var W=class extends b{constructor(e,t){var O;super(e,t);this.categoryLinkClick=e=>{e.preventDefault();var t=$("a[name="+e.target.getAttribute("href").toString().substr(1)+"]");t.closest(".category").hasClass("collapsed")&&t.closest(".category").children(".category-title").click();var i=function(){$.fn.fadeTo&&t.fadeTo(100,.5,function(){t.fadeTo(100,1,function(){})})},r=t.closest(".category");$.fn.scrollintoview?r.closest(":scrollable(both)").length===0?i():r.scrollintoview({duration:"fast",direction:"y",complete:i}):r&&r[0]&&r[0].scrollIntoView&&(r[0].scrollIntoView(),i())};this.idPrefix=this.options.idPrefix=(O=this.options.idPrefix)!=null?O:this.idPrefix,this.options.mode==null&&(this.options.mode=1),e.addClass("s-PropertyGrid"),this.editors=[];var i=this.options.items||[];this.items=[];var r=zs(i,function(T){return!Qe(T.tab)});if(r){var a=i.filter(T=>Qe(T.tab));a.length>0&&(this.createItems(this.element,a),$("<div class='pad'></div>").appendTo(this.element));for(var o=i.filter(T=>!Qe(T.tab)),l=$("<ul class='nav nav-tabs property-tabs' role='tablist'></ul>").appendTo(this.element),d=$("<div class='tab-content property-panes'></div>").appendTo(this.element),p=0,u=0;u<o.length;){var g={$:Ks(o[u].tab)},v=[],f=u;do v.push(o[f]);while(++f<o.length&&Ks(o[f].tab)===g.$);u=f;var y=$(is()?'<li><a data-toggle="tab" role="tab"></a></li>':`<li class="nav-item"><a class="nav-link" data-${Co()?"bs-":""}toggle="tab" role="tab"></a></li>`).appendTo(l);p===0&&(is()?y.addClass("active"):y.children("a").addClass("active"));var C=this.uniqueName+"_Tab"+p;y.children("a").attr("href","#"+C).text(this.determineText(g.$,function(T){return T+"Tabs."+this.tab.$}.bind({tab:g})));var S=$("<div class='tab-pane fade' role='tabpanel'>").appendTo(d);p===0&&S.addClass(is()?"in active":"show active"),S.attr("id",C),this.createItems(S,v),p++}}else this.createItems(this.element,i);this.updateInterface()}destroy(){if(this.editors!=null){for(var e=0;e<this.editors.length;e++)this.editors[e].destroy();this.editors=null}this.element.find("a.category-link").unbind("click",this.categoryLinkClick).remove(),b.prototype.destroy.call(this)}createItems(e,t){var y,C;var i={},r=e,a=this.options.useCategories!==!1&&zs(t,function(S){return!Qe(S.category)});if(a){var o=$("<div/>").addClass("category-links");i=this.createCategoryLinks(o,t),Object.keys(i).length>1?o.appendTo(e):o.find("a.category-link").unbind("click",this.categoryLinkClick).remove()}r=$("<div/>").addClass("categories").appendTo(e);var l;a?l=r:l=$("<div/>").addClass("category").appendTo(r);for(var d=null,p=0;p<t.length;p++){var u=t[p],g=u.category;if(g==null&&(g=(y=this.options.defaultCategory)!=null?y:""),a&&d!==g){var v=this.createCategoryDiv(r,i,g,u.collapsible!==!0?null:(C=u.collapsed)!=null?C:!1);d==null&&v.addClass("first-category"),d=g,l=v}var f=this.createField(l,u);this.items.push(u),this.editors.push(f)}}createCategoryDiv(e,t,i,r){var a=$("<div/>").addClass("category").appendTo(e),o=$("<div/>").addClass("category-title").append($("<a/>").addClass("category-anchor").text(this.determineText(i,function(d){return d+"Categories."+i})).attr("name",this.idPrefix+"Category"+t[i].toString())).appendTo(a);if(r!=null){a.addClass(r===!0?"collapsible collapsed":"collapsible");var l=$("<i/>").addClass(r===!0?"fa fa-plus":"fa fa-minus").appendTo(o);o.click(function(d){a.toggleClass("collapsed"),l.toggleClass("fa-plus").toggleClass("fa-minus")})}return a}determineText(e,t){if(e!=null&&!js(e,"`")){var i=Xs(e);if(i!=null)return i}if(e!=null&&js(e,"`")&&(e=e.substring(1)),!Qe(this.options.localTextPrefix)){var r=Xs(t(this.options.localTextPrefix));if(r!=null)return r}return e}createField(e,t){var S,O;var i=$("<div/>").addClass("field").addClass(t.name).data("PropertyItem",t).appendTo(e);if(Qe(t.cssClass)||i.addClass(t.cssClass),!Qe(t.formCssClass)&&(i.addClass(t.formCssClass),t.formCssClass.indexOf("line-break-")>=0)){var r=t.formCssClass.split(String.fromCharCode(32));r.indexOf("line-break-xs")>=0?$("<div class='line-break' style='width: 100%' />").insertBefore(i):r.indexOf("line-break-sm")>=0?$("<div class='line-break hidden-xs' style='width: 100%' />").insertBefore(i):r.indexOf("line-break-md")>=0?$("<div class='line-break hidden-sm' style='width: 100%' />").insertBefore(i):r.indexOf("line-break-lg")>=0&&$("<div class='line-break hidden-md' style='width: 100%' />").insertBefore(i)}var a=this.idPrefix+t.name,o=this.determineText(t.title,function(T){return T+t.name}),l=this.determineText(t.hint,function(T){return T+t.name+"_Hint"}),d=this.determineText(t.placeholder,function(T){return T+t.name+"_Placeholder"});l==null&&(l=o!=null?o:"");var p=$("<label/>").addClass("caption").attr("for",a).attr("title",l).text(o!=null?o:"").appendTo(i);Qe(t.labelWidth)||(t.labelWidth==="0"?p.hide():p.css("width",t.labelWidth)),t.required===!0&&$("<sup>*</sup>").attr("title",xo("Controls.PropertyGrid.RequiredHint")).prependTo(p);var u=mt.get((S=t.editorType)!=null?S:"String"),g=b.elementFor(u).addClass("editor").attr("id",a).appendTo(i);g.is(":input")&&g.attr("name",(O=t.name)!=null?O:""),Qe(d)||g.attr("placeholder",d);var v=t.editorParams,f=null,y=bo(u,dt,!0);y!=null&&y.length>0&&(f=y[0].optionsType);var C;return f!=null?(v=Hs(new f,t.editorParams),C=new u(g,v)):(v=Hs(new Object,t.editorParams),C=new u(g,v)),C.initialize(),Us(C)=="BooleanEditor"&&(t.editorParams==null||!t.editorParams.labelFor)&&p.removeAttr("for"),Us(C)=="RadioButtonEditor"&&(t.editorParams==null||!t.editorParams.labelFor)&&p.removeAttr("for"),t.maxLength!=null&&W.setMaxLength(C,t.maxLength),t.editorParams!=null&&be.set(C,t.editorParams),$("<div/>").addClass("vx").appendTo(i),$("<div/>").addClass("clear").appendTo(i),C}getCategoryOrder(e){var u;var t=0,i={},r=Ys(this.options.categoryOrder);if(r!=null){var a=r.split(";");for(var o of a){var l=Ys(o);l!=null&&i[l]==null&&(i[l]=t++)}}for(var d of e){var p=d.category;p==null&&(p=(u=this.options.defaultCategory)!=null?u:""),i[p]==null&&(i[p]=t++)}return i}createCategoryLinks(e,t){var S;var i=0,r={},a={};for(var o of t){var l=o.name,d=o.category;d==null&&(d=(S=this.options.defaultCategory)!=null?S:""),a[l]=d,r[o.name]=i++}var p=this,u=this.getCategoryOrder(t);t.sort(function(O,T){var _=0,x=a[O.name],I=a[T.name];if(x!=I){var E=u[x],j=u[I];E!=null&&j!=null?_=E-j:E!=null?_=-1:j!=null&&(_=1)}return _===0&&(_=vo.stringCompare(x,I)),_===0&&(_=r[O.name]<r[T.name]?-1:r[O.name]>r[T.name]?1:0),_});for(var g={},v=0;v<t.length;v++){var f=t[v],y={$:a[f.name]};if(g[y.$]==null){var C=Object.keys(g).length+1;g[y.$]=C,C>1&&$("<span/>").addClass("separator").text("|").prependTo(e),$("<a/>").addClass("category-link").text(this.determineText(y.$,function(O){return O+"Categories."+this.category.$}.bind({category:y}))).attr("tabindex","-1").attr("href","#"+this.idPrefix+"Category"+C.toString()).click(this.categoryLinkClick).prependTo(e)}}return $("<div/>").addClass("clear").appendTo(e),g}get_editors(){return this.editors}get_items(){return this.items}get_idPrefix(){return this.idPrefix}get_mode(){return this.options.mode}set_mode(e){this.options.mode!==e&&(this.options.mode=e,this.updateInterface())}static loadEditorValue(e,t,i){}static saveEditorValue(e,t,i){w.saveValue(e,t,i)}static setReadOnly(e,t){w.setReadOnly(e,t)}static setReadonly(e,t){return w.setReadonly(e,t)}static setRequired(e,t){w.setRequired(e,t)}static setMaxLength(e,t){e.element.is(":input")&&(t>0?e.element.attr("maxlength",t):e.element.removeAttr("maxlength"))}load(e){for(var t=0;t<this.editors.length;t++){var i=this.items[t],r=this.editors[t];this.get_mode()===1&&i.defaultValue!=null&&typeof e[i.name]=="undefined"&&(e[i.name]=i.defaultValue),w.loadValue(r,i,e)}}save(e){e==null&&(e=Object.create(null));for(var t=0;t<this.editors.length;t++){var i=this.items[t];if(i.oneWay!==!0&&this.canModifyItem(i)){var r=this.editors[t];w.saveValue(r,i,e)}}return e}get value(){return this.save()}set value(e){e==null&&(e=Object.create(null)),this.load(e)}canModifyItem(e){return this.get_mode()===ti.insert?e.insertable===!1?!1:e.insertPermission==null?!0:ts.hasPermission(e.insertPermission):this.get_mode()===ti.update?e.updatable===!1?!1:e.updatePermission==null?!0:ts.hasPermission(e.updatePermission):!0}updateInterface(){for(var e=0;e<this.editors.length;e++){var t=this.items[e],i=this.editors[e],r=t.readOnly===!0||!this.canModifyItem(t);if(w.setReadOnly(i,r),w.setRequired(i,!r&&!!t.required&&t.editorType!=="Boolean"),t.visible===!1||t.readPermission!=null||t.insertPermission!=null||t.updatePermission!=null||t.hideOnInsert===!0||t.hideOnUpdate===!0){var a=t.readPermission!=null&&!ts.hasPermission(t.readPermission)||t.visible===!1||this.get_mode()===ti.insert&&t.hideOnInsert===!0||this.get_mode()===2&&t.hideOnUpdate===!0;i.getGridField().toggle(!a)}}}enumerateItems(e){for(var t=0;t<this.editors.length;t++){var i=this.items[t],r=this.editors[t];e(i,r)}}};W=h([m.registerClass("Serenity.PropertyGrid")],W);var ti=(e=>(e[e.insert=1]="insert",e[e.update=2]="update",e))(ti||{});import{endsWith as Zs,getAttributes as Io,getForm as So,getInstanceType as en,getTypeFullName as To}from"@serenity-is/corelib/q";var qi=class extends wt{constructor(e,t){super(e,t);this.initPropertyGrid(),this.loadInitialEntity()}destroy(){this.propertyGrid&&(this.propertyGrid.destroy(),this.propertyGrid=null),this.validator&&(this.byId("Form").remove(),this.validator=null),super.destroy()}initPropertyGrid(){var e=this.byId("PropertyGrid");if(!(e.length<=0)){var t=this.getPropertyGridOptions();this.propertyGrid=new W(e,t).init(null),this.element.closest(".ui-Panel").hasClass("s-Flexify")&&this.propertyGrid.element.children(".categories").flexHeightOnly(1)}}loadInitialEntity(){this.propertyGrid&&this.propertyGrid.load(new Object)}getFormKey(){var e=Io(en(this),fe,!0);if(e.length>=1)return e[0].value;var t=To(en(this)),i=t.indexOf(".");return i>=0&&(t=t.substring(i+1)),Zs(t,"Panel")?t=t.substr(0,t.length-6):Zs(t,"Panel")&&(t=t.substr(0,t.length-5)),t}getPropertyGridOptions(){return{idPrefix:this.idPrefix,items:this.getPropertyItems(),mode:1,useCategories:!1,localTextPrefix:"Forms."+this.getFormKey()+"."}}getPropertyItems(){var e=this.getFormKey();return So(e)}getSaveEntity(){var e=new Object;return this.propertyGrid&&this.propertyGrid.save(e),e}get_entity(){return this._entity}get_entityId(){return this._entityId}set_entity(e){this._entity=e!=null?e:new Object}set_entityId(e){this._entityId=e}validateBeforeSave(){return this.validator.form()}};qi=h([m.registerClass("Serenity.PropertyPanel")],qi);var xe;(a=>{function c(o,l,d,p){var u=l.widgetName;return o.element.bind("ondatachange."+u,function(g,v){p?window.setTimeout(function(){d(g,v)},0):d(g,v)}).bind("remove."+u,function(){o.element.unbind("ondatachange."+u)}),o}a.bindToDataChange=c;function n(o){return o.element.triggerHandler("ondatachange"),o}a.triggerDataChange=n;function e(o){return o.triggerHandler("ondatachange"),o}a.triggerDataChanged=e;function t(o,l,d){return c(o,l,function(p,u){l.element.triggerHandler("ondatachange")},d)}a.bubbleDataChange=t;function i(o,l){return o.element.one("dialogopen",function(d){o.element.dialog().dialog("option","position",r(l))}),o}a.cascade=i;function r(o){return{my:"left top",at:"left+20 top+20",of:o[0]}}a.cascadedDialogOffset=r})(xe||(xe={}));import{endsWith as tn,getAttributes as ko,getFormData as Oo,getFormDataAsync as wo,getInstanceType as rn,getTypeFullName as _o,isEmptyOrNull as sn,ScriptData as Do,localText as nn}from"@serenity-is/corelib/q";var ft=class extends Q{constructor(e){super(e);this.useAsync()?this.initAsync():this.initSync()}internalInit(){this.initPropertyGrid(),this.loadInitialEntity()}initSync(){this.propertyItemsData=this.getPropertyItemsData(),this.internalInit(),this.afterInit()}initAsync(){return _e(this,null,function*(){this.propertyItemsData=yield this.getPropertyItemsDataAsync(),this.internalInit(),this.afterInit()})}afterInit(){}useAsync(){return!1}destroy(){this.propertyGrid&&(this.propertyGrid.destroy(),this.propertyGrid=null),this.validator&&(this.byId("Form").remove(),this.validator=null),super.destroy()}getDialogOptions(){var e=super.getDialogOptions();return e.width=400,e}getDialogButtons(){return super.getDialogButtons(),[{text:nn("Dialogs.OkButton"),cssClass:"btn btn-primary",click:()=>this.okClick()},{text:nn("Dialogs.CancelButton"),click:()=>this.cancelClick()}]}okClick(){this.validateBeforeSave()&&this.okClickValidated()}okClickValidated(){this.dialogClose()}cancelClick(){this.dialogClose()}initPropertyGrid(){var e=this.byId("PropertyGrid");if(!(e.length<=0)){var t=this.getPropertyGridOptions();this.propertyGrid=new W(e,t).init(null),this.element.closest(".ui-dialog").hasClass("s-Flexify")&&this.propertyGrid.element.children(".categories").flexHeightOnly(1)}}getFormKey(){var e=ko(rn(this),fe,!0);if(e.length>=1)return e[0].value;var t=_o(rn(this)),i=t.indexOf(".");return i>=0&&(t=t.substring(i+1)),tn(t,"Dialog")?t=t.substr(0,t.length-6):tn(t,"Panel")&&(t=t.substr(0,t.length-5)),t}getPropertyGridOptions(){return{idPrefix:this.idPrefix,items:this.getPropertyItems(),mode:1,useCategories:!1,localTextPrefix:"Forms."+this.getFormKey()+"."}}getPropertyItems(){var e;return((e=this.propertyItemsData)==null?void 0:e.items)||[]}getPropertyItemsData(){var e=this.getFormKey();return this.getFormKey===ft.prototype.getFormKey&&this.getPropertyItems!==ft.prototype.getPropertyItems&&!Do.canLoad("Form."+e)?{items:this.getPropertyItems(),additionalItems:[]}:sn(e)?{items:[],additionalItems:[]}:Oo(e)}getPropertyItemsDataAsync(){return _e(this,null,function*(){var e=this.getFormKey();return sn(e)?{items:[],additionalItems:[]}:yield wo(e)})}getSaveEntity(){var e=new Object;return this.propertyGrid&&this.propertyGrid.save(e),e}loadInitialEntity(){this.propertyGrid&&this.propertyGrid.load(new Object)}get_entity(){return this.entity}set_entity(e){this.entity=e!=null?e:new Object}get_entityId(){return this.entityId}set_entityId(e){this.entityId=e}validateBeforeSave(){return this.validator.form()}updateTitle(){}getFallbackTemplate(){return`<div>
    <div class="s-Form">
        <form id="~_Form" action="">
            <div class="fieldset">
                <div id="~_PropertyGrid"></div>
                <div class="clear"></div>
            </div>
        </form> 
    </div>
</div>`}};ft=h([m.registerClass("Serenity.PropertyDialog")],ft);var se=class extends b{constructor(n){super(n)}get value(){return this.element.val()}get_value(){return this.value}set value(n){this.element.val(n)}set_value(n){this.value=n}};se=h([m.registerEditor("Serenity.StringEditor",[P]),m.element('<input type="text"/>')],se);var Wi=class extends se{constructor(n){super(n),n.attr("type","password")}};Wi=h([m.registerEditor("Serenity.PasswordEditor")],Wi);var Ji=class extends b{constructor(n,e){var t,i;super(n,e),this.options.cols!==0&&n.attr("cols",(t=this.options.cols)!=null?t:80),this.options.rows!==0&&n.attr("rows",(i=this.options.rows)!=null?i:6)}get value(){return this.element.val()}get_value(){return this.value}set value(n){this.element.val(n)}set_value(n){this.value=n}};Ji=h([m.registerEditor("Serenity.TextAreaEditor",[P]),m.element("<textarea />")],Ji);var Mi=class extends b{get value(){return this.element.is(":checked")}get_value(){return this.value}set value(n){this.element.prop("checked",!!n)}set_value(n){this.value=n}};Mi=h([m.registerEditor("Serenity.BooleanEditor",[Ee]),m.element('<input type="checkbox"/>')],Mi);import{Culture as rs,extend as Po,formatNumber as Fo,parseDecimal as Eo}from"@serenity-is/corelib/q";var Ie=class extends b{constructor(n,e){var i,r;super(n,e),n.addClass("decimalQ");var t=Po(Ie.defaultAutoNumericOptions(),{vMin:(i=this.options.minValue)!=null?i:this.options.allowNegatives?this.options.maxValue!=null?"-"+this.options.maxValue:"-999999999999.99":"0.00",vMax:(r=this.options.maxValue)!=null?r:"999999999999.99"});this.options.decimals!=null&&(t.mDec=this.options.decimals),this.options.padDecimals!=null&&(t.aPad=this.options.padDecimals),$.fn.autoNumeric&&n.autoNumeric(t)}get_value(){if($.fn.autoNumeric){var n=this.element.autoNumeric("get");return n==null||n===""?null:parseFloat(n)}var n=this.element.val();return Eo(n)}get value(){return this.get_value()}set_value(n){n==null||n===""?this.element.val(""):$.fn.autoNumeric?this.element.autoNumeric("set",n):this.element.val(Fo(n))}set value(n){this.set_value(n)}get_isValid(){return!isNaN(this.get_value())}static defaultAutoNumericOptions(){return{aDec:rs.decimalSeparator,altDec:rs.decimalSeparator==="."?",":".",aSep:rs.decimalSeparator==="."?",":".",aPad:!0}}};Ie=h([m.registerEditor("Serenity.DecimalEditor",[Y]),m.element('<input type="text"/>')],Ie);import{extend as Ro,formatNumber as Vo,isTrimmedEmpty as Qo,parseInteger as No,trimToNull as Bo}from"@serenity-is/corelib/q";var Dt=class extends b{constructor(n,e){var i,r;super(n,e),n.addClass("integerQ");var t=Ro(Ie.defaultAutoNumericOptions(),{vMin:((i=this.options.minValue)!=null?i:this.options.allowNegatives)?this.options.maxValue!=null?"-"+this.options.maxValue:"-2147483647":"0",vMax:(r=this.options.maxValue)!=null?r:2147483647,aSep:null});$.fn.autoNumeric&&n.autoNumeric(t)}get_value(){if($.fn.autoNumeric){var n=this.element.autoNumeric("get");return Qo(n)?null:parseInt(n,10)}else{var n=Bo(this.element.val());return n==null?null:No(n)}}get value(){return this.get_value()}set_value(n){n==null||n===""?this.element.val(""):$.fn.autoNumeric?this.element.autoNumeric("set",n):this.element.val(Vo(n))}set value(n){this.set_value(n)}get_isValid(){return!isNaN(this.get_value())}};Dt=h([m.registerEditor("Serenity.IntegerEditor",[Y]),m.element('<input type="text"/>')],Dt);import{addValidationRule as Lo,Culture as F,format as an,formatDate as ee,Invariant as on,isEmptyOrNull as $i,parseDate as ln,parseISODateTime as ss,replaceAll as Go,localText as dn,today as ns}from"@serenity-is/corelib/q";var pn='<svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 17 17"><g></g><path d="M14 2v-1h-3v1h-5v-1h-3v1h-3v15h17v-15h-3zM12 2h1v2h-1v-2zM4 2h1v2h-1v-2zM16 16h-15v-8.921h15v8.921zM1 6.079v-3.079h2v2h3v-2h5v2h3v-2h2v3.079h-15z" fill="currentColor"></path></svg>',V=class extends b{constructor(e){var t;super(e);typeof flatpickr!="undefined"&&(V.useFlatpickr||!$.fn.datepicker)?flatpickr(e[0],V.flatPickrOptions(e)):$.fn.datepicker?e.datepicker({showOn:"button",beforeShow:(i,r)=>e.hasClass("readonly")?!1:(V.uiPickerZIndexWorkaround(this.element),!0),yearRange:(t=this.yearRange)!=null?t:"-100:+50"}):e.attr("type","date"),e.on("keyup."+this.uniqueName,i=>{i.which===32&&!this.get_readOnly()?this.get_valueAsDate()!=ns()&&(this.set_valueAsDate(ns()),this.element.trigger("change")):V.dateInputKeyup(i)}),e.on("change."+this.uniqueName,V.dateInputChange),Lo(e,this.uniqueName,i=>{var r=this.get_value();return $i(r)?null:!$i(this.get_minValue())&&on.stringCompare(ee(r,"yyyy-MM-dd"),ee(this.get_minValue(),"yyyy-MM-dd"))<0?an(dn("Validation.MinDate"),ee(this.get_minValue(),null)):!$i(this.get_maxValue())&&on.stringCompare(ee(r,"yyyy-MM-dd"),ee(this.get_maxValue(),"yyyy-MM-dd"))>0?an(dn("Validation.MaxDate"),ee(this.get_maxValue(),null)):null}),this.set_sqlMinMax(!0)}static flatPickrOptions(e){return{clickOpens:!0,allowInput:!0,dateFormat:F.dateOrder.split("").join(F.dateSeparator).replace("y","Y"),onChange:function(){e.triggerHandler("change")}}}get_value(){var e=this.element.val().trim();return e!=null&&e.length===0?null:ee(e,"yyyy-MM-dd")}get value(){return this.get_value()}set_value(e){e==null?this.element.val(""):e.toLowerCase()==="today"||e.toLowerCase()==="now"?this.element.val(ee(ns(),null)):this.element.val(ee(e,null))}set value(e){this.set_value(e)}get_valueAsDate(){return $i(this.get_value())?null:ss(this.get_value())}get valueAsDate(){return this.get_valueAsDate()}set_valueAsDate(e){e==null&&this.set_value(null),this.set_value(ee(e,"yyyy-MM-dd"))}set valueAsDate(e){this.set_valueAsDate(e)}get_readOnly(){return this.element.hasClass("readonly")}set_readOnly(e){e!==this.get_readOnly()&&(e?(this.element.addClass("readonly").attr("readonly","readonly"),this.element.nextAll(".ui-datepicker-trigger").css("opacity","0.1")):(this.element.removeClass("readonly").removeAttr("readonly"),this.element.nextAll(".ui-datepicker-trigger").css("opacity","1")))}get_minValue(){return this.minValue}set_minValue(e){this.minValue=e}get_maxValue(){return this.maxValue}set_maxValue(e){this.maxValue=e}get_minDate(){return ss(this.get_minValue())}set_minDate(e){this.set_minValue(ee(e,"yyyy-MM-dd"))}get_maxDate(){return ss(this.get_maxValue())}set_maxDate(e){this.set_maxValue(ee(e,"yyyy-MM-dd"))}get_sqlMinMax(){return this.get_minValue()==="1753-01-01"&&this.get_maxValue()==="9999-12-31"}set_sqlMinMax(e){e?(this.set_minValue("1753-01-01"),this.set_maxValue("9999-12-31")):(this.set_minValue(null),this.set_maxValue(null))}static flatPickrTrigger(e){return $('<i class="ui-datepicker-trigger" href="javascript:;">'+pn+"</i>").insertAfter(e).click(()=>{e.hasClass("readonly")||e[0]._flatpickr.open()})}static dateInputKeyup(e){var a;if(F.dateOrder!=="dmy")return;var t=$(e.target);if(!t.is(":input")||t.attr("type")=="date"||t.is("[readonly]")||t.is(":disabled"))return;var i=(a=t.val())!=null?a:"";if(i.length===0||t[0].selectionEnd!==i.length)return;if(i.indexOf(F.dateSeparator+F.dateSeparator)!==-1){t.val(Go(i,F.dateSeparator+F.dateSeparator,F.dateSeparator));return}function r(o){return o>=48&&o<=57}if(e.which===47||e.which===111){if(i.length>=2&&i.charAt(i.length-1)===F.dateSeparator&&i.charAt(i.length-2)===F.dateSeparator){t.val(i.substr(0,i.length-1));return}if(i.charAt(i.length-1)!==F.dateSeparator)return;switch(i.length){case 2:if(r(i.charCodeAt(0))){i="0"+i;break}else return;case 4:if(r(i.charCodeAt(0))&&r(i.charCodeAt(2))&&i.charAt(1)==F.dateSeparator){i="0"+i.charAt(0)+F.dateSeparator+"0"+i.charAt(2)+F.dateSeparator;break}else return;case 5:if(r(i.charCodeAt(0))&&r(i.charCodeAt(2))&&r(i.charCodeAt(3))&&i.charAt(1)===F.dateSeparator){i="0"+i;break}else if(r(i.charCodeAt(0))&&r(i.charCodeAt(1))&&r(i.charCodeAt(3))&&i.charAt(2)===F.dateSeparator){i=i.charAt(0)+i.charAt(1)+F.dateSeparator+"0"+i.charAt(3)+F.dateSeparator;break}else break;default:return}t.val(i)}if(i.length<6&&(e.which>=48&&e.which<=57||e.which>=96&&e.which<=105)&&r(i.charCodeAt(i.length-1))){switch(i.length){case 1:{if(i.charCodeAt(0)<=51)return;i="0"+i;break}case 2:{if(!r(i.charCodeAt(0)))return;break}case 3:{if(!r(i.charCodeAt(0))||i.charAt(1)!==F.dateSeparator||i.charCodeAt(2)<=49)return;i="0"+i.charAt(0)+F.dateSeparator+"0"+i.charAt(2);break}case 4:if(i.charAt(1)==F.dateSeparator){if(!r(i.charCodeAt(0))||!r(i.charCodeAt(2)))return;i="0"+i;break}else if(i.charAt(2)==F.dateSeparator){if(!r(i.charCodeAt(0))||!r(i.charCodeAt(1))||i.charCodeAt(3)<=49)return;i=i.charAt(0)+i.charAt(1)+F.dateSeparator+"0"+i.charAt(3);break}else return;case 5:{if(i.charAt(2)!==F.dateSeparator||!r(i.charCodeAt(0))||!r(i.charCodeAt(1))||!r(i.charCodeAt(3)))return;break}default:return}t.val(i+F.dateSeparator)}}static uiPickerZIndexWorkaround(e){if(e!=null&&e.closest(".ui-dialog").length){var t=parseInt(e.closest(".ui-dialog").css("z-index"),10);t==null||isNaN(t)||setTimeout(()=>{var i=e.datepicker("widget");if(i!=null&&i.length){var r=parseInt(i.css("z-index"));!isNaN(r)&&r<=t&&i.css("z-index",t+1)}},0)}}};V.dateInputChange=function(e){var o,l;if(F.dateOrder==="dmy"){var t=$(e.target);if(!(!t.is(":input")||t.attr("type")=="date")){var i=(o=t.val())!=null?o:"",r={};if(i.length>=6&&/^[0-9]*$/g.test(i)&&t.val(i.substr(0,2)+F.dateSeparator+i.substr(2,2)+F.dateSeparator+i.substr(4)),i=(l=t.val())!=null?l:"",i.length>=5&&ln(i)!==!1){var a=ln(i);t.val(ee(a,null))}}}},h([m.option()],V.prototype,"yearRange",2),h([m.option()],V.prototype,"get_minValue",1),h([m.option()],V.prototype,"get_maxValue",1),h([m.option()],V.prototype,"get_maxDate",1),h([m.option()],V.prototype,"get_sqlMinMax",1),V=h([m.registerEditor("Serenity.DateEditor",[P,R]),m.element('<input type="text"/>')],V);function un(){if(!$.datepicker||!$.datepicker.regional||!$.datepicker.regional.en)return!1;let c=F.dateOrder,n=F.dateSeparator,e=($("html").attr("lang")||"en").toLowerCase();return $.datepicker.regional[e]||(e=e.split("-")[0],$.datepicker.regional[e]||(e="en")),$.datepicker.setDefaults($.datepicker.regional.en),$.datepicker.setDefaults($.datepicker.regional[e]),$.datepicker.setDefaults({dateFormat:c=="mdy"?"mm"+n+"dd"+n+"yy":c=="ymd"?"yy"+n+"mm"+n+"dd":"dd"+n+"mm"+n+"yy",buttonImage:"data:image/svg+xml,"+encodeURIComponent(pn),buttonImageOnly:!0,showOn:"both",showButtonPanel:!0,changeMonth:!0,changeYear:!0}),$.ui&&$.ui.version<="1.12.1"&&$.datepicker.setDefaults({buttonImage:null,buttonImageOnly:!1,buttonText:'<i class="fa fa-calendar"></i>'}),!0}typeof $!="undefined"&&$.fn&&!un()&&$(un);import{addOption as Ao,addValidationRule as qo,Culture as zi,format as cn,formatDate as ue,formatISODateTimeUTC as Wo,Invariant as hn,isEmptyOrNull as Pt,parseDate as Jo,parseISODateTime as ii,round as Mo,localText as mn,today as $o,trunc as zo,tryGetText as Ho}from"@serenity-is/corelib/q";var G=class extends b{constructor(e,t){var o,l,d,p;super(e,t);if(e.addClass("s-DateTimeEditor"),this.options.inputOnly)e.addClass("dateTimeQ");else if(typeof flatpickr!="undefined"&&(V.useFlatpickr||!$.fn.datepicker||this.options.seconds))e.addClass("dateTimeQ"),flatpickr(e[0],this.getFlatpickrOptions());else if($.fn.datepicker){e.addClass("dateQ"),e.datepicker({showOn:"button",beforeShow:function(){return e.hasClass("readonly")?!1:(V.uiPickerZIndexWorkaround(this.element),!0)},yearRange:(o=this.options.yearRange)!=null?o:"-100:+50"}),e.bind("change."+this.uniqueName,u=>{this.lastSetValue=null,V.dateInputChange(u)}),this.time=$("<select/>").addClass("editor s-DateTimeEditor time");var i=e.next(".ui-datepicker-trigger");i.length>0?this.time.insertAfter(i):(i=e.prev(".ui-datepicker-trigger"),i.length>0?this.time.insertBefore(i):this.time.insertAfter(e)),this.time.on("change",function(u){this.lastSetValue=null,e.triggerHandler("change")});var r=G.getTimeOptions((l=this.options.startHour)!=null?l:0,0,(d=this.options.endHour)!=null?d:23,59,(p=this.options.intervalMinutes)!=null?p:5);for(var a of r)Ao(this.time,a,a);qo(e,this.uniqueName,u=>{var g=this.get_value();return Pt(g)?null:!Pt(this.get_minValue())&&hn.stringCompare(g,this.get_minValue())<0?cn(mn("Validation.MinDate"),ue(this.get_minValue(),null)):!Pt(this.get_maxValue())&&hn.stringCompare(g,this.get_maxValue())>0?cn(mn("Validation.MaxDate"),ue(this.get_maxValue(),null)):null})}else e.attr("type","datetime").addClass("dateTimeQ");e.bind("keyup."+this.uniqueName,u=>{if(!this.get_readOnly()&&this.time)if(u.which===32)this.get_valueAsDate()!==new Date&&(this.set_valueAsDate(new Date),this.element.trigger("change"));else{var g=this.element.val();V.dateInputKeyup(u),g!=this.element.val()&&(this.lastSetValue=null)}}),this.set_sqlMinMax(!0),this.options.inputOnly||$("<i class='inplace-button inplace-now'><b></b></div>").attr("title",this.getInplaceNowText()).insertAfter(this.time).click(u=>{this.element.hasClass("readonly")||(this.lastSetValue=null,this.set_valueAsDate(new Date),e.triggerHandler("change"))})}getFlatpickrOptions(){var e;return{clickOpens:!0,allowInput:!0,enableTime:!0,time_24hr:!0,enableSeconds:!!this.options.seconds,minuteIncrement:(e=this.options.intervalMinutes)!=null?e:5,dateFormat:zi.dateOrder.split("").join(zi.dateSeparator).replace("y","Y")+" H:i"+(this.options.seconds?":S":""),onChange:()=>{this.lastSetValue=null,this.element&&this.element.triggerHandler("change")}}}get_value(){var e=this.element.val().trim();if(e!=null&&e.length===0)return null;var t;if(this.time){var i=ue(e,"yyyy-MM-dd"),r=this.time.val();t=i+"T"+r+":00.000"}else t=ue(Jo(this.element.val()),"yyyy-MM-ddTHH:mm:ss.fff");return this.options.useUtc&&(t=Wo(ii(t))),this.lastSetValue!=null&&this.lastSetValueGet==t?this.lastSetValue:t}get value(){return this.get_value()}set_value(e){var i;if(Pt(e))this.element.val(""),this.time&&this.time.val("00:00");else if(e.toLowerCase()==="today")this.time?(this.element.val(ue($o(),null)),this.time.val("00:00")):this.element.val(this.getDisplayFormat());else{var t=e.toLowerCase()==="now"?new Date:ii(e);this.time?(t=G.roundToMinutes(t,(i=this.options.intervalMinutes)!=null?i:5),this.element.val(ue(t,null)),this.time.val(ue(t,"HH:mm"))):this.element.val(ue(t,this.getDisplayFormat()))}this.lastSetValue=null,!Pt(e)&&e.toLowerCase()!="today"&&e.toLowerCase()!="now"&&(this.lastSetValueGet=this.get_value(),this.lastSetValue=e)}getInplaceNowText(){var e;return(e=Ho("Controls.DateTimeEditor.SetToNow"))!=null?e:"set to now"}getDisplayFormat(){return this.options.seconds?zi.dateTimeFormat:zi.dateTimeFormat.replace(":ss","")}set value(e){this.set_value(e)}get_valueAsDate(){return Pt(this.get_value())?null:ii(this.get_value())}get valueAsDate(){return this.get_valueAsDate()}set_valueAsDate(e){e==null&&this.set_value(null),this.set_value(ue(e,"yyyy-MM-ddTHH:mm"+(this.options.seconds?":ss":"")))}set valueAsDate(e){this.set_valueAsDate(e)}get_minValue(){return this.minValue}set_minValue(e){this.minValue=e}get_maxValue(){return this.maxValue}set_maxValue(e){this.maxValue=e}get_minDate(){return ii(this.get_minValue())}set_minDate(e){this.set_minValue(ue(e,"yyyy-MM-ddTHH:mm:ss"))}get_maxDate(){return ii(this.get_maxValue())}set_maxDate(e){this.set_maxValue(ue(e,"yyyy-MM-ddTHH:mm:ss"))}get_sqlMinMax(){return this.get_minValue()==="1753-01-01"&&this.get_maxValue()==="9999-12-31"}set_sqlMinMax(e){e?(this.set_minValue("1753-01-01"),this.set_maxValue("9999-12-31")):(this.set_minValue(null),this.set_maxValue(null))}get_readOnly(){return this.element.hasClass("readonly")}set_readOnly(e){e!==this.get_readOnly()&&(e?(this.element.addClass("readonly").attr("readonly","readonly"),this.element.nextAll(".ui-datepicker-trigger").css("opacity","0.1"),this.element.nextAll(".inplace-now").css("opacity","0.1")):(this.element.removeClass("readonly").removeAttr("readonly"),this.element.nextAll(".ui-datepicker-trigger").css("opacity","1"),this.element.nextAll(".inplace-now").css("opacity","1")),this.time&&w.setReadonly(this.time,e))}static roundToMinutes(e,t){e=new Date(e.getTime());var i=zo(Mo(e.getMinutes()/t)*t);return e.setMinutes(i),e.setSeconds(0),e.setMilliseconds(0),e}};G.getTimeOptions=function(e,t,i,r,a){var o=[];i>=23&&(i=23),r>=60&&(r=59);for(var l=e,d=t;!(l>i||l===i&&d>r);){var p=(l>=10?"":"0")+l+":"+(d>=10?"":"0")+d;o.push(p),d+=a,d>=60&&(d-=60,l++)}return o},h([m.option()],G.prototype,"get_minValue",1),h([m.option()],G.prototype,"get_maxValue",1),h([m.option()],G.prototype,"get_maxDate",1),h([m.option()],G.prototype,"get_sqlMinMax",1),G=h([m.registerEditor("Serenity.DateTimeEditor",[P,R]),m.element('<input type="text"/>')],G);import{addOption as as,toId as gn}from"@serenity-is/corelib/q";var Hi=class extends b{constructor(e,t){super(e,t);e.addClass("editor s-TimeEditor hour"),this.options.noEmptyOption||as(e,"","--");for(var i=this.options.startHour||0;i<=(this.options.endHour||23);i++)as(e,i.toString(),i<10?"0"+i:i.toString());this.minutes=$("<select/>").addClass("editor s-TimeEditor minute").insertAfter(e),this.minutes.change(()=>this.element.trigger("change"));for(var r=0;r<=59;r+=this.options.intervalMinutes||5)as(this.minutes,r.toString(),r<10?"0"+r:r.toString())}get value(){var e=gn(this.element.val()),t=gn(this.minutes.val());return e==null||t==null?null:e*60+t}get_value(){return this.value}set value(e){e?(this.element.val(Math.floor(e/60).toString()),this.minutes.val(e%60)):this.options.noEmptyOption?(this.element.val(this.options.startHour),this.minutes.val("0")):(this.element.val(""),this.minutes.val("0"))}set_value(e){this.value=e}get_readOnly(){return this.element.hasClass("readonly")}set_readOnly(e){e!==this.get_readOnly()&&(e?this.element.addClass("readonly").attr("readonly","readonly"):this.element.removeClass("readonly").removeAttr("readonly"),w.setReadonly(this.minutes,e))}};Hi=h([m.registerEditor("Serenity.TimeEditor",[Y,R]),m.element("<select />")],Hi);import{isEmptyOrNull as Ui,trimToNull as Uo,tryGetText as jo}from"@serenity-is/corelib/q";var Ft=class extends b{constructor(n,e){super(n,e),Ft.registerValidationMethods(),n.addClass("emailuser");var t=$("<span/>").text("@").addClass("emailat").insertAfter(n),i=$('<input type="text"/>').addClass("emaildomain").insertAfter(t);i.bind("blur."+this.uniqueName,function(){var r=i.closest("form").data("validator");r!=null&&r.element(n[0])}),Ui(this.options.domain)||i.val(this.options.domain),this.options.readOnlyDomain&&i.attr("readonly","readonly").addClass("disabled").attr("tabindex","-1"),n.bind("keypress."+this.uniqueName,r=>{r.which===64&&(r.preventDefault(),this.options.readOnlyDomain||(i.focus(),i.select()))}),i.bind("keypress."+this.uniqueName,function(r){r.which===64&&r.preventDefault()}),this.options.readOnlyDomain||n.change(r=>this.set_value(n.val()))}static registerValidationMethods(){var n;!$.validator||!$.validator.methods||$.validator.methods.emailuser!=null||$.validator.addMethod("emailuser",function(e,t){var i=$(t).nextAll(".emaildomain");return i.length>0&&i.attr("readonly")==null?this.optional(t)&&this.optional(i[0])?!0:$.validator.methods.email.call(this,e+"@"+i.val(),t):$.validator.methods.email.call(this,e+"@dummy.com",t)},(n=jo("Validation.Email"))!=null?n:$.validator.messages.email)}get_value(){var n=this.element.nextAll(".emaildomain"),e=this.element.val(),t=n.val();return Ui(e)?this.options.readOnlyDomain||Ui(t)?"":"@"+t:e+"@"+t}get value(){return this.get_value()}set_value(n){var e=this.element.nextAll(".emaildomain");if(n=Uo(n),n==null)this.options.readOnlyDomain||e.val(""),this.element.val("");else{var t=n.split("@");t.length>1?this.options.readOnlyDomain?Ui(this.options.domain)?this.element.val(t[0]):t[1]!==this.options.domain?this.element.val(n):this.element.val(t[0]):(e.val(t[1]),this.element.val(t[0])):this.element.val(t[0])}}set value(n){this.set_value(n)}get_readOnly(){var n=this.element.nextAll(".emaildomain");return!(this.element.attr("readonly")==null&&(!this.options.readOnlyDomain||n.attr("readonly")==null))}set_readOnly(n){var e=this.element.nextAll(".emaildomain");n?(this.element.attr("readonly","readonly").addClass("readonly"),this.options.readOnlyDomain||e.attr("readonly","readonly").addClass("readonly")):(this.element.removeAttr("readonly").removeClass("readonly"),this.options.readOnlyDomain||e.removeAttr("readonly").removeClass("readonly"))}};Ft=h([m.registerEditor("Serenity.EmailEditor",[P,R]),m.element('<input type="text"/>')],Ft);var ji=class extends se{constructor(n){super(n),n.attr("type","email").addClass("email")}};ji=h([m.registerEditor("Serenity.EmailAddressEditor")],ji);import{trimToNull as Ko}from"@serenity-is/corelib/q";var Ki=class extends se{constructor(n){super(n),n.addClass("url").attr("title","URL should be entered in format: 'http://www.site.com/page'."),n.on("blur."+this.uniqueName,e=>{var t=n.closest("form").data("validator");if(t!=null&&n.hasClass("error")){var i=Ko(n.val());i&&(i="http://"+i,$.validator.methods.url.call(t,i,n[0])==!0&&(n.val(i),t.element(n)))}})}};Ki=h([m.registerEditor("Serenity.URLEditor",[P])],Ki);import{Enum as fn,getAttributes as Yo,getLookup as Xo,isEmptyOrNull as Yi,tryGetText as Zo}from"@serenity-is/corelib/q";var Xi=class extends b{constructor(n,e){var y;if(super(n,e),!(Yi(this.options.enumKey)&&this.options.enumType==null&&Yi(this.options.lookupKey)))if(Yi(this.options.lookupKey)){var d=this.options.enumType||He.get(this.options.enumKey),p=this.options.enumKey;if(p==null&&d!=null){var u=Yo(d,z,!1);u.length>0&&(p=u[0].value)}var g=fn.getValues(d);for(var v of g){var f=fn.toString(d,v);this.addRadio(v.toString(),(y=Zo("Enums."+p+"."+f))!=null?y:f)}}else{var t=Xo(this.options.lookupKey);for(var i of t.items){var r=i[t.textField],a=r==null?"":r.toString(),o=i[t.idField],l=o==null?"":o.toString();this.addRadio(l,a)}}}addRadio(n,e){var t=$("<label/>").text(e);$('<input type="radio"/>').attr("name",this.uniqueName).attr("id",this.uniqueName+"_"+n).attr("value",n).prependTo(t),t.appendTo(this.element)}get_value(){return this.element.find("input:checked").first().val()}get value(){return this.get_value()}set_value(n){if(n!==this.get_value()){var e=this.element.find("input"),t=e.filter(":checked");t.length>0&&(t[0].checked=!1),Yi(n)||(t=e.filter("[value="+n+"]"),t.length>0&&(t[0].checked=!0))}}set value(n){this.set_value(n)}get_readOnly(){return this.element.attr("disabled")!=null}set_readOnly(n){this.get_readOnly()!==n&&(n?this.element.attr("disabled","disabled").find("input").attr("disabled","disabled"):this.element.removeAttr("disabled").find("input").removeAttr("disabled"))}};Xi=h([m.registerEditor("Serenity.RadioButtonEditor",[P,R]),m.element("<div/>")],Xi);import{any as os,Authorization as el,isArray as ls,isEmptyOrNull as Se,isTrimmedEmpty as tl,startsWith as il,localText as Et,trimToEmpty as rl,trimToNull as yn}from"@serenity-is/corelib/q";var L=class extends b{constructor(e,t){super(e,t);this._items=[],this._itemById={};var i=this.emptyItemText();i!=null&&e.attr("placeholder",i);var r=this.getSelect2Options();e.select2(r),e.attr("type","text"),e.on("change."+this.uniqueName,(a,o)=>{o!==!0&&e.closest("form").data("validator")&&e.valid()}),this.setCascadeFrom(this.options.cascadeFrom),this.useInplaceAdd()&&this.addInplaceCreate(Et("Controls.SelectEditor.InplaceAdd"),null)}destroy(){var e,t,i,r;(t=(e=this.initSelectionPromise)==null?void 0:e.abort)==null||t.call(e),this.abortPendingQuery(),(r=(i=this.element)==null?void 0:i.select2)==null||r.call(i,"destroy"),super.destroy()}hasAsyncSource(){return!1}asyncSearch(e,t){return t({items:[],more:!1}),null}getTypeDelay(){var e;return(e=this.options.typeDelay)!=null?e:200}emptyItemText(){var e;return(e=this.element.attr("placeholder"))!=null?e:Et("Controls.SelectEditor.EmptyItemText")}getPageSize(){var e;return(e=this.options.pageSize)!=null?e:100}getIdField(){return this.options.idField}itemId(e){var t=e[this.getIdField()];return t==null?"":t.toString()}getTextField(){var e;return(e=this.options.textField)!=null?e:this.getIdField()}itemText(e){var t=e[this.getTextField()];return t==null?"":t.toString()}itemDisabled(e){return!1}mapItem(e){return{id:this.itemId(e),text:this.itemText(e),disabled:this.itemDisabled(e),source:e}}mapItems(e){return e.map(this.mapItem.bind(this))}allowClear(){return this.options.allowClear!=null?!!this.options.allowClear:this.emptyItemText()!=null}isMultiple(){return!!this.options.multiple}abortPendingQuery(){var e,t;(t=(e=this.queryPromise)==null?void 0:e.abort)==null||t.call(e),this.queryPromise=null,this.typeTimeout&&(clearTimeout(this.typeTimeout),this.typeTimeout=null)}getSelect2Options(){var e=this.emptyItemText(),t={multiple:this.isMultiple(),placeHolder:Se(e)?null:e,allowClear:this.allowClear(),createSearchChoicePosition:"bottom"};return this.hasAsyncSource()?(t.query=i=>{var l,d;var r=this.getPageSize(),a={searchTerm:yn(i.term),skip:(i.page-1)*r,take:r,checkMore:!0};this.abortPendingQuery();var o=$(this.element).data("select2");(d=(l=o==null?void 0:o.search)==null?void 0:l.removeClass)==null||d.call(l,"select2-active").parent().removeClass("select2-active"),this.typeTimeout=setTimeout(()=>{var p,u,g,v,f;this.abortPendingQuery(),(u=(p=o==null?void 0:o.search)==null?void 0:p.addClass)==null||u.call(p,"select2-active").parent().addClass("select2-active"),this.queryPromise=this.asyncSearch(a,y=>{var C,S;(S=(C=o==null?void 0:o.search)==null?void 0:C.removeClass)==null||S.call(C,"select2-active").parent().removeClass("select2-active"),this.queryPromise=null,i.callback({results:this.mapItems(y.items),more:y.more})}),(f=((g=this.queryPromise)==null?void 0:g.catch)||((v=this.queryPromise)==null?void 0:v.fail))==null||f.call(this.queryPromise,()=>{var y,C;this.queryPromise=null,(C=(y=o==null?void 0:o.search)==null?void 0:y.removeClass)==null||C.call(y,"select2-active").parent().removeClass("select2-active")})},i.term?this.getTypeDelay():0)},t.initSelection=(i,r)=>{var p,u,g;var a=i.val();if(a==null||a==""){r(null);return}var o=this.isMultiple(),l=o?a.split(","):[a],d={idList:l};(u=(p=this.initSelectionPromise)==null?void 0:p.abort)==null||u.call(p),this.initSelectionPromise=this.asyncSearch(d,v=>{if(this.initSelectionPromise=null,o){var f=(v.items||[]).map(S=>this.mapItem(S));this._itemById=this._itemById||{};for(var y of f)this._itemById[y.id]=y;if(this.isAutoComplete&&f.length!=l.length)for(var C of l)os(f,S=>S.id==C)||f.push({id:C,text:C});r(f)}else if(!v.items||!v.items.length)this.isAutoComplete?r({id:a,text:a}):r(null);else{var y=this.mapItem(v.items[0]);this._itemById=this._itemById||{},this._itemById[y.id]=y,r(y)}}),(g=this.initSelectionPromise.catch||this.initSelectionPromise.fail)==null||g.call(this.initSelectionPromise,()=>{this.initSelectionPromise=null})}):(t.data=this._items,t.query=i=>{var r=L.filterByText(this._items,o=>o.text,i.term),a=this.getPageSize();i.callback({results:r.slice((i.page-1)*a,i.page*a),more:r.length>=i.page*a})},t.initSelection=(i,r)=>{var a=i.val(),o=this.isAutoComplete();if(this.isMultiple()){var l=[];for(var d of a.split(",")){var p=this._itemById[d];p==null&&o&&(p={id:d,text:d},this.addItem(p)),p!=null&&l.push(p)}r(l);return}var u=this._itemById[a];u==null&&o&&(u={id:a,text:a},this.addItem(u)),r(u)}),this.options.minimumResultsForSearch!=null&&(t.minimumResultsForSearch=this.options.minimumResultsForSearch),(this.isAutoComplete()||this.useInplaceAdd())&&(t.createSearchChoice=this.getCreateSearchChoice(null)),t}get_delimited(){return!!this.options.delimited}get items(){if(this.hasAsyncSource())throw new Error("Can't read items property of an async select editor!");return this._items||[]}set items(e){if(this.hasAsyncSource())throw new Error("Can't set items of an async select editor!");this._items=e||[],this._itemById={};for(var t of this._items)this._itemById[t.id]=t}get itemById(){if(this.hasAsyncSource())throw new Error("Can't read items property of an async select editor!");return this._itemById}set itemById(e){if(this.hasAsyncSource())throw new Error("Can't set itemById of an async select editor!");this._itemById=e||{}}clearItems(){if(this.hasAsyncSource())throw new Error("Can't clear items of an async select editor!");this._items.length=0,this._itemById={}}addItem(e){if(this.hasAsyncSource())throw new Error("Can't add item to an async select editor!");this._items.push(e),this._itemById[e.id]=e}addOption(e,t,i,r){this.addItem({id:e,text:t,source:i,disabled:r})}addInplaceCreate(e,t){var i=this;e=e!=null?e:Et("Controls.SelectEditor.InplaceAdd"),t=t!=null?t:Et("Controls.SelectEditor.InplaceEdit");var r=$("<a><b/></a>").addClass("inplace-button inplace-create").attr("title",e).insertAfter(this.element).click(function(a){i.inplaceCreateClick(a)});this.get_select2Container().add(this.element).addClass("has-inplace-button"),this.element.change(()=>{var a=this.isMultiple()||Se(this.get_value());r.attr("title",a?e:t).toggleClass("edit",!a)}),this.element.change((a,o)=>{if(o!==!0)if(this.isMultiple()){var l=this.get_values();l.length>0&&l[l.length-1]==(-2147483648).toString()&&(this.set_values(l.slice(0,l.length-1)),this.inplaceCreateClick(a))}else this.get_value()==(-2147483648).toString()&&(this.set_value(null),this.inplaceCreateClick(a))}),this.isMultiple()&&this.get_select2Container().on("dblclick."+this.uniqueName,".select2-search-choice",a=>{var o=$(a.target);o.hasClass("select2-search-choice")||(o=o.closest(".select2-search-choice"));var l=o.index(),d=this.get_values();l<0||l>=this.get_values().length||(a.editItem=d[l],this.inplaceCreateClick(a))})}useInplaceAdd(){return!this.isAutoComplete()&&this.options.inplaceAdd&&(this.options.inplaceAddPermission==null||el.hasPermission(this.options.inplaceAddPermission))}isAutoComplete(){return!!this.options.autoComplete}getCreateSearchChoice(e){return t=>{var r;if(this.lastCreateTerm=t,t=((r=Select2.util.stripDiacritics(t))!=null?r:"").toLowerCase(),tl(t))return null;var i=!1;return os(this._items||[],a=>{var o=e?e(a.source):a.text;return Select2.util.stripDiacritics(o!=null?o:"").toLowerCase()==t})?null:os(this._items||[],a=>{var o;return((o=Select2.util.stripDiacritics(a.text))!=null?o:"").toLowerCase().indexOf(t)!==-1})?this.isAutoComplete()?{id:this.lastCreateTerm,text:this.lastCreateTerm}:{id:(-2147483648).toString(),text:Et("Controls.SelectEditor.ClickToDefine")}:this.isAutoComplete()?{id:this.lastCreateTerm,text:this.lastCreateTerm}:{id:(-2147483648).toString(),text:Et("Controls.SelectEditor.NoResultsClickToDefine")}}}setEditValue(e,t){var i=e[t.name];ls(i)?this.set_values(i):this.set_value(i==null?null:i.toString())}getEditValue(e,t){!this.isMultiple()||this.get_delimited()?t[e.name]=this.get_value():t[e.name]=this.get_values()}get_select2Container(){return this.element.prevAll(".select2-container")}get_items(){return this.items}get_itemByKey(){return this.itemById}static filterByText(e,t,i){if(i==null||i.length==0)return e;i=Select2.util.stripDiacritics(i).toUpperCase();var r=[];function a(o){var l=t(o);return l==null||!l.length?!1:(l=Select2.util.stripDiacritics(l).toUpperCase(),il(l,i)?!0:(l.indexOf(i)>=0&&r.push(o),!1))}return e.filter(a).concat(r)}get_value(){var e;if(this.element.data("select2")){if(e=this.element.select2("val"),e!=null&&ls(e))return e.join(",")}else e=this.element.val();return e}get value(){return this.get_value()}set_value(e){if(e!=this.get_value()){var t=e;!Se(e)&&this.isMultiple()&&(t=e.split(String.fromCharCode(44)).map(function(r){return yn(r)}).filter(function(r){return r!=null}));var i=this.element;i.select2("val",t),i.data("select2-change-triggered",!0);try{i.triggerHandler("change",[!0])}finally{i.data("select2-change-triggered",!1)}this.updateInplaceReadOnly()}}set value(e){this.set_value(e)}get selectedItem(){let e=this.get_value();if(e&&this._itemById){let t=this._itemById[e];if(t)return t.source}return null}get selectedItems(){let e=this.values;var t=[];for(var i of e)if(i&&this._itemById){let r=this._itemById[i];r&&r.source?t.push(r.source):t.push(null)}return t}get_values(){var e=this.element.select2("val");if(e==null)return[];if(ls(e))return e;var t=e;return Se(t)?[]:[t]}get values(){return this.get_values()}set_values(e){if(e==null||e.length===0){this.set_value(null);return}this.set_value(e.join(","))}set values(e){this.set_values(e)}get_text(){var e;return((e=this.element.select2("data"))!=null?e:{}).text}get text(){return this.get_text()}get_readOnly(){return!Se(this.element.attr("readonly"))}get readOnly(){return this.get_readOnly()}updateInplaceReadOnly(){var e=this.get_readOnly()&&(this.isMultiple()||!this.value);this.element.nextAll(".inplace-create").attr("disabled",e?"disabled":"").css("opacity",e?"0.1":"").css("cursor",e?"default":"")}set_readOnly(e){e!==this.get_readOnly()&&(this.element.attr("readonly",e?"readonly":null),this.updateInplaceReadOnly())}set readOnly(e){this.set_readOnly(e)}getCascadeFromValue(e){return w.getValue(e)}setCascadeFrom(e){if(Se(e)){this.cascadeLink!=null&&(this.cascadeLink.set_parentID(null),this.cascadeLink=null),this.options.cascadeFrom=null;return}this.cascadeLink=new je(b,this,t=>{this.set_cascadeValue(this.getCascadeFromValue(t))}),this.cascadeLink.set_parentID(e),this.options.cascadeFrom=e}get_cascadeFrom(){return this.options.cascadeFrom}get cascadeFrom(){return this.get_cascadeFrom()}set_cascadeFrom(e){e!==this.options.cascadeFrom&&(this.setCascadeFrom(e),this.updateItems())}set cascadeFrom(e){this.set_cascadeFrom(e)}get_cascadeField(){var e;return(e=this.options.cascadeField)!=null?e:this.options.cascadeFrom}get cascadeField(){return this.get_cascadeField()}set_cascadeField(e){this.options.cascadeField=e}set cascadeField(e){this.set_cascadeField(e)}get_cascadeValue(){return this.options.cascadeValue}get cascadeValue(){return this.get_cascadeValue()}set_cascadeValue(e){this.options.cascadeValue!==e&&(this.options.cascadeValue=e,this.set_value(null),this.updateItems())}set cascadeValue(e){this.set_cascadeValue(e)}get_filterField(){return this.options.filterField}get filterField(){return this.get_filterField()}set_filterField(e){this.options.filterField=e}set filterField(e){this.set_filterField(e)}get_filterValue(){return this.options.filterValue}get filterValue(){return this.get_filterValue()}set_filterValue(e){this.options.filterValue!==e&&(this.options.filterValue=e,this.set_value(null),this.updateItems())}set filterValue(e){this.set_filterValue(e)}cascadeItems(e){var t=this.get_cascadeValue();if(t==null||t==="")return Se(this.get_cascadeField())?e:[];var i=t.toString(),r=this.get_cascadeField();return e.filter(a=>{var l;var o=(l=a[r])!=null?l:re.getPropertyValue(a,r);return o!=null&&o.toString()===i})}filterItems(e){var t=this.get_filterValue();if(t==null||t==="")return e;var i=t.toString(),r=this.get_filterField();return e.filter(a=>{var l;var o=(l=a[r])!=null?l:re.getPropertyValue(a,r);return o!=null&&o.toString()===i})}updateItems(){}getDialogTypeKey(){return this.options.dialogType!=null?this.options.dialogType:null}createEditDialog(e){var t=this.getDialogTypeKey(),i=ht.get(t);b.create({type:i,init:r=>e(r)})}initNewEntity(e){Se(this.get_cascadeField())||(e[this.get_cascadeField()]=this.get_cascadeValue()),Se(this.get_filterField())||(e[this.get_filterField()]=this.get_filterValue()),this.onInitNewEntity!=null&&this.onInitNewEntity(e)}setEditDialogReadOnly(e){e.element&&e.element.find(".tool-button.delete-button").addClass("disabled").unbind("click")}editDialogDataChange(){}setTermOnNewEntity(e,t){}inplaceCreateClick(e){this.get_readOnly()&&(this.isMultiple()&&!e.editItem||!this.value)||this.createEditDialog(t=>{this.get_readOnly()&&this.setEditDialogReadOnly(t),xe.bindToDataChange(t,this,(a,o)=>{if(this.editDialogDataChange(),this.updateItems(),this.lastCreateTerm=null,(o.type==="create"||o.type==="update")&&o.entityId!=null){var l=o.entityId.toString();if(this.isMultiple()){var d=this.get_values().slice();d.indexOf(l)<0&&d.push(l),this.set_values(null),this.set_values(d.slice())}else this.set_value(null),this.set_value(l)}else if(this.isMultiple()&&o.type==="delete"&&o.entityId!=null){var p=o.entityId.toString(),u=this.get_values().slice(),g=u.indexOf(p);g>=0&&u.splice(g,1),this.set_values(u.slice())}else this.isMultiple()||this.set_value(null)},!0);var i=e.editItem;if(i!=null)t.load(i,()=>{t.dialogOpen(this.openDialogAsPanel)},null);else if(this.isMultiple()||Se(this.get_value())){var r={};this.setTermOnNewEntity(r,rl(this.lastCreateTerm)),this.initNewEntity(r),t.load(r,()=>{t.dialogOpen(this.openDialogAsPanel)},null)}else t.load(this.get_value(),()=>{t.dialogOpen(this.openDialogAsPanel)},null)})}};L=h([m.registerClass("Serenity.Select2Editor",[Z,X,P,R]),m.element('<input type="hidden"/>')],L);import{isEmptyOrNull as sl}from"@serenity-is/corelib/q";var Ke=class extends L{constructor(n,e){super(n,e),this.updateItems()}getItems(){return this.options.items||[]}emptyItemText(){return sl(this.options.emptyOptionText)?super.emptyItemText():this.options.emptyOptionText}updateItems(){var a;var n=this.getItems();if(this.clearItems(),n.length>0){var e=typeof n[0]=="string";for(var t of n){var i=e?t:t[0],r=e?t:(a=t[1])!=null?a:t[0];this.addOption(i,r,t,!1)}}}};Ke=h([m.registerClass("Serenity.SelectEditor")],Ke);import{startsWith as Zi}from"@serenity-is/corelib/q";var er=class extends Ke{constructor(n,e){super(n,e),this.updateItems()}getItems(){var o,l;var n=this.options;if(n.items!=null&&n.items.length>=1)return n.items;var e=[],t=new Date().getFullYear(),i=new Date().getFullYear();if(n.minYear=((o=n.minYear)!=null?o:"-10").toString(),Zi(n.minYear,"-")?t-=parseInt(n.minYear.substr(1),10):Zi(n.minYear,"+")?t+=parseInt(n.minYear.substr(1),10):t=parseInt(n.minYear,10),n.maxYear=((l=n.maxYear)!=null?l:"+10").toString(),Zi(n.maxYear,"-")?i-=parseInt(n.maxYear.substr(1),10):Zi(n.maxYear,"+")?i+=parseInt(n.maxYear.substr(1),10):i=parseInt(n.maxYear,10),n.descending)for(var r=i;r>=t;r--)e.push(r.toString());else for(var a=t;a<=i;a++)e.push(a.toString());return e}};er=h([m.registerEditor("Serenity.DateYearEditor")],er);import{Enum as vn,getAttributes as nl,tryGetText as al}from"@serenity-is/corelib/q";var Rt=class extends L{constructor(n,e){super(n,e),this.updateItems()}updateItems(){var o;this.clearItems();var n=this.options.enumType||He.get(this.options.enumKey),e=this.options.enumKey;if(e==null&&n!=null){var t=nl(n,z,!1);t.length>0&&(e=t[0].value)}var i=vn.getValues(n);for(var r of i){var a=vn.toString(n,r);this.addOption(parseInt(r,10).toString(),(o=al("Enums."+e+"."+a))!=null?o:a,null,!1)}}allowClear(){var n;return(n=this.options.allowClear)!=null?n:!0}};Rt=h([m.registerEditor("Serenity.EnumEditor")],Rt);import{endsWith as ol,getInstanceType as ll,getLookup as dl,getLookupAsync as ul,getTypeFullName as pl,reloadLookup as cl,ScriptData as bn}from"@serenity-is/corelib/q";var ri=class extends L{constructor(e,t){super(e,t);if(!this.hasAsyncSource()){this.updateItems();var i=this;bn.bindToChange("Lookup."+this.getLookupKey(),this.uniqueName,function(){i.hasAsyncSource()||i.updateItems()})}}hasAsyncSource(){return!!this.options.async}destroy(){this.hasAsyncSource()||bn.unbindFromChange(this.uniqueName),super.destroy()}getLookupKey(){if(this.options.lookupKey!=null)return this.options.lookupKey;var e=pl(ll(this)),t=e.indexOf(".");return t>=0&&(e=e.substring(t+1)),ol(e,"Editor")&&(e=e.substr(0,e.length-6)),e}getLookupAsync(){return ul(this.getLookupKey())}getLookup(){return dl(this.getLookupKey())}getItems(e){return this.filterItems(this.cascadeItems(e.items))}getIdField(){return this.lookup!=null?this.lookup.idField:super.getIdField()}getItemText(e,t){if(t==null)return super.itemText(e);var i=t.textFormatter?t.textFormatter(e):e[t.textField];return i==null?"":i.toString()}mapItem(e){return{id:this.itemId(e),text:this.getItemText(e,this.lookup),disabled:this.getItemDisabled(e,this.lookup),source:e}}getItemDisabled(e,t){return super.itemDisabled(e)}updateItems(){if(!this.hasAsyncSource()){this.clearItems(),this.lookup=this.getLookup();var e=this.getItems(this.lookup);for(var t of e)this.addItem(this.mapItem(t))}}asyncSearch(e,t){return this.getLookupAsync().then(i=>{this.lookup=i;var r=this.getItems(this.lookup);e.idList!=null&&(r=r.filter(o=>e.idList.indexOf(this.itemId(o))>=0));function a(o){return this.getItemText(o,this.lookup)}r=L.filterByText(r,a.bind(this),e.searchTerm),t({items:r.slice(e.skip,e.take),more:r.length>=e.take})})}getDialogTypeKey(){var e=super.getDialogTypeKey();return e||this.getLookupKey()}setCreateTermOnNewEntity(e,t){e[this.getLookup().textField]=t}editDialogDataChange(){cl(this.getLookupKey())}};ri=h([m.registerEditor("Serenity.LookupEditorBase")],ri);var Vt=class extends ri{constructor(n,e){super(n,e)}};Vt=h([m.registerEditor("Serenity.LookupEditor")],Vt);import{ColumnSelection as hl,Criteria as si,isEmptyOrNull as ml,resolveUrl as gl,serviceCall as fl,startsWith as tr}from"@serenity-is/corelib/q";var ni=class extends L{constructor(n,e){super(n,e)}getDialogTypeKey(){var n=super.getDialogTypeKey();if(n)return n;var e=this.getService();return tr(e,"~/Services/")&&(e=e.substr(11)),e.split("/").length==3&&(e=e.substr(0,e.lastIndexOf("/"))),e.replace("/",".")}getService(){return this.options.service}getServiceUrl(){var n=this.getService();if(n==null)throw new Error("ServiceLookupEditor requires 'service' option to be configured!");return!tr(n,"~")&&!tr(n,"/")&&n.indexOf("://")<0&&(n="~/Services/"+n),tr(n,"~")&&(n=gl(n)),n}getIncludeColumns(){var n=this.options.includeColumns||[],e=this.getIdField();e&&n.indexOf(e)<0&&n.push(e);var t=this.getTextField();return t&&n.indexOf(t)<0&&n.push(t),n}getSort(){return this.options.sort||(this.getTextField()?[this.getTextField()]:null)}getCascadeCriteria(){var n=this.get_cascadeValue();if(n==null||n==="")return ml(this.get_cascadeField())?null:["0","=","1"];var e=this.get_cascadeField();return si(e).eq(n)}getFilterCriteria(){var n=this.get_filterValue();if(n==null||n==="")return null;var e=this.get_filterField();return[[e],"=",n]}getIdListCriteria(n){if(n==null)return null;if(n.length==0)return["0","=","1"];var e=this.getIdField();if(e==null)throw new Error("ServiceLookupEditor requires 'idField' option to be configured!");return si(e).in(n)}getCriteria(n){return si.and(si.and(this.getIdListCriteria(n.idList),this.options.criteria),si.and(this.getCascadeCriteria(),this.getFilterCriteria()))}getListRequest(n){var e={};return n.searchTerm&&(e.ContainsText=n.searchTerm),e.Sort=this.getSort(),e.ColumnSelection=this.options.columnSelection||hl.KeyOnly,e.IncludeColumns=this.getIncludeColumns(),e.ExcludeColumns=this.options.excludeColumns,e.ContainsField=this.options.containsField,e.EqualityFilter=this.options.equalityFilter,e.Criteria=this.getCriteria(n),e.Skip=n.skip||0,e.Take=n.take?n.checkMore?n.take+1:n.take:0,e.IncludeDeleted=this.options.includeDeleted,e.ExcludeTotalCount=!0,e}getServiceCallOptions(n,e){return{blockUI:!1,url:this.getServiceUrl(),request:this.getListRequest(n),onSuccess:t=>{var i=t.Entities||[];i&&n.take&&n.checkMore&&t.Entities.length>i.length&&(i=i.slice(0,n.take)),e({items:i.slice(0,n.take),more:n.checkMore&&n.take&&i.length>n.take})}}}hasAsyncSource(){return!0}asyncSearch(n,e){var t=this.getServiceCallOptions(n,e);return fl(t)}};ni=h([m.registerEditor("Serenity.ServiceLookupEditorBase")],ni);var Qt=class extends ni{constructor(n,e){super(n,e)}};Qt=h([m.registerEditor("Serenity.ServiceLookupEditor")],Qt);import{endsWith as yl,isEmptyOrNull as vl,isTrimmedEmpty as bl,resolveUrl as Cn,localText as Cl,trimToNull as xn}from"@serenity-is/corelib/q";var ne=class extends b{constructor(e,t){super(e,t);this._instanceReady=!1,ne.includeCKEditor();var i=e.attr("id");bl(i)&&(e.attr("id",this.uniqueName),i=this.uniqueName),this.options.cols!=null&&e.attr("cols",this.options.cols),this.options.rows!=null&&e.attr("rows",this.options.rows),this.addValidationRule(this.uniqueName,r=>{if(r.hasClass("required")){var a=xn(this.get_value());if(a==null)return Cl("Validation.Required")}return null}),ve.executeOnceWhenShown(this.element,()=>{var r=this.getConfig();window.CKEDITOR&&window.CKEDITOR.replace(i,r)})}instanceReady(e){this._instanceReady=!0,$(e.editor.container.$).addClass(this.element.attr("class")),this.element.addClass("select2-offscreen").css("display","block"),e.editor.setData(this.element.val()),e.editor.setReadOnly(this.get_readOnly())}getLanguage(){var i;if(!window.CKEDITOR)return"en";var e=window.CKEDITOR,t=(i=xn($("html").attr("lang")))!=null?i:"en";return e.lang.languages[t]||(t.indexOf(String.fromCharCode(45))>=0&&(t=t.split(String.fromCharCode(45))[0]),e.lang.languages[t])?t:"en"}getConfig(){return{customConfig:"",language:this.getLanguage(),bodyClass:"s-HtmlContentBody",on:{instanceReady:e=>this.instanceReady(e),change:e=>{e.editor.updateElement(),this.element.triggerHandler("change")}},toolbarGroups:[{name:"clipboard",groups:["clipboard","undo"]},{name:"editing",groups:["find","selection","spellchecker"]},{name:"insert",groups:["links","insert","blocks","bidi","list","indent"]},{name:"forms",groups:["forms","mode","document","doctools","others","about","tools"]},{name:"colors"},{name:"basicstyles",groups:["basicstyles","cleanup"]},{name:"align"},{name:"styles"}],removeButtons:"SpecialChar,Anchor,Subscript,Styles",format_tags:"p;h1;h2;h3;pre",removeDialogTabs:"image:advanced;link:advanced",removePlugins:"uploadimage,image2",contentsCss:Cn("~/Content/site/site.htmlcontent.css"),entities:!1,entities_latin:!1,entities_greek:!1,autoUpdateElement:!0,height:this.options.rows==null||this.options.rows===0?null:this.options.rows*20+"px"}}getEditorInstance(){var e=this.element.attr("id");return window.CKEDITOR.instances[e]}destroy(){var e=this.getEditorInstance();e&&e.destroy(!0),super.destroy()}get_value(){var e=this.getEditorInstance();return this._instanceReady&&e?e.getData():this.element.val()}get value(){return this.get_value()}set_value(e){var t=this.getEditorInstance();this.element.val(e),this._instanceReady&&t&&t.setData(e)}set value(e){this.set_value(e)}get_readOnly(){return!vl(this.element.attr("disabled"))}set_readOnly(e){if(this.get_readOnly()!==e){e?this.element.attr("disabled","disabled"):this.element.removeAttr("disabled");var t=this.getEditorInstance();this._instanceReady&&t&&t.setReadOnly(e)}}static getCKEditorBasePath(){var e=ne.CKEditorBasePath;if(e==null)if(typeof CKEDITOR_BASEPATH!="undefined"&&CKEDITOR_BASEPATH)e=CKEDITOR_BASEPATH;else return"~/Serenity.Assets/Scripts/ckeditor/";return yl(e,"/")?e:e+"/"}static includeCKEditor(){if(!window.CKEDITOR){var e=$("#CKEditorScript");e.length>0||$("<script/>").attr("type","text/javascript").attr("id","CKEditorScript").attr("src",Cn(ne.getCKEditorBasePath()+"ckeditor.js?v="+ne.CKEditorVer)).appendTo(window.document.head)}}};ne.CKEditorVer="4.7.1",ne=h([m.registerEditor("Serenity.HtmlContentEditor",[P,R]),m.element("<textarea/>")],ne);var ir=class extends ne{constructor(n,e){super(n,e)}getConfig(){var n=super.getConfig();return n.removeButtons+=",Cut,Copy,Paste,BulletedList,NumberedList,Indent,Outdent,SpecialChar,Subscript,Superscript,Styles,PasteText,PasteFromWord,Strike,Link,Unlink,CreatePlaceholder,Image,Table,HorizontalRule,Source,Maximize,Format,Font,FontSize,Anchor,Blockquote,CreatePlaceholder,BGColor,JustifyLeft,JustifyCenter,JustifyRight,JustifyBlock,Superscript,RemoveFormat",n.removePlugins="elementspath,uploadimage,image2",n}};ir=h([m.registerEditor("Serenity.HtmlNoteContentEditor")],ir);var rr=class extends ne{constructor(n,e){super(n,e)}getConfig(){var n=super.getConfig();return n.removeButtons+=",Cut,Copy,Paste,BulletedList,NumberedList,Indent,Outdent,SpecialChar,Subscript,Superscript,Styles,PasteText,PasteFromWord,Strike,Link,Unlink,CreatePlaceholder,Image,Table,HorizontalRule,Source,Maximize,Format,Font,FontSize,Anchor,Blockquote,CreatePlaceholder,BGColor,JustifyLeft,JustifyCenter,JustifyRight,JustifyBlock,Superscript,RemoveFormat",n.removePlugins="elementspath,uploadimage,image2",n}};rr=h([m.registerEditor("Serenity.HtmlReportContentEditor")],rr);var sr=class extends b{constructor(n,e){var t;super(n,e),n.mask(this.options.mask||"",{placeholder:(t=this.options.placeholder)!=null?t:"_"})}get value(){return this.element.triggerHandler("blur.mask"),this.element.val()}get_value(){return this.value}set value(n){this.element.val(n)}set_value(n){this.value=n}};sr=h([m.registerEditor("Serenity.MaskedEditor",[P]),m.element('<input type="text"/>')],sr);import{addValidationRule as xl,isEmptyOrNull as Il,localText as Sl}from"@serenity-is/corelib/q";var nr=class extends b{constructor(n,e){var d;if(super(n,e),this.element.addClass("g-recaptcha").attr("data-sitekey",this.options.siteKey),window.grecaptcha==null&&$("script#RecaptchaInclude").length===0){var t="https://www.google.com/recaptcha/api.js",i=this.options.language;i==null&&(i=(d=$("html").attr("lang"))!=null?d:""),t+="?hl="+i,$("<script/>").attr("id","RecaptchaInclude").attr("src",t).appendTo(document.body)}var r=$("<input />").insertBefore(this.element).attr("id",this.uniqueName+"_validate").val("x"),a={};a.visibility="hidden",a.width="0px",a.height="0px",a.padding="0px";var o=r.css(a),l=this;xl(o,this.uniqueName,p=>Il(this.get_value())?Sl("Validation.Required"):null)}get_value(){return this.element.find(".g-recaptcha-response").val()}set_value(n){}};nr=h([m.registerEditor("Serenity.Recaptcha",[P]),m.element("<div/>")],nr);import{alertDialog as yt,htmlEncode as ar,blockUI as Tl,blockUndo as kl,endsWith as or,format as Nt,iframeDialog as Ol,isEmptyOrNull as In,notifyError as Bt,replaceAll as wl,resolveUrl as Sn,round as Tn,startsWith as _l,localText as pe}from"@serenity-is/corelib/q";var Te;(d=>{function c(p){p.container.addClass("fileinput-button");var u=p.uploadUrl||"~/File/TemporaryUpload";p.uploadIntent&&(u.indexOf("?")<0?u+="?":u+="&",u+="uploadIntent=",u+=encodeURIComponent(p.uploadIntent));var g=$("<input/>").attr("type","file").attr("name",p.inputName+"[]").attr("data-url",Sn(u)).appendTo(p.container);return p.allowMultiple&&g.attr("multiple","multiple"),g.fileupload({dataType:"json",dropZone:p.zone,pasteZone:p.zone,done:function(v,f){var y=f.result;if(y.Error){Bt(y.Error.Message);return}p.fileDone!=null&&p.fileDone(y,f.files[0].name,f)},fail:function(v,f){var O;var y=(O=f==null?void 0:f._response)==null?void 0:O.jqXHR;if(!y){Bt("An error occurred during file upload.");return}if((y.getResponseHeader("content-type")||"").toLowerCase().indexOf("application/json")>=0){var C=$.parseJSON(y.responseText);if(C&&C.Error&&C.Error.Message){Bt(C.Error.Message);return}}var S=y.responseText;if(S){Ol({html:S});return}if(!y.status){y.statusText!="abort"&&Bt("An unknown connection error occurred! Check browser console for details.");return}if(y.status==500){Bt("HTTP 500: Connection refused! Check browser console for details.");return}Bt("HTTP "+y.status+" error! Check browser console for details.")},start:function(){Tl(null),p.progress!=null&&p.progress.show()},stop:function(){kl(),p.progress!=null&&p.progress.hide()},progress:function(v,f){if(p.progress!=null){var y=f.loaded/f.total*100;p.progress.children().css("width",y.toString()+"%")}}}),g}d.addUploadInput=c;function n(p,u){return!p.IsImage&&!u.allowNonImage?(yt(pe("Controls.ImageUpload.NotAnImageFile")),!1):u.minSize>0&&p.Size<u.minSize?(yt(Nt(pe("Controls.ImageUpload.UploadFileTooSmall"),t(u.minSize))),!1):u.maxSize>0&&p.Size>u.maxSize?(yt(Nt(pe("Controls.ImageUpload.UploadFileTooBig"),t(u.maxSize))),!1):p.IsImage?u.minWidth>0&&p.Width<u.minWidth?(yt(Nt(pe("Controls.ImageUpload.MinWidth"),u.minWidth)),!1):u.maxWidth>0&&p.Width>u.maxWidth?(yt(Nt(pe("Controls.ImageUpload.MaxWidth"),u.maxWidth)),!1):u.minHeight>0&&p.Height<u.minHeight?(yt(Nt(pe("Controls.ImageUpload.MinHeight"),u.minHeight)),!1):u.maxHeight>0&&p.Height>u.maxHeight?(yt(Nt(pe("Controls.ImageUpload.MaxHeight"),u.maxHeight)),!1):!0:!0}d.checkImageConstraints=n;function e(p,u){return p+" ("+t(u)+")"}d.fileNameSizeDisplay=e;function t(p){var u=Tn(p*100/1024)*.01,g="KB";u>=1024&&(u=Tn(u*100/1024)*.01,g="MB");var v=u.toString().split(String.fromCharCode(46)),f;return v.length>1?f=v[0]+"."+v[1].substr(0,2):f=v[0],f+" "+g}d.fileSizeDisplay=t;function i(p){return In(p)?!1:(p=p.toLowerCase(),or(p,".jpg")||or(p,".jpeg")||or(p,".gif")||or(p,".png"))}d.hasImageExtension=i;function r(p){p=p!=null?p:"";var u=p.lastIndexOf(".");return u>=0&&(p=p.substr(0,u)),p+"_t.jpg"}d.thumbFileName=r;function a(p){return p=wl(p!=null?p:"","\\","/"),Sn("~/upload/")+p}d.dbFileUrl=a;function o(p,u){p.colorbox({current:ar(pe("Controls.ImageUpload.ColorboxCurrent")),previous:ar(pe("Controls.ImageUpload.ColorboxPrior")),next:ar(pe("Controls.ImageUpload.ColorboxNext")),close:ar(pe("Controls.ImageUpload.ColorboxClose"))})}d.colorBox=o;function l(p,u,g,v){var I;u=u||[],p.html("");for(var f=0;f<u.length;f++){var y=u[f],C=$("<li/>").addClass("file-item").data("index",f),S=i(y.Filename);S?C.addClass("file-image"):C.addClass("file-binary");var O="#"+f,T=$("<a/>").addClass("thumb").appendTo(C),_=(I=y.OriginalName)!=null?I:"",x=y.Filename;v!=null&&x!=null&&!_l(x,"temporary/")&&(x=v+x),T.attr("href",a(x)),T.attr("target","_blank"),In(_)||T.attr("title",_),S&&(T.css("backgroundImage","url('"+a(r(y.Filename))+"')"),o(T,new Object)),g&&$("<div/>").addClass("filename").text(_).attr("title",_).appendTo(C),C.appendTo(p)}}d.populateFileSymbols=l})(Te||(Te={}));import{endsWith as Dl,extend as ur,isEmptyOrNull as kn,isInstanceOfType as Pl,isTrimmedEmpty as On,replaceAll as Fl,startsWith as El,localText as ds,trimToNull as oi}from"@serenity-is/corelib/q";var ai=class extends b{constructor(e,t){super(e,t);(!t||t.allowNonImage==null)&&(this.options.allowNonImage=!0),e.addClass("s-FileUploadEditor"),kn(this.options.originalNameProperty)&&e.addClass("hide-original-name"),this.toolbar=new A($("<div/>").appendTo(this.element),{buttons:this.getToolButtons()}),this.progress=$("<div><div></div></div>").addClass("upload-progress").prependTo(this.toolbar.element);var i=this.getUploadInputOptions();this.uploadInput=Te.addUploadInput(i),this.fileSymbols=$("<ul/>").appendTo(this.element),this.element.attr("id")||this.element.attr("id",this.uniqueName),this.hiddenInput=$('<input type="text" class="s-offscreen" name="'+this.uniqueName+'_Validator" data-vx-highlight="'+this.element.attr("id")+'"/>').appendTo(this.element),this.updateInterface()}getUploadInputOptions(){return{container:this.toolbar.findButton("add-file-button"),zone:this.element,inputName:this.uniqueName,progress:this.progress,uploadIntent:this.options.uploadIntent,uploadUrl:this.options.uploadUrl,fileDone:(e,t,i)=>{if(Te.checkImageConstraints(e,this.options)){var r={OriginalName:t,Filename:e.TemporaryFile};this.entity=r,this.populate(),this.updateInterface();var a=this.hiddenInput.closest("form").data("validator");a!=null&&a.element(this.hiddenInput)}}}}addFileButtonText(){return ds("Controls.ImageUpload.AddFileButton")}getToolButtons(){return[{title:this.addFileButtonText(),cssClass:"add-file-button",onClick:function(){}},{title:"",hint:ds("Controls.ImageUpload.DeleteButtonHint"),cssClass:"delete-button",onClick:()=>{this.entity=null,this.populate(),this.updateInterface();var e=this.hiddenInput.closest("form").data("validator");e!=null&&e.element(this.hiddenInput)}}]}populate(){var e=this.options.displayFileName||!On(this.options.originalNameProperty);this.entity==null?Te.populateFileSymbols(this.fileSymbols,null,e,this.options.urlPrefix):Te.populateFileSymbols(this.fileSymbols,[this.entity],e,this.options.urlPrefix),this.hiddenInput.val(oi((this.get_value()||{}).Filename))}updateInterface(){var e=this.toolbar.findButton("add-file-button"),t=this.toolbar.findButton("delete-button");e.toggleClass("disabled",this.get_readOnly()),t.toggleClass("disabled",this.get_readOnly()||this.entity==null)}get_readOnly(){return this.uploadInput.attr("disabled")!=null}set_readOnly(e){if(this.get_readOnly()!==e){if(e){this.uploadInput.attr("disabled","disabled");try{this.uploadInput.fileupload("disable")}catch(t){}}else{this.uploadInput.removeAttr("disabled");try{this.uploadInput.fileupload("enable")}catch(t){}}this.updateInterface()}}get_required(){return this.hiddenInput.hasClass("required")}set_required(e){this.hiddenInput.toggleClass("required",!!e)}get_value(){if(this.entity==null)return null;var e=ur({},this.entity);return e}get value(){return this.get_value()}set_value(e){var t=e;if(typeof t=="string"){var t=oi(t);if(e!=null){var i=t.indexOf("/");i<0&&(i=t.indexOf("\\")),e={Filename:e,OriginalName:t.substring(i+1)}}}else e!=null&&On(e.Filename)&&(e=null);e!=null?e.Filename==null?this.entity=null:this.entity=ur({},e):this.entity=null,this.populate();var r=this.hiddenInput.closest("form").data("validator");r!=null&&r.element(this.hiddenInput),this.updateInterface()}set value(e){this.set_value(e)}getEditValue(e,t){t[e.name]=this.entity==null?null:oi(this.entity.Filename)}setEditValue(e,t){var o;var i={};if(i.Filename=e[t.name],kn(this.options.originalNameProperty)){if(this.options.displayFileName){var r=(o=i.Filename)!=null?o:"",a=Fl(r,"\\","/").lastIndexOf("/");a>=0?i.OriginalName=r.substr(a+1):i.OriginalName=r}}else i.OriginalName=e[this.options.originalNameProperty];this.set_value(i)}};ai=h([m.registerEditor("Serenity.FileUploadEditor",[R,X,Z,Ve]),m.element("<div/>")],ai);var lr=class extends ai{constructor(n,e){super(n,e),e&&e.allowNonImage==null&&(this.options.allowNonImage=!1),n.addClass("s-ImageUploadEditor")}};lr=h([m.registerEditor("Serenity.ImageUploadEditor")],lr);var Lt=class extends b{constructor(e,t){super(e,t);this.entities=[],e.addClass("s-MultipleFileUploadEditor");var i=this;this.toolbar=new A($("<div/>").appendTo(this.element),{buttons:this.getToolButtons()}),this.progress=$("<div><div></div></div>").addClass("upload-progress").prependTo(this.toolbar.element),this.uploadInput=Te.addUploadInput(this.getUploadInputOptions()),this.fileSymbols=$("<ul/>").appendTo(this.element),this.element.attr("id")||this.element.attr("id",this.uniqueName),this.hiddenInput=$('<input type="text" class="s-offscreen" name="'+this.uniqueName+'_Validator" data-vx-highlight="'+this.element.attr("id")+'" multiple="multiple"></input>').appendTo(this.element),this.updateInterface()}getUploadInputOptions(){var e=this.toolbar.findButton("add-file-button");return{container:e,zone:this.element,inputName:this.uniqueName,progress:this.progress,uploadIntent:this.options.uploadIntent,uploadUrl:this.options.uploadUrl,allowMultiple:!0,fileDone:(t,i)=>{if(Te.checkImageConstraints(t,this.options)){var r={OriginalName:i,Filename:t.TemporaryFile};this.entities.push(r),this.populate();var a=this.hiddenInput.closest("form").data("validator");a!=null&&a.element(this.hiddenInput),this.updateInterface()}}}}addFileButtonText(){return ds("Controls.ImageUpload.AddFileButton")}getToolButtons(){return[{title:this.addFileButtonText(),cssClass:"add-file-button",onClick:function(){}}]}populate(){Te.populateFileSymbols(this.fileSymbols,this.entities,!0,this.options.urlPrefix),this.fileSymbols.children().each((e,t)=>{var i=e;$("<a class='delete'></a>").appendTo($(t).children(".filename")).click(r=>{r.preventDefault(),this.entities.splice(i,1),this.populate();var a=this.hiddenInput.closest("form").data("validator");a!=null&&a.element(this.hiddenInput)})}),this.hiddenInput.val(oi((this.get_value()[0]||{}).Filename))}updateInterface(){var e=this.toolbar.findButton("add-file-button");e.toggleClass("disabled",this.get_readOnly()),this.fileSymbols.find("a.delete").toggle(!this.get_readOnly())}get_readOnly(){return this.uploadInput.attr("disabled")!=null}set_readOnly(e){if(this.get_readOnly()!==e){if(e){this.uploadInput.attr("disabled","disabled");try{this.uploadInput.fileupload("disable")}catch(t){}}else{this.uploadInput.removeAttr("disabled");try{this.uploadInput.fileupload("enable")}catch(t){}}this.updateInterface()}}get_required(){return this.hiddenInput.hasClass("required")}set_required(e){this.hiddenInput&&this.hiddenInput.toggleClass("required",!!e)}get_value(){return this.entities.map(function(e){return ur({},e)})}get value(){return this.get_value()}set_value(e){this.entities=(e||[]).map(function(t){return ur({},t)}),this.populate(),this.updateInterface()}set value(e){this.set_value(e)}getEditValue(e,t){this.jsonEncodeValue?t[e.name]=JSON.stringify(this.get_value()):t[e.name]=this.get_value()}setEditValue(e,t){var a;var i=e[t.name];if(Pl(i,String)){var r=(a=oi(i))!=null?a:"[]";El(r,"[")&&Dl(r,"]")?this.set_value($.parseJSON(r)):this.set_value([{Filename:r,OriginalName:"UnknownFile"}])}else this.set_value(i)}};h([m.option()],Lt.prototype,"jsonEncodeValue",2),Lt=h([m.registerEditor("Serenity.MultipleFileUploadEditor",[R,X,Z,Ve]),m.element("<div/>")],Lt);var dr=class extends Lt{constructor(n,e){super(n,e),n.addClass("s-MultipleImageUploadEditor")}};dr=h([m.registerEditor("Serenity.MultipleImageUploadEditor")],dr);import{ArgumentNullException as Rl,Criteria as Ye,delegateCombine as Vl,delegateRemove as Ql,formatDate as Nl,isArray as wn,isEmptyOrNull as H,isTrimmedEmpty as pr,notifyWarning as cr,parseDate as hr,localText as Gt,toId as Bl,tryGetText as us}from"@serenity-is/corelib/q";var q=class extends b{constructor(e,t){var o;super(e,t);e.addClass("quick-filters-bar").addClass("clear");for(var i=this.options.filters,r=0;r<i.length;r++){var a=i[r];this.add(a)}this.options.idPrefix=(o=this.options.idPrefix)!=null?o:this.uniqueName+"_"}addSeparator(){this.element.append($("<hr/>"))}add(e){var l;if(e==null)throw new Rl("opt");e.separator&&this.addSeparator();var t=$("<div class='quick-filter-item'><span class='quick-filter-label'></span></div>").appendTo(this.element).data("qffield",e.field).children(),i=(l=us(e.title))!=null?l:e.title;i==null&&(i=this.options.getTitle?this.options.getTitle(e):null,i==null&&(i=e.field));var r=t.text(i).parent();e.displayText!=null&&r.data("qfdisplaytext",e.displayText),e.saveState!=null&&r.data("qfsavestate",e.saveState),e.loadState!=null&&r.data("qfloadstate",e.loadState),H(e.cssClass)||r.addClass(e.cssClass);var a=b.create({type:e.type,element:d=>{H(e.field)||d.attr("id",this.options.idPrefix+e.field),d.attr("placeholder"," "),d.appendTo(r),e.element!=null&&e.element(d)},options:e.options,init:e.init}),o=d=>{if(!r.hasClass("ignore")){d.EqualityFilter=d.EqualityFilter||{};var p=w.getValue(a),u=p!=null&&!H(p.toString());if(e.handler!=null){var g={field:e.field,request:d,equalityFilter:d.EqualityFilter,value:p,active:u,widget:a,handled:!0};e.handler(g),r.toggleClass("quick-filter-active",g.active),g.handled||(d.EqualityFilter[e.field]=p)}else d.EqualityFilter[e.field]=p,r.toggleClass("quick-filter-active",u)}};return a.changeSelect2(d=>{window.setTimeout(()=>this.onChange&&this.onChange(d),0)}),this.add_submitHandlers(o),a.element.bind("remove."+this.uniqueName,d=>{this.remove_submitHandlers(o)}),a}addDateRange(e,t){return this.add(q.dateRange(e,t))}static dateRange(e,t){var i=null;return{field:e,type:V,title:t,element:function(r){i=b.create({type:V,element:function(a){a.insertAfter(r)},options:null,init:null}),i.element.change(function(a){r.triggerHandler("change")}),$("<span/>").addClass("range-separator").text("-").insertAfter(r)},handler:function(r){var a=!pr(r.widget.value),o=!pr(i.value);if(a&&!hr(r.widget.element.val())&&(a=!1,cr(Gt("Validation.DateInvalid"),"",null),r.widget.element.val("")),o&&!hr(i.element.val())&&(o=!1,cr(Gt("Validation.DateInvalid"),"",null),i.element.val("")),r.active=a||o,a&&(r.request.Criteria=Ye.and(r.request.Criteria,Ye(r.field).ge(r.widget.value))),o){var l=new Date(i.valueAsDate.valueOf());l.setDate(l.getDate()+1),r.request.Criteria=Ye.and(r.request.Criteria,Ye(r.field).lt(Nl(l,"yyyy-MM-dd")))}},displayText:function(r,a){var u;var o=w.getDisplayText(r),l=w.getDisplayText(i);if(H(o)&&H(l))return null;var d=a+" >= "+o,p=a+" <= "+l;return!H(o)&&!H(l)?d+" "+((u=us("Controls.FilterPanel.And"))!=null?u:"and")+" "+p:H(o)?p:d},saveState:function(r){return[w.getValue(r),w.getValue(i)]},loadState:function(r,a){(a==null||!wn(a)||a.length!==2)&&(a=[null,null]),w.setValue(r,a[0]),w.setValue(i,a[1])}}}addDateTimeRange(e,t){return this.add(q.dateTimeRange(e,t))}static dateTimeRange(e,t,i){var r=null;return{field:e,type:G,title:t,element:function(a){r=b.create({type:G,element:function(o){o.insertAfter(a)},options:i==null?null:{useUtc:i},init:null}),r.element.change(function(o){a.triggerHandler("change")}),$("<span/>").addClass("range-separator").text("-").insertAfter(a)},init:function(a){a.element.parent().find(".time").change(function(o){a.element.triggerHandler("change")})},handler:function(a){var o=!pr(a.widget.value),l=!pr(r.value);o&&!hr(a.widget.element.val())&&(o=!1,cr(Gt("Validation.DateInvalid"),"",null),a.widget.element.val("")),l&&!hr(r.element.val())&&(l=!1,cr(Gt("Validation.DateInvalid"),"",null),r.element.val("")),a.active=o||l,o&&(a.request.Criteria=Ye.and(a.request.Criteria,Ye(a.field).ge(a.widget.value))),l&&(a.request.Criteria=Ye.and(a.request.Criteria,Ye(a.field).le(r.value)))},displayText:function(a,o){var g;var l=w.getDisplayText(a),d=w.getDisplayText(r);if(H(l)&&H(d))return null;var p=o+" >= "+l,u=o+" <= "+d;return!H(l)&&!H(d)?p+" "+((g=us("Controls.FilterPanel.And"))!=null?g:"and")+" "+u:H(l)?u:p},saveState:function(a){return[w.getValue(a),w.getValue(r)]},loadState:function(a,o){(o==null||!wn(o)||o.length!==2)&&(o=[null,null]),w.setValue(a,o[0]),w.setValue(r,o[1])},options:i==null?null:{useUtc:i}}}addBoolean(e,t,i,r){return this.add(q.boolean(e,t,i,r))}static boolean(e,t,i,r){var a={},o=[],l=i;l==null&&(l=Gt("Controls.FilterPanel.OperatorNames.true")),o.push(["1",l]);var d=r;return d==null&&(d=Gt("Controls.FilterPanel.OperatorNames.false")),o.push(["0",d]),a.items=o,{field:e,type:Ke,title:t,options:a,handler:function(p){p.equalityFilter[p.field]=p.value==null||H(p.value.toString())?null:!!Bl(p.value)}}}destroy(){this.submitHandlers=null,super.destroy()}onSubmit(e){this.submitHandlers&&this.submitHandlers(e)}add_submitHandlers(e){this.submitHandlers=Vl(this.submitHandlers,e)}remove_submitHandlers(e){this.submitHandlers=Ql(this.submitHandlers,e)}clear_submitHandlers(){}find(e,t){return $("#"+this.options.idPrefix+t).getWidget(e)}tryFind(e,t){var i=$("#"+this.options.idPrefix+t);return i.length?i.tryGetWidget(e):null}};q=h([m.registerClass("Serenity.QuickFilterBar"),m.element("<div/>")],q);import{isEmptyOrNull as _n,isValue as Ll,localText as ps,trim as mr}from"@serenity-is/corelib/q";var te=class extends b{constructor(e,t){var d,p;super(e,t);e.attr("title",ps("Controls.QuickSearch.Hint")).attr("placeholder",ps("Controls.QuickSearch.Placeholder")),this.lastValue=mr((d=e.val())!=null?d:"");var i=this;if(this.element.bind("keyup."+this.uniqueName,function(){i.checkIfValueChanged()}),this.element.bind("change."+this.uniqueName,function(){i.checkIfValueChanged()}),$("<span><i></i></span>").addClass("quick-search-icon").insertBefore(e),Ll(this.options.fields)&&this.options.fields.length>0){var r=$("<a/>").addClass("quick-search-field").attr("title",ps("Controls.QuickSearch.FieldSelection")).insertBefore(e),a=$("<ul></ul>").css("width","120px");for(var o of this.options.fields){var l={$:o};$("<li><a/></li>").appendTo(a).children().attr("href","#").text((p=o.title)!=null?p:"").click(function(u){u.preventDefault(),this.$this.fieldChanged=i.field!==this.field.$,i.field=this.field.$,this.$this.updateInputPlaceHolder(),this.$this.checkIfValueChanged()}.bind({field:l,$this:this}))}new gt(r,{positionMy:"right top",positionAt:"right bottom",menu:a}),this.field=this.options.fields[0],this.updateInputPlaceHolder()}this.element.bind("execute-search."+this.uniqueName,u=>{var g;this.timer&&window.clearTimeout(this.timer),this.searchNow(mr((g=this.element.val())!=null?g:""))})}checkIfValueChanged(){var i;if(!this.element.hasClass("ignore-change")){var e=this.get_value();if(e==this.lastValue&&(!this.fieldChanged||_n(e))){this.fieldChanged=!1;return}this.fieldChanged=!1,this.timer&&window.clearTimeout(this.timer);var t=this;this.timer=window.setTimeout(function(){t.searchNow(e)},(i=this.options.typeDelay)!=null?i:500),this.lastValue=e}}get_value(){var e;return mr((e=this.element.val())!=null?e:"")}get_field(){return this.field}set_field(e){this.field!==e&&(this.fieldChanged=!0,this.field=e,this.updateInputPlaceHolder(),this.checkIfValueChanged())}updateInputPlaceHolder(){var e=this.element.prevAll(".quick-search-field");this.field?e.text(this.field.title):e.text("")}restoreState(i,t){this.fieldChanged=!1,this.field=t;var i=mr(i!=null?i:"");this.element.val(i),this.lastValue=i,this.timer&&(window.clearTimeout(this.timer),this.timer=null),this.updateInputPlaceHolder()}searchNow(e){var i,r,a;this.element.parent().toggleClass((i=this.options.filteredParentClass)!=null?i:"s-QuickSearchFiltered",e.length>0),this.element.parent().addClass((r=this.options.loadingParentClass)!=null?r:"s-QuickSearchLoading").addClass((a=this.options.loadingParentClass)!=null?a:"s-QuickSearchLoading");var t=o=>{var d,p;if(this.element.removeClass((d=this.options.loadingParentClass)!=null?d:"s-QuickSearchLoading").parent().removeClass((p=this.options.loadingParentClass)!=null?p:"s-QuickSearchLoading"),!o){var l=this.element.closest(".s-QuickSearchBar").find(".quick-search-icon i")[0];l&&(l.classList.add("s-shake-effect"),setTimeout(()=>l.classList.remove("s-shake-effect"),2e3))}};this.options.onSearch!=null?this.options.onSearch(this.field!=null&&!_n(this.field.name)?this.field.name:null,e,t):t(!0)}};te=h([m.registerClass("Serenity.QuickSearchInput")],te);var k;(y=>(y.isTrue="true",y.isFalse="false",y.contains="contains",y.startsWith="startswith",y.EQ="eq",y.NE="ne",y.GT="gt",y.GE="ge",y.LT="lt",y.LE="le",y.BW="bw",y.IN="in",y.isNull="isnull",y.isNotNull="isnotnull",y.toCriteriaOperator={eq:"=",ne:"!=",gt:">",ge:">=",lt:"<",le:"<="}))(k||(k={}));import{ArgumentNullException as Gl,Criteria as ce,Culture as Al,delegateCombine as ql,delegateRemove as Wl,localText as Jl,tryGetText as Dn}from"@serenity-is/corelib/q";var ae=class{constructor(n){if(this.items=[],n==null)throw new Gl("source");this.fields=n.slice(),this.get_fields().sort(function(t,i){var r=Dn(t.title);r==null&&(r=t.title,r==null&&(r=t.name));var a=Dn(i.title);return a==null&&(a=i.title,a==null&&(a=i.name)),Al.stringCompare(r,a)}),this.fieldByName={};for(var e of n)this.get_fieldByName()[e.name]=e}static getCriteriaFor(n){if(n==null)return[""];for(var e=!1,t=[""],i=!1,r=[""],a=0;a<n.length;a++){var o=n[a];(o.leftParen||e&&o.rightParen)&&(ce.isEmpty(t)||(e&&(t=ce.paren(t)),i?r=ce.or(r,t):r=ce.and(r,t),t=[""]),e=!1),o.leftParen&&(i=o.isOr,e=!0),o.isOr?t=ce.or(t,o.criteria):t=ce.and(t,o.criteria)}return ce.isEmpty(t)||(i?r=ce.or(r,ce.paren(t)):r=ce.and(r,ce.paren(t))),r}static getDisplayTextFor(n){if(n==null)return"";for(var e=!1,t="",i=0;i<n.length;i++){var r=n[i];e&&(r.rightParen||r.leftParen)&&(t+=")",e=!1),t.length>0&&(t+=" "+Jl("Controls.FilterPanel."+(r.isOr?"Or":"And"))+" "),r.leftParen&&(t+="(",e=!0),t+=r.displayText}return e&&(t+=")"),t}get_fields(){return this.fields}get_fieldByName(){return this.fieldByName}get_items(){return this.items}raiseChanged(){this.displayText=null,this.changed&&this.changed(this,{})}add_changed(n){this.changed=ql(this.changed,n)}remove_changed(n){this.changed=Wl(this.changed,n)}get_activeCriteria(){return ae.getCriteriaFor(this.items)}get_displayText(){return this.displayText==null&&(this.displayText=ae.getDisplayTextFor(this.items)),this.displayText}};ae=h([m.registerClass("Serenity.FilterStore")],ae);import{ArgumentNullException as Rn,Config as Ml,Criteria as li,deepClone as xr,endsWith as $l,Exception as Ir,extend as Sr,format as bt,formatDate as Pn,getInstanceType as Fn,getTypeFullName as cs,getTypes as zl,isAssignableFrom as Hl,isEmptyOrNull as hs,parseISODateTime as Ul,startsWith as jl,localText as Kl,tryGetText as En}from"@serenity-is/corelib/q";var Xe=class{};Xe=h([m.registerInterface("Serenity.IFiltering")],Xe);var Ct=class{};Ct=h([m.registerInterface("Serenity.IQuickFiltering")],Ct);var xt=class{get_field(){return this.field}set_field(n){this.field=n}get_container(){return this.container}set_container(n){this.container=n}get_operator(){return this.operator}set_operator(n){this.operator=n}appendNullableOperators(n){return this.isNullable()&&(n.push({key:k.isNotNull}),n.push({key:k.isNull})),n}appendComparisonOperators(n){return n.push({key:k.EQ}),n.push({key:k.NE}),n.push({key:k.LT}),n.push({key:k.LE}),n.push({key:k.GT}),n.push({key:k.GE}),n}isNullable(){return this.get_field().required!==!0}createEditor(){switch(this.get_operator().key){case"true":case"false":case"isnull":case"isnotnull":return;case"contains":case"startswith":case"eq":case"ne":case"lt":case"le":case"gt":case"ge":{this.get_container().html('<input type="text"/>');return}}throw new Ir(bt("Filtering '{0}' has no editor for '{1}' operator",cs(Fn(this)),this.get_operator().key))}operatorFormat(n){var e,t;return(t=(e=n.format)!=null?e:En("Controls.FilterPanel.OperatorFormats."+n.key))!=null?t:n.key}getTitle(n){var e,t;return(t=En(n.title))!=null?t:(e=n.title)!=null?e:n.name}displayText(n,e){return!e||e.length===0?bt(this.operatorFormat(n),this.getTitle(this.field)):e.length===1?bt(this.operatorFormat(n),this.getTitle(this.field),e[0]):bt(this.operatorFormat(n),this.getTitle(this.field),e[0],e[1])}getCriteriaField(){return this.field.name}getCriteria(){var n={},e,t=li(this.getCriteriaField()),i=this.get_operator().key;switch(i){case"true":return n.displayText=this.displayText(this.get_operator(),[]),n.criteria=t.eq(!0),n;case"false":return n.displayText=this.displayText(this.get_operator(),[]),n.criteria=t.eq(!1),n;case"isnull":return n.displayText=this.displayText(this.get_operator(),[]),n.criteria=t.isNull(),n;case"isnotnull":return n.displayText=this.displayText(this.get_operator(),[]),n.criteria=t.isNotNull(),n;case"contains":return e=this.getEditorText(),n.displayText=this.displayText(this.get_operator(),[e]),n.criteria=t.contains(e),n;case"startswith":return e=this.getEditorText(),n.displayText=this.displayText(this.get_operator(),[e]),n.criteria=t.startsWith(e),n;case"eq":case"ne":case"lt":case"le":case"gt":case"ge":return e=this.getEditorText(),n.displayText=this.displayText(this.get_operator(),[e]),n.criteria=t[i](this.getEditorValue()),n}throw new Ir(bt("Filtering '{0}' has no handler for '{1}' operator",cs(Fn(this)),this.get_operator().key))}loadState(n){var e=this.get_container().find(":input").first();e.val(n)}saveState(){switch(this.get_operator().key){case"contains":case"startswith":case"eq":case"ne":case"lt":case"le":case"gt":case"ge":{var n=this.get_container().find(":input").first();return n.val()}}return null}argumentNull(){return new Rn("value",Kl("Controls.FilterPanel.ValueRequired"))}validateEditorValue(n){if(n.length===0)throw this.argumentNull();return n}getEditorValue(){var t;var n=this.get_container().find(":input").not(".select2-focusser").first();if(n.length!==1)throw new Ir(bt("Couldn't find input in filter container for {0}",(t=this.field.title)!=null?t:this.field.name));var e;return n.data("select2")!=null?e=n.select2("val"):e=n.val(),e=(e!=null?e:"").trim(),this.validateEditorValue(e)}getEditorText(){var t;var n=this.get_container().find(":input").not(".select2-focusser").not(".select2-input").first();if(n.length===0)return this.get_container().text().trim();var e;return n.data("select2")!=null?e=((t=n.select2("data"))!=null?t:{}).text:e=n.val(),e}initQuickFilter(n){n.field=this.getCriteriaField(),n.type=se,n.title=this.getTitle(this.field),n.options=xr(this.get_field().quickFilterParams)}};xt=h([m.registerClass("Serenity.BaseFiltering",[Xe,Ct])],xt);function he(c){return m.registerClass("Serenity."+c+"Filtering")}var oe=class extends xt{constructor(e){super();this.editorType=e}useEditor(){switch(this.get_operator().key){case"eq":case"ne":case"lt":case"le":case"gt":case"ge":return!0}return!1}createEditor(){if(this.useEditor()){this.editor=b.create({type:this.editorType,container:this.get_container(),options:this.getEditorOptions(),init:null});return}this.editor=null,super.createEditor()}useIdField(){return!1}getCriteriaField(){return this.useEditor()&&this.useIdField()&&!hs(this.get_field().filteringIdField)?this.get_field().filteringIdField:super.getCriteriaField()}getEditorOptions(){var e=xr(this.get_field().editorParams||{});return delete e.cascadeFrom,Sr(e,this.get_field().filteringParams)}loadState(e){if(this.useEditor()){if(e==null)return;w.setValue(this.editor,e);return}super.loadState(e)}saveState(){return this.useEditor()?w.getValue(this.editor):super.saveState()}getEditorValue(){if(this.useEditor()){var e=w.getValue(this.editor);if(e==null||typeof e=="string"&&e.trim().length===0)throw this.argumentNull();return e}return super.getEditorValue()}initQuickFilter(e){super.initQuickFilter(e),e.type=this.editorType,e.options=Sr(Sr({},xr(this.getEditorOptions())),xr(this.get_field().quickFilterParams))}};oe=h([he("BaseEditor")],oe);var At=class extends oe{constructor(){super(V)}getOperators(){return this.appendNullableOperators(this.appendComparisonOperators([]))}};At=h([he("Date")],At);var qt=class extends xt{getOperators(){return this.appendNullableOperators([{key:k.isTrue},{key:k.isFalse}])}};qt=h([he("Boolean")],qt);var Wt=class extends oe{constructor(){super(G)}getOperators(){return this.appendNullableOperators(this.appendComparisonOperators([]))}getCriteria(){var n={};switch(this.get_operator().key){case"eq":case"ne":case"lt":case"le":case"gt":case"ge":{{var e=this.getEditorText();n.displayText=this.displayText(this.get_operator(),[e]);var t=Ul(this.getEditorValue());t=new Date(t.getFullYear(),t.getMonth(),t.getDate());var i=new Date(t.getFullYear(),t.getMonth(),t.getDate()+1),r=li(this.getCriteriaField()),a=Pn(t,"yyyy-MM-dd"),o=Pn(i,"yyyy-MM-dd");switch(this.get_operator().key){case"eq":return n.criteria=li.and(r.ge(a),r.lt(o)),n;case"ne":return n.criteria=li.paren(li.or(r.lt(a),r.gt(o))),n;case"lt":return n.criteria=r.lt(a),n;case"le":n.criteria=r.lt(o);case"gt":return n.criteria=r.ge(o),n;case"ge":return n.criteria=r.ge(a),n}}break}}return super.getCriteria()}};Wt=h([he("DateTime")],Wt);var gr=class extends oe{constructor(){super(Ie)}getOperators(){return this.appendNullableOperators(this.appendComparisonOperators([]))}};gr=h([he("Decimal")],gr);var vt=class extends oe{constructor(){super(b)}getOperators(){var e=[];return e.push({key:k.EQ}),e.push({key:k.NE}),this.useRelative&&(e.push({key:k.LT}),e.push({key:k.LE}),e.push({key:k.GT}),e.push({key:k.GE})),this.useLike&&(e.push({key:k.contains}),e.push({key:k.startsWith})),this.appendNullableOperators(e),e}useEditor(){var e=this.get_operator().key;return e===k.EQ||e===k.NE||this.useRelative&&(e===k.LT||e===k.LE||e===k.GT||e===k.GE)}getEditorOptions(){var t;var e=super.getEditorOptions();return this.useEditor()&&this.editorType===((t=this.get_field().editorType)!=null?t:"String")&&(e=Sr(e,this.get_field().editorParams)),e}createEditor(){if(this.useEditor()){var e=mt.get(this.editorType);this.editor=b.create({type:e,element:t=>t.appendTo(this.get_container()),options:this.getEditorOptions()});return}super.createEditor()}useIdField(){return this.useEditor()}initQuickFilter(e){super.initQuickFilter(e),e.type=mt.get(this.editorType)}};h([m.option()],vt.prototype,"editorType",2),h([m.option()],vt.prototype,"useRelative",2),h([m.option()],vt.prototype,"useLike",2),vt=h([he("Editor")],vt);var fr=class extends oe{constructor(){super(Rt)}getOperators(){var n=[{key:k.EQ},{key:k.NE}];return this.appendNullableOperators(n)}};fr=h([he("Enum")],fr);var yr=class extends oe{constructor(){super(Dt)}getOperators(){return this.appendNullableOperators(this.appendComparisonOperators([]))}};yr=h([he("Integer")],yr);var vr=class extends oe{constructor(){super(Vt)}getOperators(){var n=[{key:k.EQ},{key:k.NE},{key:k.contains},{key:k.startsWith}];return this.appendNullableOperators(n)}useEditor(){var n=this.get_operator().key;return n==k.EQ||n==k.NE}useIdField(){return this.useEditor()}getEditorText(){return this.useEditor()?this.editor.text:super.getEditorText()}};vr=h([he("Lookup")],vr);var br=class extends oe{constructor(){super(Qt)}getOperators(){var n=[{key:k.EQ},{key:k.NE},{key:k.contains},{key:k.startsWith}];return this.appendNullableOperators(n)}useEditor(){var n=this.get_operator().key;return n==k.EQ||n==k.NE}useIdField(){return this.useEditor()}getEditorText(){return this.useEditor()?this.editor.text:super.getEditorText()}};br=h([he("ServiceLookup")],br);var Cr=class extends xt{getOperators(){var n=[{key:k.contains},{key:k.startsWith},{key:k.EQ},{key:k.NE}];return this.appendNullableOperators(n)}validateEditorValue(n){return n.length===0?n:super.validateEditorValue(n)}};Cr=h([he("String")],Cr);var Jt;(r=>{let c;function n(){if(c==null){c={};for(var a of zl())if(Hl(Xe,a)){var o=cs(a).toLowerCase();c[o]=a;for(var l of Ml.rootNamespaces)if(jl(o,l.toLowerCase()+".")){var d=o.substr(l.length+1).toLowerCase();c[d]==null&&(c[d]=a)}}e()}}function e(){var a="filtering";for(var o of Object.keys(c))if($l(o,a)){var l=o.substr(0,o.length-a.length);hs(l)||c[l]==null&&(c[l]=c[o])}}function t(){c=null}function i(a){if(hs(a))throw new Rn("key");n();var o=c[a.toLowerCase()];if(o==null)throw new Ir(bt("Can't find {0} filter handler type!",a));return o}r.get=i})(Jt||(Jt={}));var Ze=class extends B{constructor(e,t){super(e,t);this.store=new ae([]),this.onFilterStoreChanged=()=>this.filterStoreChanged(),this.store.add_changed(this.onFilterStoreChanged)}destroy(){this.store&&(this.store.remove_changed(this.onFilterStoreChanged),this.onFilterStoreChanged=null,this.store=null),super.destroy()}filterStoreChanged(){}get_store(){return this.store}set_store(e){this.store!==e&&(this.store!=null&&this.store.remove_changed(this.onFilterStoreChanged),this.store=e||new ae([]),this.store.add_changed(this.onFilterStoreChanged),this.filterStoreChanged())}};Ze=h([m.registerClass("Serenity.FilterWidgetBase")],Ze);import{cast as Yl,isEmptyOrNull as ms,localText as me,tryGetText as Vn}from"@serenity-is/corelib/q";var et=class extends L{constructor(n,e){var i,r;super(n);for(var t of e)this.addOption(t.name,(r=(i=Vn(t.title))!=null?i:t.title)!=null?r:t.name,t)}emptyItemText(){return ms(this.value)?me("Controls.FilterPanel.SelectField"):null}getSelect2Options(){var n=super.getSelect2Options();return n.allowClear=!1,n}};et=h([m.registerClass("Serenity.FilterFieldSelect")],et);var tt=class extends L{constructor(n,e){var r,a;super(n);for(var t of e){var i=(a=t.title)!=null?a:(r=Vn("Controls.FilterPanel.OperatorNames."+t.key))!=null?r:t.key;this.addOption(t.key,i,t)}e.length&&e[0]&&(this.value=e[0].key)}emptyItemText(){return null}getSelect2Options(){var n=super.getSelect2Options();return n.allowClear=!1,n}};tt=h([m.registerClass("Serenity.FilterOperatorSelect")],tt);var Mt=class extends Ze{constructor(e){super(e);this.element.addClass("s-FilterPanel"),this.rowsDiv=this.byId("Rows"),this.initButtons(),this.updateButtons()}get_showInitialLine(){return this.showInitialLine}set_showInitialLine(e){this.showInitialLine!==e&&(this.showInitialLine=e,this.showInitialLine&&this.rowsDiv.children().length===0&&this.addEmptyRow(!1))}filterStoreChanged(){super.filterStoreChanged(),this.updateRowsFromStore()}updateRowsFromStore(){this.rowsDiv.empty();var e=this.get_store().get_items();for(var t of e){this.addEmptyRow(!1);var i=this.rowsDiv.children().last(),r=i.children("div.l");r.children(".leftparen").toggleClass("active",!!t.leftParen),r.children(".rightparen").toggleClass("active",!!t.rightParen),r.children(".andor").toggleClass("or",!!t.isOr).text(me(t.isOr?"Controls.FilterPanel.Or":"Controls.FilterPanel.And"));var a=i.children("div.f").find("input.field-select").getWidget(et);a.value=t.field,this.rowFieldChange(i);var o=i.children("div.o").find("input.op-select").getWidget(tt);o.set_value(t.operator),this.rowOperatorChange(i);var l=this.getFilteringFor(i);l!=null&&(l.set_operator({key:t.operator}),l.loadState(t.state))}this.get_showInitialLine()&&this.rowsDiv.children().length===0&&this.addEmptyRow(!1),this.updateParens()}get_showSearchButton(){return this.showSearchButton}set_showSearchButton(e){this.showSearchButton!==e&&(this.showSearchButton=e,this.updateButtons())}get_updateStoreOnReset(){return this.updateStoreOnReset}set_updateStoreOnReset(e){this.updateStoreOnReset!==e&&(this.updateStoreOnReset=e)}getTemplate(){return"<div id='~_Rows' class='filter-lines'></div><div id='~_Buttons' class='buttons'><button id='~_AddButton' class='btn btn-primary add'></button><button id='~_SearchButton' class='btn btn-success search'></button><button id='~_ResetButton' class='btn btn-danger reset'></button></div><div style='clear: both'></div>"}initButtons(){this.byId("AddButton").text(me("Controls.FilterPanel.AddFilter")).click(e=>this.addButtonClick(e)),this.byId("SearchButton").text(me("Controls.FilterPanel.SearchButton")).click(e=>this.searchButtonClick(e)),this.byId("ResetButton").text(me("Controls.FilterPanel.ResetButton")).click(e=>this.resetButtonClick(e))}searchButtonClick(e){e.preventDefault(),this.search()}get_hasErrors(){return this.rowsDiv.children().children("div.v").children("span.error").length>0}search(){this.rowsDiv.children().children("div.v").children("span.error").remove();for(var e=[],t=null,i=null,r=0;r<this.rowsDiv.children().length;r++){i=this.rowsDiv.children().eq(r);var a=this.getFilteringFor(i);if(a!=null){var o=this.getFieldFor(i),l=i.children("div.o").find("input.op-select").getWidget(tt).value;if(l==null||l.length===0){t=me("Controls.FilterPanel.InvalidOperator");break}var d={};d.field=o.name,d.operator=l,d.isOr=i.children("div.l").children("a.andor").hasClass("or"),d.leftParen=i.children("div.l").children("a.leftparen").hasClass("active"),d.rightParen=i.children("div.l").children("a.rightparen").hasClass("active"),a.set_operator({key:l});var p=a.getCriteria();d.criteria=p.criteria,d.state=a.saveState(),d.displayText=p.displayText,e.push(d)}}if(t!=null){$("<span/>").addClass("error").attr("title",t).appendTo(i.children("div.v")),i.children("div.v").find("input:first").focus();return}var u=this.get_store().get_items();u.length=0,u.push.apply(u,e),this.get_store().raiseChanged()}addButtonClick(e){this.addEmptyRow(!0),e.preventDefault()}resetButtonClick(e){e.preventDefault(),this.get_updateStoreOnReset()&&this.get_store().get_items().length>0&&(this.get_store().get_items().length=0,this.get_store().raiseChanged()),this.rowsDiv.empty(),this.updateButtons(),this.get_showInitialLine()&&this.addEmptyRow(!1)}findEmptyRow(){var e=null;return this.rowsDiv.children().each(function(t,i){var r=$(i).children("div.f").children("input.field-select").first();if(r.length===0)return!0;var a=r.val();return a==null||a.length===0?(e=$(i),!1):!0}),e}addEmptyRow(e){var t=this.findEmptyRow();if(t!=null)return t.find("input.field-select").select2("focus"),e&&t.find("input.field-select").select2("open"),t;var i=this.rowsDiv.children().last().children("a.andor").hasClass("or"),r=$("<div class='filter-line'><a class='delete'><span></span></a><div class='l'><a class='rightparen' href='#'>)</a><a class='andor' href='#'></a><a class='leftparen' href='#'>(</a></div><div class='f'><input type='hidden' class='field-select'></div><div class='o'></div><div class='v'></div><div style='clear: both'></div></div>").appendTo(this.rowsDiv),a=r.children("div.l").hide();a.children("a.leftparen, a.rightparen").click(d=>this.leftRightParenClick(d));var o=a.children("a.andor").attr("title",me("Controls.FilterPanel.ChangeAndOr"));i?o.addClass("or").text(me("Controls.FilterPanel.Or")):o.text(me("Controls.FilterPanel.And")),o.click(d=>this.andOrClick(d)),r.children("a.delete").attr("title",me("Controls.FilterPanel.RemoveField")).click(d=>this.deleteRowClick(d));var l=new et(r.children("div.f").children("input"),this.get_store().get_fields()).changeSelect2(d=>this.onRowFieldChange(d));return this.updateParens(),this.updateButtons(),r.find("input.field-select").select2("focus"),e&&r.find("input.field-select").select2("open"),r}onRowFieldChange(e){var t=$(e.target).closest("div.filter-line");this.rowFieldChange(t);var i=t.children("div.o").find("input.op-select");i.select2("focus")}rowFieldChange(e){e.removeData("Filtering");var t=e.children("div.f").find("input.field-select").getWidget(et),i=t.get_value(),r=i==null||i==="";this.removeFiltering(e),this.populateOperatorList(e),this.rowOperatorChange(e),this.updateParens(),this.updateButtons()}removeFiltering(e){e.data("Filtering",null),e.data("FilteringField",null)}populateOperatorList(e){e.children("div.o").html("");var t=this.getFilteringFor(e);if(t!=null){var i=e.children("div.o").html("<input/>").children().attr("type","hidden").addClass("op-select"),r=t.getOperators(),a=new tt(i,r);a.changeSelect2(o=>this.onRowOperatorChange(o))}}getFieldFor(e){if(e.length===0)return null;var t=e.children("div.f").find("input.field-select").getWidget(et);return ms(t.value)?null:this.get_store().get_fieldByName()[t.get_value()]}getFilteringFor(e){var o;var t=this.getFieldFor(e);if(t==null)return null;var i=Yl(e.data("Filtering"),Xe);if(i!=null)return i;var r=Jt.get((o=t.filteringType)!=null?o:"String"),a=e.children("div.v");return i=new r,be.set(i,t.filteringParams),i.set_container(a),i.set_field(t),e.data("Filtering",i),i}onRowOperatorChange(e){var t=$(e.target).closest("div.filter-line");this.rowOperatorChange(t);var i=t.children("div.v").find(":input:visible").first();try{i.focus()}catch(r){}}rowOperatorChange(e){if(e.length!==0){var t=e.children("div.v");t.html("");var i=this.getFilteringFor(e);if(i!=null){var r=e.children("div.o").find("input.op-select").getWidget(tt);if(!ms(r.get_value())){var a=i.getOperators().filter(function(l){return l.key===r.value}),o=a.length>0?a[0]:null;o!=null&&(i.set_operator(o),i.createEditor())}}}}deleteRowClick(e){e.preventDefault();var t=$(e.target).closest("div.filter-line");t.remove(),this.rowsDiv.children().length===0&&this.search(),this.updateParens(),this.updateButtons()}updateButtons(){this.byId("SearchButton").toggle(this.rowsDiv.children().length>=1&&this.showSearchButton),this.byId("ResetButton").toggle(this.rowsDiv.children().length>=1)}andOrClick(e){e.preventDefault();var t=$(e.target).toggleClass("or");t.text(me("Controls.FilterPanel."+(t.hasClass("or")?"Or":"And")))}leftRightParenClick(e){e.preventDefault(),$(e.target).toggleClass("active"),this.updateParens()}updateParens(){var e=this.rowsDiv.children();if(e.length!==0){e.removeClass("paren-start"),e.removeClass("paren-end"),e.children("div.l").css("display",e.length===1?"none":"block"),e.first().children("div.l").children("a.rightparen, a.andor").css("visibility","hidden");for(var t=1;t<e.length;t++){var i=e.eq(t);i.children("div.l").css("display","block").children("a.lefparen, a.andor").css("visibility","visible")}for(var r=!1,a=0;a<e.length;a++){var o=e.eq(a),l=o.children("div.l"),d=l.children("a.leftparen"),p=l.children("a.rightparen");p.hasClass("active")&&r&&(r=!1,a>0&&e.eq(a-1).addClass("paren-end")),d.hasClass("active")&&(r=!0,a>0&&o.addClass("paren-start"))}}}};Mt=h([m.registerClass("Serenity.FilterPanel")],Mt);import{notifyError as Xl,localText as Tr}from"@serenity-is/corelib/q";var $t=class extends Q{constructor(){super();this.filterPanel=new Mt(this.byId("FilterPanel")),this.filterPanel.set_showInitialLine(!0),this.filterPanel.set_showSearchButton(!1),this.filterPanel.set_updateStoreOnReset(!1),this.dialogTitle=Tr("Controls.FilterPanel.DialogTitle")}get_filterPanel(){return this.filterPanel}getTemplate(){return'<div id="~_FilterPanel"/>'}getDialogButtons(){return[{text:Tr("Dialogs.OkButton"),click:()=>{if(this.filterPanel.search(),this.filterPanel.get_hasErrors()){Xl(Tr("Controls.FilterPanel.FixErrorsMessage"),"",null);return}this.dialogClose()}},{text:Tr("Dialogs.CancelButton"),click:()=>this.dialogClose()}]}};$t=h([m.registerClass("Serenity.FilterDialog")],$t);import{localText as kr,trimToNull as Zl}from"@serenity-is/corelib/q";var zt=class extends Ze{constructor(n){super(n),this.element.find(".cap").text(kr("Controls.FilterPanel.EffectiveFilter")),this.element.find(".edit").text(kr("Controls.FilterPanel.EditFilter")),this.element.find(".reset").attr("title",kr("Controls.FilterPanel.ResetFilterHint"));var e=t=>{t.preventDefault();var i=new $t;i.get_filterPanel().set_store(this.get_store()),i.dialogOpen(null)};this.element.find(".edit").click(e),this.element.find(".txt").click(e),this.element.find(".reset").click(t=>{t.preventDefault(),this.get_store().get_items().length=0,this.get_store().raiseChanged()})}filterStoreChanged(){super.filterStoreChanged();var n=Zl(this.get_store().get_displayText());this.element.find(".current").toggle(n!=null),this.element.find(".reset").toggle(n!=null),n==null&&(n=kr("Controls.FilterPanel.EffectiveEmpty")),this.element.find(".txt").text("["+n+"]")}getTemplate(){return"<div><a class='reset'></a><a class='edit'></a><div class='current'><span class='cap'></span><a class='txt'></a></div></div>"}};zt=h([m.registerClass("Serenity.FilterDisplayBar")],zt);import{htmlEncode as Or,extend as ed,localText as wr}from"@serenity-is/corelib/q";var Ht=class extends b{constructor(n,e){super(n,ed({showRowsPerPage:!0,rowsPerPageOptions:[20,100,500,2e3]},e)),e=this.options;var t=e.view;if(!t)throw"SlickPager requires view option to be set!";this.element.addClass("s-SlickPager slick-pg").html('<div class="slick-pg-in"><div class="slick-pg-grp"><div class="slick-pg-first slick-pg-btn"><span class="slick-pg-btn-span"></span></div><div class="slick-pg-prev slick-pg-btn"><span class="slick-pg-btn-span"></span></div></div><div class="slick-pg-sep"></div><div class="slick-pg-grp"><span class="slick-pg-control">&nbsp;'+Or(wr("Controls.Pager.Page"))+'&nbsp;<input class="slick-pg-current" type="text" size="4" value="1" /> / <span class="slick-pg-total"> 1 </span></span></div><div class="slick-pg-sep"></div><div class="slick-pg-grp"><div class="slick-pg-next slick-pg-btn"><span class="slick-pg-btn-span"></span></div><div class="slick-pg-last slick-pg-btn"><span class="slick-pg-btn-span"></span></div></div><div class="slick-pg-sep"></div><div class="slick-pg-grp"><div class="slick-pg-reload slick-pg-btn"><span class="slick-pg-btn-span"></span></div></div><div class="slick-pg-sep"></div><div class="slick-pg-grp"><span class="slick-pg-stat"></span></div></div>');var i=this;if($(".slick-pg-reload",this.element).click(function(){t.populate()}),$(".slick-pg-first",this.element).click(function(){i._changePage("first")}),$(".slick-pg-prev",this.element).click(function(){i._changePage("prev")}),$(".slick-pg-next",this.element).click(function(){i._changePage("next")}),$(".slick-pg-last",this.element).click(function(){i._changePage("last")}),$(".slick-pg-current",this.element).keydown(function(l){l.keyCode==13&&i._changePage("input")}),i.options.showRowsPerPage){for(var r="",a="",o=0;o<e.rowsPerPageOptions.length;o++)t.rowsPerPage==e.rowsPerPageOptions[o]?a='selected="selected"':a="",r+="<option value='"+e.rowsPerPageOptions[o]+"' "+a+" >"+e.rowsPerPageOptions[o]+"&nbsp;&nbsp;</option>";$(".slick-pg-in",this.element).prepend('<div class="slick-pg-grp"><select class="slick-pg-size" name="rp">'+r+'</select></div><div class="slick-pg-sep"></div>'),$("select.slick-pg-size",this.element).change(function(){e.onRowsPerPageChange?e.onRowsPerPageChange(+this.value):(t.newp=1,t.setPagingOptions({page:1,rowsPerPage:+this.value}))})}t.onPagingInfoChanged.subscribe(function(){i._updatePager()})}_changePage(n){var e=this.options.view;if(!e||e.loading)return!0;var t=e.getPagingInfo(),i=!t.rowsPerPage||!t.totalCount?1:Math.ceil(t.totalCount/t.rowsPerPage),r;switch(n){case"first":r=1;break;case"prev":t.page>1&&(r=parseInt(t.page)-1);break;case"next":t.page<i&&(r=parseInt(t.page)+1);break;case"last":r=i;break;case"input":var a=parseInt($("input.slick-pg-current",this.element).val());isNaN(a)||a<1?a=1:a>i&&(a=i),$(".slick-pg-current",this.element).val(a),r=a;break}if(r==t.page)return!1;this.options.onChangePage?this.options.onChangePage(r):e.setPagingOptions({page:r})}_updatePager(){var n=this.options.view,e=n.getPagingInfo(),t=!e.rowsPerPage||!e.totalCount?1:Math.ceil(e.totalCount/e.rowsPerPage);$(".slick-pg-current",this.element).val(e.page),$(".slick-pg-total",this.element).html(t);var i=(e.page-1)*e.rowsPerPage+1,r=i+e.rowsPerPage-1;e.totalCount<r&&(r=e.totalCount);var a;e.loading?a=Or(wr("Controls.Pager.LoadingStatus")):e.error?a=e.error:e.totalCount>0?(a=Or(wr("Controls.Pager.PageStatus")),a=a.replace(/{from}/,i),a=a.replace(/{to}/,r),a=a.replace(/{total}/,e.totalCount)):a=Or(wr("Controls.Pager.NoRowStatus")),$(".slick-pg-stat",this.element).html(a),$(".slick-pg-size",this.element).val((e.rowsPerPage||0).toString())}};Ht=h([m.registerClass("Serenity.SlickPager")],Ht);import{Authorization as fd,clearKeys as ui,Culture as An,htmlEncode as Kt,isEmptyOrNull as Wn,replaceAll as qn,safeCast as yd,serviceCall as vd,startsWith as bd,localText as Jn,tryGetText as Mn}from"@serenity-is/corelib/q";import{Culture as Bn,Enum as Qn,format as Pr,formatDate as td,formatNumber as id,getAttributes as rd,getTypeFullName as sd,htmlEncode as Oe,isEmptyOrNull as le,ISlickFormatter as Ln,parseDecimal as nd,parseISODateTime as ad,replaceAll as od,resolveUrl as Gn,safeCast as Nn,startsWith as ld,tryGetText as di}from"@serenity-is/corelib/q";var it=class{};it=h([m.registerInterface("Serenity.IInitializeColumn")],it);var Ut=class{format(n){var t,i;if(n.value==null)return"";var e;return n.value?(e=di(this.trueText),e==null&&(e=this.trueText,e==null&&(e=(t=di("Dialogs.YesButton"))!=null?t:"Yes"))):(e=di(this.falseText),e==null&&(e=this.falseText,e==null&&(e=(i=di("Dialogs.NoButton"))!=null?i:"No"))),Oe(e)}};h([m.option()],Ut.prototype,"falseText",2),h([m.option()],Ut.prototype,"trueText",2),Ut=h([m.registerFormatter("Serenity.BooleanFormatter")],Ut);var _r=class{format(n){return'<span class="check-box no-float readonly slick-edit-preclick '+(n.value?" checked":"")+'"></span>'}};_r=h([m.registerFormatter("Serenity.CheckboxFormatter")],_r);var ge=class{constructor(){this.displayFormat=Bn.dateFormat}static format(n,e){if(n==null)return"";var t;if(n instanceof Date)t=n;else if(typeof n=="string"){if(t=ad(n),t==null)return Oe(n)}else return n.toString();return Oe(td(t,e))}format(n){return ge.format(n.value,this.displayFormat)}};h([m.option()],ge.prototype,"displayFormat",2),ge=h([m.registerFormatter("Serenity.DateFormatter")],ge);var Dr=class extends ge{constructor(){super(),this.displayFormat=Bn.dateTimeFormat}};Dr=h([m.registerFormatter("Serenity.DateTimeFormatter")],Dr);var ke=class{format(n){return ke.format(He.get(this.enumKey),n.value)}static format(n,e){if(e==null)return"";var t=Qn.toString(n,e),i=rd(n,z,!1),r=i.length>0?i[0].value:sd(n);return ke.getText(r,t)}static getText(n,e){var t;return le(e)?"":Oe((t=di("Enums."+n+"."+e))!=null?t:e)}static getName(n,e){return e==null?"":Qn.toString(n,e)}};h([m.option()],ke.prototype,"enumKey",2),ke=h([m.registerFormatter("Serenity.EnumFormatter")],ke);var Be=class{format(n){var o,l;var e=Nn(n.value,String);if(le(e))return"";var t=Be.dbFileUrl(e),i=le(this.originalNameProperty)?null:Nn(n.item[this.originalNameProperty],String);i=i!=null?i:"";var r=Pr((o=this.displayFormat)!=null?o:"{0}",i,e,t),a=(l=this.iconClass)!=null?l:"fa fa-download";return a.startsWith("fa-")&&(a="fa "+a),"<a class='file-download-link' target='_blank' href='"+Oe(t)+"'><i class='"+a+"'></i> "+Oe(r)+"</a>"}static dbFileUrl(n){return n=od(n!=null?n:"","\\","/"),Gn("~/upload/")+n}initializeColumn(n){if(n.referencedFields=n.referencedFields||[],!le(this.originalNameProperty)){n.referencedFields.push(this.originalNameProperty);return}}};h([m.option()],Be.prototype,"displayFormat",2),h([m.option()],Be.prototype,"originalNameProperty",2),h([m.option()],Be.prototype,"iconClass",2),Be=h([m.registerFormatter("Serenity.FileDownloadFormatter",[Ln,it])],Be);var jt=class{format(n){return jt.format(n.value)}static format(n){var e=Math.floor(n/60),t=n-e*60,i,r;return n==null||isNaN(n)?"":(e<10?i="0"+e:i=e.toString(),t<10?r="0"+t:r=t.toString(),Pr("{0}:{1}",i,r))}};jt=h([m.registerFormatter("Serenity.MinuteFormatter")],jt);var Le=class{format(n){return Le.format(n.value,this.displayFormat)}static format(n,e){if(e=e!=null?e:"0.##",n==null)return"";if(typeof n=="number")return isNaN(n)?"":Oe(id(n,e));var t=nd(n.toString());return t==null?"":Oe(n.toString())}};h([m.option()],Le.prototype,"displayFormat",2),Le=h([m.registerFormatter("Serenity.NumberFormatter")],Le);var Ne=class{format(n){var r,a,o,l;var e=le(this.urlProperty)?((a=n.value)!=null?a:"").toString():((r=n.item[this.urlProperty])!=null?r:"").toString();if(le(e))return"";le(this.urlFormat)||(e=Pr(this.urlFormat,e)),e!=null&&ld(e,"~/")&&(e=Gn(e));var t=le(this.displayProperty)?((l=n.value)!=null?l:"").toString():((o=n.item[this.displayProperty])!=null?o:"").toString();le(this.displayFormat)||(t=Pr(this.displayFormat,t));var i="<a href='"+Oe(e)+"'";return le(this.target)||(i+=" target='"+this.target+"'"),i+=">"+Oe(t)+"</a>",i}initializeColumn(n){if(n.referencedFields=n.referencedFields||[],!le(this.displayProperty)){n.referencedFields.push(this.displayProperty);return}if(!le(this.urlProperty)){n.referencedFields.push(this.urlProperty);return}}};h([m.option()],Ne.prototype,"displayProperty",2),h([m.option()],Ne.prototype,"displayFormat",2),h([m.option()],Ne.prototype,"urlProperty",2),h([m.option()],Ne.prototype,"urlFormat",2),h([m.option()],Ne.prototype,"target",2),Ne=h([m.registerFormatter("Serenity.UrlFormatter",[Ln,it])],Ne);import{ArgumentNullException as dd,Exception as ud,htmlEncode as pd,isAssignableFrom as cd,isEmptyOrNull as hd,ISlickFormatter as md,notifyError as gd}from"@serenity-is/corelib/q";var Fr;(i=>{let c=ze(r=>cd(md,r),null,"Formatter");function n(r){if(hd(r))throw new dd("key");var a=c.tryGet(r);if(a)return a;var o=`"${pd(r)}" formatter class not found! 
Make sure there is such a formatter type under the project root namespace,
and its namespace parts start with capital letters like MyProject.MyModule.MyFormatter.

If using ES modules, make sure the formatter type has a decorator like 
@Decorators.registerFormatter('MyProject.MyModule.MyFormatter') with the full name 
of your formatter type and "side-effect-import" this formatter class from the current 
"page.ts/grid.ts/dialog.ts file (import "./path/to/MyFormatter.ts").

After applying fixes, build and run "node ./tsbuild.js" (or "tsc" if using namespaces) 
from the project folder.`;throw gd(o.replace(/\r?\n\r?\n/g,"<br/><br/>"),"",{escapeHtml:!1,timeOut:5e3}),new ud(o)}i.get=n;function e(){c.reset()}i.reset=e;function t(r){return c.tryGet(r)}i.tryGet=t})(Fr||(Fr={}));var Er=class{constructor(n,e){this.include={},this.grid=n,this.idField=n.getView().idField,this.options=e||{},n.getGrid().onClick.subscribe((t,i)=>{if($(t.target).hasClass("select-item")){t.preventDefault();var r=n.getView().getItem(i.row),a=r[this.idField].toString();this.include[a]?delete this.include[a]:this.include[a]=!0;for(var o=0;o<n.getView().getLength();o++)n.getGrid().updateRow(o);this.updateSelectAll()}}),n.getGrid().onHeaderClick.subscribe((t,i)=>{if(!t.isDefaultPrevented()&&$(t.target).hasClass("select-all-items")){if(t.preventDefault(),Object.keys(this.include).length>0)ui(this.include);else{var r=n.getView().getItems();for(var a of r.filter(this.isSelectable.bind(this))){var o=a[this.idField];this.include[o]=!0}}this.updateSelectAll(),n.getView().setItems(n.getView().getItems(),!0),setTimeout(this.updateSelectAll.bind(this),0)}}),n.getView().onRowsChanged.subscribe(()=>this.updateSelectAll())}updateSelectAll(){var n=this.grid.getElement().find(".select-all-header .slick-column-name .select-all-items");if(n){var e=Object.keys(this.include);n.toggleClass("checked",e.length>0&&this.grid.getView().getItems().filter(this.isSelectable.bind(this)).length<=e.length)}}clear(){ui(this.include),this.updateSelectAll()}resetCheckedAndRefresh(){this.include={},this.updateSelectAll(),this.grid.getView().populate()}selectKeys(n){for(var e of n)this.include[e]=!0;this.updateSelectAll()}getSelectedKeys(){return Object.keys(this.include)}getSelectedAsInt32(){return Object.keys(this.include).map(function(n){return parseInt(n,10)})}getSelectedAsInt64(){return Object.keys(this.include).map(function(n){return parseInt(n,10)})}setSelectedKeys(n){this.clear();for(var e of n)this.include[e]=!0;this.updateSelectAll()}isSelectable(n){return n&&(this.options.selectable==null||this.options.selectable(n))}static createSelectColumn(n){return{name:'<span class="select-all-items check-box no-float "></span>',nameIsHtml:!0,toolTip:" ",field:"__select__",width:27,minWidth:27,headerCssClass:"select-all-header",sortable:!1,format:function(e){var t=e.item,i=n();if(!i||!i.isSelectable(t))return"";var r=i.include[e.item[i.idField]];return'<span class="select-item check-box no-float '+(r?" checked":"")+'"></span>'}}}};Er=h([m.registerClass("Serenity.GridRowSelectionMixin")],Er);var Rr=class{constructor(n,e){this.include={},this.grid=n,this.idField=n.getView().idField,this.options=e||{},n.getGrid().onClick.subscribe((t,i)=>{if($(t.target).hasClass("rad-select-item")){t.preventDefault();var r=n.getView().getItem(i.row);if(!this.isSelectable(r))return;var a=r[this.idField].toString();this.include[a]==!0?ui(this.include):(ui(this.include),this.include[a]=!0);for(var o=0;o<n.getView().getLength();o++)n.getGrid().updateRow(o)}})}isSelectable(n){return n&&(this.options.selectable==null||this.options.selectable(n))}clear(){ui(this.include)}resetCheckedAndRefresh(){this.include={},this.grid.getView().populate()}getSelectedKey(){var n=Object.keys(this.include);return n!=null&&n.length>0?n[0]:null}getSelectedAsInt32(){var n=Object.keys(this.include).map(function(e){return parseInt(e,10)});return n!=null&&n.length>0?n[0]:null}getSelectedAsInt64(){var n=Object.keys(this.include).map(function(e){return parseInt(e,10)});return n!=null&&n.length>0?n[0]:null}setSelectedKey(n){this.clear(),this.include[n]=!0}static createSelectColumn(n){return{name:"",toolTip:" ",field:"__select__",width:27,minWidth:27,headerCssClass:"",sortable:!1,formatter:function(e,t,i,r,a){var o=n();if(!o||!o.isSelectable(a))return"";var l=o.include[a[o.idField]];return'<input type="radio" name="radio-selection-group" class="rad-select-item no-float" style="cursor: pointer;width: 13px; height:13px;" '+(l?" checked":"")+" /> "}}}};Rr=h([m.registerClass("GridRadioSelectionMixin")],Rr);var pi;(e=>{function c(t,i){var r=t.element.children(".s-Toolbar");if(r.length!==0){var a=r.getWidget(A).findButton("select-all-button"),o=t.getView().getItems();a.toggleClass("checked",o.length>0&&!o.some(function(l){return!i(l)}))}}e.update=c;function n(t,i,r,a,o,l){var d;return o==null&&(o=(d=Mn("Controls.CheckTreeEditor.SelectAll"))!=null?d:"Select All"),{title:o,cssClass:"select-all-button",onClick:function(){var p=t(),u=p.getView(),g=p.element.children(".s-Toolbar").getWidget(A).findButton("select-all-button"),v=!g.hasClass("checked");u.beginUpdate();try{for(var f of u.getItems())a(f,v),u.updateItem(i(f),f);l&&l()}finally{u.endUpdate()}g.toggleClass("checked",v)}}}e.define=n})(pi||(pi={}));var It;(a=>{function c(o,l,d,p,u){var g=$('<div><a href="#"></a></div>').addClass("s-ToggleButton").addClass(l).prependTo(o);g.children("a").click(function(v){v.preventDefault(),g.toggleClass("pressed");var f=g.hasClass("pressed");d&&d(f)}).attr("title",p!=null?p:""),u&&g.addClass("pressed")}a.addToggleButton=c;function n(o,l,d,p){var u=!1,g=l.onSubmit;l.onSubmit=function(v){return v.params.IncludeDeleted=u,g!=null?g(v):!0},d==null&&(d=Jn("Controls.EntityGrid.IncludeDeletedToggle")),c(o,"s-IncludeDeletedToggle",function(v){u=v,l.seekToPage=1,l.populate()},d,p),o.bind("remove",function(){l.onSubmit=null,g=null})}a.addIncludeDeletedToggle=n;function e(o,l,d,p){var u=l.onSubmit,g;l.onSubmit=function(f){var S;if(g){var y=g.get_value();y&&y.length>0?f.params.ContainsText=y:delete f.params.ContainsText;var C=(S=g.get_field())==null?void 0:S.name;C!=null&&C.length>0?f.params.ContainsField=C:delete f.params.ContainsField}return u!=null?u(f):!0};var v=null;g=t(o,(f,y,C)=>{p&&p(),l.seekToPage=1,v=C,l.populate()},d),l.onDataLoaded.subscribe(function(f,y){v!=null&&(v(l.getLength()>0),v=null)})}a.addQuickSearchInput=e;function t(o,l,d){var p=$('<div><input type="text"/></div>').addClass("s-QuickSearchBar").prependTo(o);return d!=null&&d.length>0&&p.addClass("has-quick-search-fields"),new te(p.children(),{fields:d,onSearch:l})}a.addQuickSearchInputCustom=t;function i(o,l){var d=new Slick.RowMoveManager({cancelEditOnDrag:!0});d.onBeforeMoveRows.subscribe(function(p,u){for(var g=0;g<u.rows.length;g++)if(u.rows[g]===u.insertBefore||u.rows[g]===u.insertBefore-1)return p.stopPropagation(),!1;return!0}),d.onMoveRows.subscribe(function(p,u){l(u.rows,u.insertBefore);try{o.setSelectedRows([])}catch(g){}}),o.registerPlugin(d)}a.makeOrderable=i;function r(o,l,d,p,u){i(o.getGrid(),function(g,v){var O,T;if(g.length!==0){var f,y=v;y<0?f=1:v>=o.getGrid().getDataLength()?(f=(O=d(o.getGrid().getDataItem(o.getGrid().getDataLength()-1)))!=null?O:0,f===0?f=v+1:f=f+1):(f=(T=d(o.getGrid().getDataItem(v)))!=null?T:0,f===0&&(f=v+1));var C=0,S=null;S=function(){vd({service:p,request:u(l(o.getGrid().getDataItem(g[C])),f++),onSuccess:function(_){C++,C<g.length?S():o.getView().populate()}})},S()}})}a.makeOrderableWithUpdateRequest=r})(It||(It={}));var Vr;(e=>{function c(t){var i=[];if(t==null)return i;for(var r=0;r<t.length;r++)i.push(e.toSlickColumn(t[r]));return i}e.toSlickColumns=c;function n(t){var d,p;var i={field:t.name,sourceItem:t,cssClass:t.cssClass,headerCssClass:t.headerCssClass,sortable:t.sortable!==!1,sortOrder:(d=t.sortOrder)!=null?d:0,width:t.width!=null?t.width:80,minWidth:(p=t.minWidth)!=null?p:30,maxWidth:t.maxWidth==null||t.maxWidth===0?null:t.maxWidth,resizable:t.resizable==null||!!t.resizable};i.visible=t.visible!==!1&&t.filterOnly!==!0&&(t.readPermission==null||fd.hasPermission(t.readPermission));var r=Mn(t.title);if(r==null&&(r=t.title),i.name=r,t.alignment!=null&&t.alignment.length>0&&(Wn(i.cssClass)?i.cssClass="align-"+t.alignment:i.cssClass+=" align-"+t.alignment),t.formatterType!=null&&t.formatterType.length>0){var a=Fr.get(t.formatterType),o=new a;t.formatterParams!=null&&be.set(o,t.formatterParams);var l=yd(o,it);l!=null&&l.initializeColumn(i),i.format=u=>o.format(u)}return i}e.toSlickColumn=n})(Vr||(Vr={}));var we;(p=>{function c(u,g){return ke.getText(u,g)}p.getEnumText=c;function n(u,g,v){return function(f){var E,j;var y=v(f),C=u(),S=(E=f.item._indent)!=null?E:0,O='<span class="s-TreeIndent" style="width:'+15*S+'px"></span>',T=g(f.item),_=C.getIdxById(T),x=C.getItemByIdx(_+1);if(x!=null){var I=(j=x._indent)!=null?j:0;if(I>S)return f.item._collapsed?O+'<span class="s-TreeToggle s-TreeExpand"></span>'+y:O+'<span class="s-TreeToggle s-TreeCollapse"></span>'+y}return O+'<span class="s-TreeToggle"></span>'+y}}p.treeToggle=n;function e(u){return u==null&&(u=An.dateFormat),function(g){return Kt(ge.format(g.value,u))}}p.date=e;function t(u){return u==null&&(u=An.dateTimeFormat),function(g){return Kt(ge.format(g.value,u))}}p.dateTime=t;function i(){return function(u){return'<span class="check-box no-float '+(u.value?" checked":"")+'"></span>'}}p.checkBox=i;function r(u){return function(g){return Le.format(g.value,u)}}p.number=r;function a(u){return u.data("item-type")}p.getItemType=a;function o(u){var g=u.data("item-id");return g==null?null:g.toString()}p.getItemId=o;function l(u,g,v,f,y){return"<a"+(g!=null?' href="#'+qn(u,".","-")+"/"+g+'"':"")+' data-item-type="'+Kt(u)+'" data-item-id="'+Kt(g)+'" class="s-EditLink s-'+qn(u,".","-")+"Link"+(Wn(f)?"":" "+f)+'">'+(y?Kt(v!=null?v:""):v!=null?v:"")+"</a>"}p.itemLinkText=l;function d(u,g,v,f,y){return function(C){var O,T;var S=(O=v==null?C.value:v(C))!=null?O:"";return(T=C.item)!=null&&T.__nonDataRow?y?Kt(S):S:l(u,C.item[g],v==null?C.value:v(C),f==null?"":f(C),y)}}p.itemLink=d})(we||(we={}));var Qr;(n=>{function c(e,t){for(var i of e){i.sortable=i.sortable!=null?i.sortable:!0;var r=i.id;if(r==null&&(r=i.field),i.id=r,t!=null&&i.id!=null&&(i.name==null||bd(i.name,"~"))){var a=i.name!=null?i.name.substr(1):i.id;i.name=Jn(t+a)}}return e}n.setDefaults=c})(Qr||(Qr={}));var ie;(a=>{function c(o,l){for(var d=l(o),p=0;d!=null;){if(d._collapsed)return!1;if(d=l(d),p++>1e3)throw new Error("Possible infinite loop, check parents has no circular reference!")}return!0}a.filterCustom=c;function n(o,l,d){return c(o,function(p){var u=d(p);return u==null?null:l.getItemById(u)})}a.filterById=n;function e(o,l){if(o!=null)for(var d of o)d._collapsed=l}a.setCollapsed=e;function t(o,l){o._collapsed=l}a.setCollapsedFlag=t;function i(o,l,d,p){for(var u=0,g={},v=0;v<o.length;v++){var f=o[v];if(v>0){var y=d(f);y!=null&&y===l(o[v-1])?u+=1:y==null?u=0:y!==d(o[v-1])&&(g[y]!=null?u=g[y]+1:u=0)}g[l(f)]=u,f._indent=u,p!=null&&(f._collapsed=p)}}a.setIndents=i;function r(o,l,d,p,u){var g=$(o.target);if(g.hasClass("s-TreeToggle")&&(g.hasClass("s-TreeCollapse")||g.hasClass("s-TreeExpand"))){var v=p.getItem(l);if(v!=null&&(v._collapsed?v._collapsed=!1:v._collapsed=!0,p.updateItem(u(v),v)),o.shiftKey){p.beginUpdate();try{e(p.getItems(),!!v._collapsed),p.setItems(p.getItems(),!0)}finally{p.endUpdate()}}}}a.toggleClick=r})(ie||(ie={}));import{Authorization as gs,Criteria as Cd,debounce as xd,deepClone as Id,endsWith as fs,extend as Sd,getAttributes as Td,getColumnsData as kd,getColumnsDataAsync as Od,getInstanceType as $n,getTypeFullName as wd,htmlEncode as _d,indexOf as Dd,isEmptyOrNull as U,isInstanceOfType as Pd,layoutFillHeight as Fd,LayoutTimer as ys,ScriptData as Ed,setEquality as Rd,startsWith as Vd,trimEnd as Qd,trimToNull as Nd,tryGetText as Nr}from"@serenity-is/corelib/q";import{RemoteView as Bd}from"@serenity-is/corelib/slick";import{AutoTooltips as Ld,Grid as Gd}from"@serenity-is/sleekgrid";var N=class extends b{constructor(e,t){super(e,t);this.restoringSettings=0;var i=this;this.element.addClass("s-DataGrid").html("");var r=function(){i.layout(),i._layoutTimer!=null&&ys.store(i._layoutTimer)};this.element.addClass("require-layout").on("layout."+this.uniqueName,r),this.useLayoutTimer()&&(this._layoutTimer=ys.onSizeChange(()=>this.element&&this.element[0],xd(r,50))),this.setTitle(this.getInitialTitle());var a=this.getButtons();a!=null&&this.createToolbar(a),this.slickContainer=this.createSlickContainer(),this.view=this.createView(),this.useAsync()?this.initAsync():this.initSync()}internalInit(){var e;this.allColumns=(e=this.allColumns)!=null?e:this.getColumns(),this.slickGrid=this.createSlickGrid(),this.enableFiltering()&&this.createFilterBar(),this.usePager()&&this.createPager(),this.bindToSlickEvents(),this.bindToViewEvents(),this.toolbar&&this.createToolbarExtensions(),this.createQuickFilters(),this.updateDisabledState(),this.updateInterface(),this.initialSettings=this.getCurrentSettings(null),this.restoreSettings(null,null),window.setTimeout(()=>this.initialPopulate(),0)}initSync(){this.propertyItemsData=this.getPropertyItemsData(),this.internalInit(),this.afterInit()}initAsync(){return _e(this,null,function*(){this.propertyItemsData=yield this.getPropertyItemsDataAsync(),this.internalInit(),this.afterInit()})}afterInit(){}useAsync(){return!1}useLayoutTimer(){return!0}attrs(e){return Td($n(this),e,!0)}layout(){if(!(!this.element||!this.element.is(":visible")||!this.slickContainer||!this.slickGrid)){var e=this.element.hasClass("responsive-height"),t=this.slickGrid!=null&&this.slickGrid.getOptions().autoHeight,i=e&&window.innerWidth<768;i?(this.element[0]&&this.element[0].style.height!="auto"&&(this.element[0].style.height="auto"),t||(this.slickContainer.css("height","auto").children(".slick-pane").each((r,a)=>{a.style.height!=null&&a.style.height!="auto"&&(a.style.height="auto")}),this.slickGrid.setOptions({autoHeight:!0}))):(t&&(this.slickContainer.children(".slick-viewport").css("height","auto"),this.slickGrid.setOptions({autoHeight:!1})),Fd(this.slickContainer)),this.slickGrid.resizeCanvas()}}getInitialTitle(){return null}createToolbarExtensions(){}ensureQuickFilterBar(){return this.quickFiltersDiv==null&&this.createQuickFilters([]),this.quickFiltersBar}createQuickFilters(e){this.quickFiltersDiv==null&&(e!=null||(e=this.getQuickFilters())&&e!=null&&e.length)&&(this.quickFiltersDiv=$("<div/>").addClass("quick-filters-bar"),this.toolbar?($("<div/>").addClass("clear").appendTo(this.toolbar.element),this.quickFiltersDiv.appendTo(this.toolbar.element)):this.quickFiltersDiv.appendTo($("<div/>").addClass("s-Toolbar").insertBefore(this.slickContainer)),this.quickFiltersBar=new q(this.quickFiltersDiv,{filters:e,getTitle:t=>this.determineText(i=>i+t.field),idPrefix:this.uniqueName+"_QuickFilter_"}),this.quickFiltersBar.onChange=t=>this.quickFilterChange(t))}getQuickFilters(){return this.allColumns.filter(function(e){return e.sourceItem&&e.sourceItem.quickFilter===!0&&(e.sourceItem.readPermission==null||gs.hasPermission(e.sourceItem.readPermission))}).map(e=>N.propertyItemToQuickFilter(e.sourceItem)).filter(e=>e!=null)}static propertyItemToQuickFilter(e){var g,v;var t={},i=e.name,r=Nr(e.title);r==null&&(r=e.title,r==null&&(r=i));var a=Jt.get((g=e.filteringType)!=null?g:"String");if(a===At)t=q.dateRange(i,r);else if(a===Wt)t=q.dateTimeRange(i,r,(v=e.editorParams)==null?void 0:v.useUtc);else if(a===qt){var o=e.quickFilterParams||{},l=e.filteringParams||{},d=o.trueText;d==null&&(d=l.trueText);var p=o.falseText;p==null&&(p=l.falseText),t=q.boolean(i,r,d,p)}else{var u=new a;if(u&&Pd(u,Ct))be.set(u,e.filteringParams),u.set_field(e),u.set_operator({key:k.EQ}),u.initQuickFilter(t),t.options=Sd(Id(t.options),e.quickFilterParams);else return null}return e.quickFilterSeparator&&(t.separator=!0),t.cssClass=e.quickFilterCssClass,t}findQuickFilter(e,t){return this.quickFiltersBar!=null?this.quickFiltersBar.find(e,t):$("#"+this.uniqueName+"_QuickFilter_"+t).getWidget(e)}tryFindQuickFilter(e,t){if(this.quickFiltersBar!=null)return this.quickFiltersBar.tryFind(e,t);var i=$("#"+this.uniqueName+"_QuickFilter_"+t);return i.length?i.tryGetWidget(e):null}createIncludeDeletedButton(){(!U(this.getIsActiveProperty())||!U(this.getIsDeletedProperty()))&&It.addIncludeDeletedToggle(this.toolbar.element,this.view,null,!1)}getQuickSearchFields(){return null}createQuickSearchInput(){It.addQuickSearchInput(this.toolbar.element,this.view,this.getQuickSearchFields(),()=>this.persistSettings(null))}destroy(){this._layoutTimer&&(this._layoutTimer=ys.off(this._layoutTimer)),this.quickFiltersBar&&(this.quickFiltersBar.destroy(),this.quickFiltersBar=null),this.toolbar&&(this.toolbar.destroy(),this.toolbar=null),this.slickGrid&&(this.slickGrid.onClick.clear(),this.slickGrid.onSort.clear(),this.slickGrid.onColumnsResized.clear(),this.slickGrid.onColumnsReordered.clear(),this.slickGrid.destroy(),this.slickGrid=null),this.view&&(this.view.onDataChanged.clear(),this.view.onSubmit=null,this.view.setFilter(null),this.view=null),this.titleDiv=null,super.destroy()}getItemCssClass(e,t){var i=this.getIsActiveProperty(),r=this.getIsDeletedProperty();if(U(i)&&U(r))return null;if(i){var a=e[i];if(a==null)return null;if(typeof a=="number"){if(a<0)return"deleted";if(a===0)return"inactive"}else if(typeof a=="boolean"&&a===!1)return"deleted"}else return e[r]?"deleted":null;return null}getItemMetadata(e,t){var i=this.getItemCssClass(e,t);return U(i)?new Object:{cssClasses:i}}postProcessColumns(e){Qr.setDefaults(e,this.getLocalTextDbPrefix());var t=this.getColumnWidthDelta(),i=this.getColumnWidthScale();if(i<0&&(i=1),t!==0||i!==1)for(var r of e)typeof r.width=="number"&&(r.width=r.width*i+t),typeof r.minWidth=="number"&&(r.minWidth=r.minWidth*i+t),typeof r.maxWidth=="number"&&(r.maxWidth=r.maxWidth*i+t);return e}getColumnWidthDelta(){var e;return(e=N.defaultColumnWidthDelta)!=null?e:0}getColumnWidthScale(){var e;return(e=N.defaultColumnWidthScale)!=null?e:1}initialPopulate(){var e=this;this.populateWhenVisible()?(ve.executeEverytimeWhenShown(this.element,function(){e.refreshIfNeeded()},!1),this.element.is(":visible")&&this.view&&this.view.populate()):this.view&&this.view.populate()}canFilterColumn(e){return e.sourceItem!=null&&e.sourceItem.notFilterable!==!0&&(e.sourceItem.readPermission==null||gs.hasPermission(e.sourceItem.readPermission))}initializeFilterBar(){this.filterBar.set_store(new ae(this.allColumns.filter(e=>this.canFilterColumn(e)).map(e=>e.sourceItem))),this.filterBar.get_store().add_changed((e,t)=>{this.restoringSettings<=0&&(this.persistSettings(null),this.view&&(this.view.seekToPage=1),this.refresh())})}createSlickGrid(){var e=this.postProcessColumns(this.allColumns).filter(function(r){return r.visible!==!1}),t=this.getSlickOptions(),i=new Gd(this.slickContainer,this.view,e,t);return i.registerPlugin(new Ld({enableForHeaderCells:!0})),this.slickGrid=i,this.setInitialSortOrder(),i}setInitialSortOrder(){var e=this.getDefaultSortBy();this.view&&(this.view.sortBy=Array.prototype.slice.call(e));var t=e.map(function(i){var r;return i&&fs(i.toLowerCase()," desc")?{columnId:Qd(i.substr(0,i.length-5)),sortAsc:!1}:{columnId:i,sortAsc:!0}});this.slickGrid.setSortColumns(t)}itemAt(e){return this.slickGrid.getDataItem(e)}rowCount(){return this.slickGrid.getDataLength()}getItems(){return this.view.getItems()}setItems(e){this.view.setItems(e,!0)}bindToSlickEvents(){var e=this;this._slickGridOnSort=(t,i)=>{e.view.populateLock();try{var r=[],a;if(i.multiColumnSort)for(var o=0;o<i.sortCols.length;o++){var l=i.sortCols[o];a=l.sortCol,a==null&&(a={}),r.push(a.field+(l.sortAsc?"":" DESC"))}else{var a=i.sortCol;a==null&&(a={}),r.push(a.field+(i.sortAsc?"":" DESC"))}e.view.seekToPage=1,e.view.sortBy=r}finally{e.view.populateUnlock()}e.view.getLocalSort&&e.view.getLocalSort()?e.view.sort():e.view.populate(),this.persistSettings(null)},this.slickGrid.onSort.subscribe(this._slickGridOnSort),this._slickGridOnClick=(t,i)=>{e.onClick(t,i.row,i.cell)},this.slickGrid.onClick.subscribe(this._slickGridOnClick),this.slickGrid.onColumnsReordered.subscribe((t,i)=>this.persistSettings(null)),this.slickGrid.onColumnsResized.subscribe((t,i)=>this.persistSettings(null))}getAddButtonCaption(){var e;return(e=Nr("Controls.DataGrid.NewButton"))!=null?e:"New"}getButtons(){return[]}editItem(e){throw new Error("Not Implemented!")}editItemOfType(e,t){if(e===this.getItemType()){this.editItem(t);return}throw new Error("Not Implemented!")}onClick(e,t,i){if(!e.isDefaultPrevented()){var r=$(e.target);r.hasClass("s-EditLink")||(r=r.closest("a")),r.hasClass("s-EditLink")&&(e.preventDefault(),this.editItemOfType(we.getItemType(r),we.getItemId(r)))}}viewDataChanged(e,t){this.markupReady(),this.layout()}bindToViewEvents(){var e=this;this.view.onDataChanged.subscribe(function(t,i){return e.viewDataChanged(t,i)}),this.view.onSubmit=function(t){return e.onViewSubmit()},this.view.setFilter(function(t,i){return e.onViewFilter(t)}),this.view.onProcessData=function(t,i){return e.onViewProcessData(t)}}onViewProcessData(e){return e}onViewFilter(e){return!0}getIncludeColumns(e){var t=this.slickGrid.getColumns();for(var i of t)if(i.field&&(e[i.field]=!0),i.referencedFields)for(var r of i.referencedFields)e[r]=!0}setCriteriaParameter(){if(delete this.view.params.Criteria,this.filterBar){var e=this.filterBar.get_store().get_activeCriteria();Cd.isEmpty(e)||(this.view.params.Criteria=e)}}setEquality(e,t){Rd(this.view.params,e,t)}setIncludeColumnsParameter(){var e={};this.getIncludeColumns(e);var t=[];for(var i of Object.keys(e))t.push(i);this.view.params.IncludeColumns=t}onViewSubmit(){return this._isDisabled||!this.getGridCanLoad()?!1:(this.setCriteriaParameter(),this.setIncludeColumnsParameter(),this.invokeSubmitHandlers(),!0)}markupReady(){}createSlickContainer(){return $('<div class="grid-container"></div>').appendTo(this.element)}createView(){var e=this.getViewOptions();return new Bd(e)}getDefaultSortBy(){if(this.slickGrid){var e=this.slickGrid.getColumns().filter(function(a){return a.sortOrder&&a.sortOrder!==0});if(e.length>0){e.sort(function(a,o){return Math.abs(a.sortOrder)<Math.abs(o.sortOrder)?-1:Math.abs(a.sortOrder)>Math.abs(o.sortOrder)?1:0});for(var t=[],i=0;i<e.length;i++){var r=e[i];t.push(r.field+(r.sortOrder<0?" DESC":""))}return t}}return[]}usePager(){return!1}enableFiltering(){var e=this.attrs(at);return e.length>0&&e[0].value}populateWhenVisible(){return!1}createFilterBar(){var e=$("<div/>").appendTo(this.element);this.filterBar=new zt(e),this.initializeFilterBar()}getPagerOptions(){return{view:this.view,rowsPerPage:20,rowsPerPageOptions:[20,100,500,2500]}}createPager(){var e=$("<div></div>").appendTo(this.element);new Ht(e,this.getPagerOptions())}getViewOptions(){var e={};return e.idField=this.getIdProperty(),e.sortBy=this.getDefaultSortBy(),this.usePager()?this.element.hasClass("responsive-height")?e.rowsPerPage=$(window.window).width()<768?20:100:e.rowsPerPage=100:e.rowsPerPage=0,e.getItemMetadata=(t,i)=>this.getItemMetadata(t,i),e}createToolbar(e){var t=$('<div class="grid-toolbar"></div>').appendTo(this.element);this.toolbar=new A(t,{buttons:e,hotkeyContext:this.element[0]})}getTitle(){return this.titleDiv?this.titleDiv.children(".title-text").text():null}setTitle(e){e!==this.getTitle()&&(e==null?this.titleDiv&&(this.titleDiv.remove(),this.titleDiv=null):(this.titleDiv||(this.titleDiv=$('<div class="grid-title"><div class="title-text"></div></div>').prependTo(this.element)),this.titleDiv.children(".title-text").text(e)),this.layout())}getItemType(){return"Item"}itemLink(e,t,i,r,a=!0){return e==null&&(e=this.getItemType()),t==null&&(t=this.getIdProperty()),we.itemLink(e,t,i,r,a)}getColumnsKey(){var e=this.attrs(kt);return e&&e.length>0?e[0].value:null}getPropertyItems(){var e;return((e=this.propertyItemsData)==null?void 0:e.items)||[]}getPropertyItemsData(){var e=this.getColumnsKey();return this.getColumnsKey===N.prototype.getColumnsKey&&this.getPropertyItems!==N.prototype.getPropertyItems&&!Ed.canLoad("Columns."+e)?{items:this.getPropertyItems(),additionalItems:[]}:U(e)?{items:[],additionalItems:[]}:kd(e)}getPropertyItemsDataAsync(){return _e(this,null,function*(){var e=this.getColumnsKey();return U(e)?{items:[],additionalItems:[]}:yield Od(e)})}getColumns(){return this.propertyItemsToSlickColumns(this.getPropertyItems())}propertyItemsToSlickColumns(e){for(var t=Vr.toSlickColumns(e),i=0;i<e.length;i++){var r=e[i],a=t[i];if(r.editLink===!0){var o={$:a.format},l={$:r.editLinkCssClass!=null?r.editLinkCssClass:null};a.format=this.itemLink(r.editLinkItemType!=null?r.editLinkItemType:null,r.editLinkIdField!=null?r.editLinkIdField:null,function(d){return this.oldFormat.$!=null?this.oldFormat.$(d):_d(d.value)}.bind({oldFormat:o}),function(d){var p;return(p=this.css.$)!=null?p:""}.bind({css:l}),!1),U(r.editLinkIdField)||(a.referencedFields=a.referencedFields||[],a.referencedFields.push(r.editLinkIdField))}}return t}getSlickOptions(){var e={};return e.multiSelect=!1,e.multiColumnSort=!0,e.enableCellNavigation=!1,N.defaultHeaderHeight&&(e.headerRowHeight=N.defaultHeaderHeight),N.defaultRowHeight&&(e.rowHeight=N.defaultRowHeight),e}populateLock(){this.view.populateLock()}populateUnlock(){this.view.populateUnlock()}getGridCanLoad(){return!0}refresh(){if(!this.populateWhenVisible()){this.internalRefresh();return}if(this.slickContainer.is(":visible")){this.slickContainer.data("needsRefresh",!1),this.internalRefresh();return}this.slickContainer.data("needsRefresh",!0)}refreshIfNeeded(){this.slickContainer.data("needsRefresh")&&(this.slickContainer.data("needsRefresh",!1),this.internalRefresh())}internalRefresh(){this.view.populate()}setIsDisabled(e){this._isDisabled!==e&&(this._isDisabled=e,this._isDisabled&&this.view.setItems([],!0),this.updateDisabledState())}get readOnly(){return this.get_readOnly()}set readOnly(e){this.set_readOnly(e)}get_readOnly(){return!!this._readonly}set_readOnly(e){!!this._readonly!=!!e&&(this._readonly=!!e,this.updateInterface())}updateInterface(){this.toolbar&&this.toolbar.updateInterface()}getRowDefinition(){return null}getLocalTextDbPrefix(){var e;return this._localTextDbPrefix!=null?this._localTextDbPrefix:(this._localTextDbPrefix=(e=this.getLocalTextPrefix())!=null?e:"",this._localTextDbPrefix.length>0&&!fs(this._localTextDbPrefix,".")&&(this._localTextDbPrefix="Db."+this._localTextDbPrefix+"."),this._localTextDbPrefix)}getLocalTextPrefix(){var e=this.getRowDefinition();if(e)return e.localTextPrefix;var t=this.attrs(Me);if(t.length>=1)return t[0].value}getIdProperty(){var i,r;if(this._idProperty!=null)return this._idProperty;var e=this.getRowDefinition();if(e)return this._idProperty=(i=e.idProperty)!=null?i:"";var t=this.attrs(We);return t.length===1?this._idProperty=(r=t[0].value)!=null?r:"":this._idProperty="ID"}getIsDeletedProperty(){var e;return(e=this.getRowDefinition())==null?void 0:e.isDeletedProperty}getIsActiveProperty(){var i,r;if(this._isActiveProperty!=null)return this._isActiveProperty;var e=this.getRowDefinition();if(e)return this._isActiveProperty=(i=e.isActiveProperty)!=null?i:"";var t=this.attrs(Je);return t.length===1?this._isActiveProperty=(r=t[0].value)!=null?r:"":this._isActiveProperty=""}updateDisabledState(){this.slickContainer.toggleClass("ui-state-disabled",!!this._isDisabled)}resizeCanvas(){var e;(e=this.slickGrid)==null||e.resizeCanvas()}subDialogDataChange(){this.refresh()}addFilterSeparator(){this.ensureQuickFilterBar().addSeparator()}determineText(e){var t=this.getLocalTextDbPrefix();if(!U(t)){var i=Nr(e(t));if(i!=null)return i}return null}addQuickFilter(e){return this.ensureQuickFilterBar().add(e)}addDateRangeFilter(e,t){return this.ensureQuickFilterBar().addDateRange(e,t)}dateRangeQuickFilter(e,t){return q.dateRange(e,t)}addDateTimeRangeFilter(e,t){return this.ensureQuickFilterBar().addDateTimeRange(e,t)}dateTimeRangeQuickFilter(e,t){return q.dateTimeRange(e,t)}addBooleanFilter(e,t,i,r){return this.ensureQuickFilterBar().addBoolean(e,t,i,r)}booleanQuickFilter(e,t,i,r){return q.boolean(e,t,i,r)}invokeSubmitHandlers(){this.quickFiltersBar!=null&&this.quickFiltersBar.onSubmit(this.view.params)}quickFilterChange(e){this.persistSettings(null),this.view&&(this.view.seekToPage=1),this.refresh()}getPersistanceStorage(){return N.defaultPersistanceStorage}getPersistanceKey(){var e="GridSettings:",t=window.location.pathname;return U(t)||(e+=t.substr(1).split(String.fromCharCode(47)).slice(0,2).join("/")+":"),e+=wd($n(this)),e}gridPersistanceFlags(){return{}}canShowColumn(e){if(e==null)return!1;var t=e.sourceItem;return t==null?!0:t.filterOnly===!0?!1:t.readPermission==null?!0:gs.hasPermission(t.readPermission)}getPersistedSettings(){var e=this.getPersistanceStorage();if(e==null)return null;var t=Nd(e.getItem(this.getPersistanceKey()));return t!=null&&Vd(t,"{")&&fs(t,"}")?JSON.parse(t):null}restoreSettings(e,t){if(this.slickGrid&&!(e==null&&(e=this.getPersistedSettings(),e==null))){var i=this.slickGrid.getColumns(),r=null,a=function(K){r={};for(var de=0;de<K.length;de++){var Tt=K[de];r[Tt.id]=Tt}};this.view.beginUpdate(),this.restoringSettings++;try{if(t=t||this.gridPersistanceFlags(),e.columns!=null){if(t.columnVisibility!==!1){var o={};a(this.allColumns);for(var l=[],d=0;d<e.columns.length;d++){var p=e.columns[d];if(p.id!=null&&p.visible===!0){var u=r[p.id];this.canShowColumn(u)&&(u.visible=!0,l.push(u),delete r[p.id])}}for(var g=0;g<this.allColumns.length;g++){var v=this.allColumns[g];r[v.id]!=null&&(v.visible=!1,l.push(v))}this.allColumns=l,i=this.allColumns.filter(function(K){return K.visible===!0})}if(t.columnWidths!==!1){a(i);for(var f=0;f<e.columns.length;f++){var y=e.columns[f];if(y.id!=null&&y.width!=null&&y.width!==0){var C=r[y.id];C!=null&&(C.width=y.width)}}}if(t.sortColumns!==!1){a(i);var S=[],O=e.columns.filter(function(K){var de;return K.id!=null&&((de=K.sort)!=null?de:0)!==0});O.sort(function(K,de){return Math.abs(K.sort)-Math.abs(de.sort)});for(var T=0;T<O.length;T++){var _=O[T],x=r[_.id];x!=null&&S.push({columnId:_.id,sortAsc:_.sort>0})}this.view.sortBy=S.map(function(K){return K.columnId+(K.sortAsc===!1?" DESC":"")}),this.slickGrid.setSortColumns(S)}this.slickGrid.setColumns(i),this.slickGrid.invalidate()}if(e.filterItems!=null&&t.filterItems!==!1&&this.filterBar!=null&&this.filterBar.get_store()!=null){var I=this.filterBar.get_store().get_items();I.length=0,I.push.apply(I,e.filterItems),this.filterBar.get_store().raiseChanged()}if(e.includeDeleted!=null&&t.includeDeleted!==!1){var E=this.element.find(".s-IncludeDeletedToggle");!!e.includeDeleted!==E.hasClass("pressed")&&E.children("a").click()}if(e.quickFilters!=null&&t.quickFilters!==!1&&this.quickFiltersDiv!=null&&this.quickFiltersDiv.length>0&&this.quickFiltersDiv.find(".quick-filter-item").each((K,de)=>{var Tt=$(de).data("qffield");if(!U(Tt)){var Hr=$("#"+this.uniqueName+"_QuickFilter_"+Tt).tryGetWidget(b);if(Hr!=null){var Os=e.quickFilters[Tt],ws=$(de).data("qfloadstate");ws!=null?ws(Hr,Os):w.setValue(Hr,Os)}}}),t.quickSearch===!0&&(e.quickSearchField!==void 0||e.quickSearchText!==void 0)){var j=this.toolbar.element.find(".s-QuickSearchInput").first();if(j.length>0){var ks=j.tryGetWidget(te);ks&&ks.restoreState(e.quickSearchText,e.quickSearchField)}}}finally{this.restoringSettings--,this.view.endUpdate()}}}persistSettings(e){var t=this.getPersistanceStorage();if(t){var i=this.getCurrentSettings(e);t.setItem(this.getPersistanceKey(),JSON.stringify(i))}}getCurrentSettings(e){e=e||this.gridPersistanceFlags();var t={};if(e.columnVisibility!==!1||e.columnWidths!==!1||e.sortColumns!==!1){t.columns=[];var i=this.slickGrid.getSortColumns(),r=this.slickGrid.getColumns();for(var a of r){var o={id:a.id};if(e.columnVisibility!==!1&&(o.visible=!0),e.columnWidths!==!1&&(o.width=a.width),e.sortColumns!==!1){var l=Dd(i,u=>u.columnId==a.id);o.sort=l>=0?i[l].sortAsc!==!1?l+1:-l-1:0}t.columns.push(o)}}if(e.includeDeleted!==!1&&(t.includeDeleted=this.element.find(".s-IncludeDeletedToggle").hasClass("pressed")),e.filterItems!==!1&&this.filterBar!=null&&this.filterBar.get_store()!=null&&(t.filterItems=this.filterBar.get_store().get_items().slice()),e.quickSearch===!0){var d=this.toolbar.element.find(".s-QuickSearchInput").first();if(d.length>0){var p=d.tryGetWidget(te);p!=null&&(t.quickSearchField=p.get_field(),t.quickSearchText=p.element.val())}}return e.quickFilters!==!1&&this.quickFiltersDiv!=null&&this.quickFiltersDiv.length>0&&(t.quickFilters={},this.quickFiltersDiv.find(".quick-filter-item").each((u,g)=>{var _;var v=$(g).data("qffield");if(!U(v)){var f=$("#"+this.uniqueName+"_QuickFilter_"+v).tryGetWidget(b);if(f!=null){var y=$(g).data("qfsavestate"),C=y!=null?y(f):w.getValue(f);if(t.quickFilters[v]=C,e.quickFilterText===!0&&$(g).hasClass("quick-filter-active")){var S=$(g).data("qfdisplaytext"),O=$(g).find(".quick-filter-label").text(),T;S!=null?T=S(f,O):T=O+" = "+w.getDisplayText(f),U(T)||(U(t.quickFilterText)?t.quickFilterText=T:(t.quickFilterText+=" "+((_=Nr("Controls.FilterPanel.And"))!=null?_:"and")+" ",t.quickFilterText+=T))}}}})),t}getElement(){return this.element}getGrid(){return this.slickGrid}getView(){return this.view}getFilterStore(){return this.filterBar==null?null:this.filterBar.get_store()}};N=h([m.registerClass("Serenity.DataGrid",[R]),m.element("<div/>")],N);import{Authorization as Ad,centerDialog as qd,Culture as Wd,htmlEncode as ci,Router as vs,localText as Ge,trimToNull as Jd}from"@serenity-is/corelib/q";var rt=class extends Q{constructor(){super();new te(this.byId("Search"),{onSearch:(e,t,i)=>{t=Jd(t),t!=null&&(t=Select2.util.stripDiacritics(t.toLowerCase())),this.element.find("li").each((r,a)=>{$(a).toggle(!t||Select2.util.stripDiacritics($(a).text().toLowerCase()).indexOf(t)>=0)}),i&&i(!0)}}),this.ulVisible=this.byId("VisibleCols"),this.ulHidden=this.byId("HiddenCols"),this.dialogTitle=Ge("Controls.ColumnPickerDialog.Title")}static createToolButton(e){function t(){var i=new rt;if(i.allColumns=e.allColumns,e.initialSettings){var r=e.initialSettings;r.columns&&r.columns.length&&(i.defaultColumns=r.columns.map(a=>a.id))}i.visibleColumns=e.getGrid().getColumns().map(a=>a.id),i.done=()=>{e.allColumns=i.allColumns;var a=i.allColumns.filter(o=>o.visible===!0);e.getGrid().setColumns(a),e.persistSettings(),e.getView().populate()},vs&&vs.dialog&&vs.dialog(e.element,i.element,()=>"columns"),i.dialogOpen()}return e.element.on("handleroute."+e.uniqueName,(i,r)=>{r&&!r.handled&&r.route=="columns"&&t()}),{hint:Ge("Controls.ColumnPickerDialog.Title"),cssClass:"column-picker-button",icon:"fa-th-list text-blue",onClick:t}}getDialogButtons(){return[{text:Ge("Controls.ColumnPickerDialog.RestoreDefaults"),click:()=>{let e={};this.ulVisible.children().add(this.ulHidden.children()).each((i,r)=>{let a=$(r);e[a.data("key")]=a});let t=null;for(let i of this.defaultColumns){let r=e[i];if(!r)continue;t==null?r.prependTo(this.ulVisible):r.insertAfter(t),t=r;let a=r.data("key");delete e[a]}for(let i in e)e[i].appendTo(this.ulHidden);this.updateListStates()}},{text:Ge("Dialogs.OkButton"),click:()=>{let e=[];for(var t of this.allColumns)t.visible=!1;this.visibleColumns=this.ulVisible.children().toArray().map(i=>{let r=$(i).data("key");var a=this.colById[r];return a.visible=!0,e.push(a),r});for(var t of this.allColumns)t.visible||e.push(t);this.allColumns=e,this.done&&this.done(),this.dialogClose()}},{text:Ge("Dialogs.CancelButton"),click:()=>{this.dialogClose()}}]}getDialogOptions(){var e=super.getDialogOptions();return e.width=600,e}getTitle(e){return e.id=="__select__"?"[x]":e.name||e.toolTip||e.id}allowHide(e){return e.sourceItem==null||e.sourceItem.allowHide==null||e.sourceItem.allowHide}createLI(e){var t=this.allowHide(e);return $(`
<li data-key="${e.id}" class="${t?"":"cant-hide"}">
<span class="drag-handle">\u2630</span>
${ci(this.getTitle(e))}
${t?`<i class="js-hide fa fa-eye-slash" title="${ci(Ge("Controls.ColumnPickerDialog.HideHint"))}"></i>`:""}
<i class="js-show fa fa-eye" title="${ci(Ge("Controls.ColumnPickerDialog.ShowHint"))}"></i>
</li>`)}updateListStates(){this.ulVisible.children().removeClass("bg-info").addClass("bg-success"),this.ulHidden.children().removeClass("bg-success").addClass("bg-info")}setupColumns(){this.allColumns=this.allColumns||[],this.visibleColumns=this.visibleColumns||[];let e={};for(let a of this.visibleColumns)e[a]=!0;this.colById={};for(let a of this.allColumns)this.colById[a.id]=a;this.defaultColumns==null&&(this.defaultColumns=this.visibleColumns.slice(0));let t=[];for(let a of this.allColumns)!e[a.id]&&(!a.sourceItem||a.sourceItem.filterOnly!==!0&&(a.sourceItem.readPermission==null||Ad.hasPermission(a.sourceItem.readPermission)))&&t.push(a);let i=t.sort((a,o)=>Wd.stringCompare(this.getTitle(a),this.getTitle(o)));for(let a of this.visibleColumns){var r=this.colById[a];r&&this.createLI(r).appendTo(this.ulVisible)}for(let a of i)this.createLI(a).appendTo(this.ulHidden);this.updateListStates(),typeof Sortable!="undefined"&&Sortable.create&&(Sortable.create(this.ulVisible[0],{group:this.uniqueName+"_group",filter:".js-hide",onFilter:a=>{$(a.item).appendTo(this.ulHidden),this.updateListStates()},onMove:a=>!($(a.dragged).hasClass("cant-hide")&&a.from==this.ulVisible[0]&&a.to!==a.from),onEnd:a=>this.updateListStates()}),Sortable.create(this.ulHidden[0],{group:this.uniqueName+"_group",sort:!1,filter:".js-show",onFilter:a=>{$(a.item).appendTo(this.ulVisible),this.updateListStates()},onEnd:()=>this.updateListStates()}))}onDialogOpen(){super.onDialogOpen(),this.element.find("input").removeAttr("disabled"),this.element.closest(".ui-dialog").children(".ui-dialog-buttonpane").find("button").eq(0).addClass("restore-defaults").next().focus(),this.setupColumns(),qd(this.element)}getTemplate(){return`
<div class="search"><input id="~_Search" type="text" disabled /></div>
<div class="columns-container">
<div class="column-list visible-list bg-success">
<h5><i class="fa fa-eye"></i> ${ci(Ge("Controls.ColumnPickerDialog.VisibleColumns"))}</h5>
<ul id="~_VisibleCols"></ul>
</div>
<div class="column-list hidden-list bg-info">
<h5><i class="fa fa-eye-slash"></i> ${ci(Ge("Controls.ColumnPickerDialog.HiddenColumns"))}</h5>
<ul id="~_HiddenCols"></ul>
</div>
</div>`}};rt=h([m.registerClass("Serenity.ColumnPickerDialog"),m.resizable(),m.responsive()],rt);import{htmlEncode as Md,toGrouping as zn,tryFirst as $d}from"@serenity-is/corelib/q";var Br=class{constructor(n){this.options=n;var e=this.dataGrid=n.grid,t=e.getIdProperty(),i=this.getId=l=>l[t];e.element.find(".grid-container").on("click",l=>{if($(l.target).hasClass("s-TreeToggle")){var d=e.slickGrid.getCellFromEvent(l);d.cell>=0&&d.row>=0&&ie.toggleClick(l,d.row,d.row,e.view,i)}});var r=e.onViewFilter;e.onViewFilter=function(l){return r.apply(this,[l])?ie.filterById(l,e.view,n.getParentId):!1};var a=e.onViewProcessData;if(e.onViewProcessData=function(l){return l=a.apply(this,[l]),l.Entities=Br.applyTreeOrdering(l.Entities,i,n.getParentId),ie.setIndents(l.Entities,i,n.getParentId,n.initialCollapse&&n.initialCollapse()||!1),l},n.toggleField){var o=$d(e.allColumns||e.slickGrid.getColumns()||[],l=>l.field==n.toggleField);o&&(o.format=we.treeToggle(()=>e.view,i,o.format||(l=>Md(l.value))))}}toggleAll(){ie.setCollapsed(this.dataGrid.view.getItems(),!this.dataGrid.view.getItems().every(n=>n._collapsed==!0)),this.dataGrid.view.setItems(this.dataGrid.view.getItems(),!0)}collapseAll(){ie.setCollapsed(this.dataGrid.view.getItems(),!0),this.dataGrid.view.setItems(this.dataGrid.view.getItems(),!0)}expandAll(){ie.setCollapsed(this.dataGrid.view.getItems(),!1),this.dataGrid.view.setItems(this.dataGrid.view.getItems(),!0)}static applyTreeOrdering(n,e,t){var i=[],r=zn(n,e),a=zn(n,t),o={};function l(u){if(!o[u]){o[u]=!0;for(var g of a[u]||[])i.push(g),l(e(g))}}for(var d of n){var p=t(d);(p==null||!(r[p]||[]).length)&&(i.push(d),l(e(d)))}return i}};import{Culture as zd,getLookup as Hd,htmlEncode as Ud,isEmptyOrNull as Yt,ScriptData as jd,trimToNull as Kd,tryGetText as Yd}from"@serenity-is/corelib/q";var hi=class extends N{constructor(e,t){super(e,t);e.addClass("s-CheckTreeEditor"),this.updateItems()}getIdProperty(){return"id"}getTreeItems(){return[]}updateItems(){for(var e=this.getTreeItems(),t={},i=0;i<e.length;i++){var r=e[i];if(r.children=[],Yt(r.id)||(t[r.id]=r),!Yt(r.parentId)){var a=t[r.parentId];a!=null&&a.children.push(r)}}this.view.addData({Entities:e,Skip:0,Take:0,TotalCount:e.length}),this.updateSelectAll(),this.updateFlags()}getEditValue(e,t){this.getDelimited()?t[e.name]=this.get_value().join(","):t[e.name]=this.get_value()}setEditValue(e,t){var i=e[t.name];this.set_value(i)}getButtons(){var e=this.getSelectAllText();if(Yt(e))return null;var t=this,i=[];return i.push(pi.define(function(){return t},function(r){return r.id},function(r){return r.isSelected},(r,a)=>{r.isSelected!==a&&(r.isSelected=a,this.itemSelectedChanged(r))},null,()=>{this.updateFlags()})),i}itemSelectedChanged(e){}getSelectAllText(){var e;return(e=Yd("Controls.CheckTreeEditor.SelectAll"))!=null?e:"Select All"}isThreeStateHierarchy(){return!1}createSlickGrid(){this.element.addClass("slick-no-cell-border").addClass("slick-no-odd-even");var e=super.createSlickGrid();return this.element.addClass("slick-hide-header"),e.resizeCanvas(),e}onViewFilter(e){if(!super.onViewFilter(e))return!1;var t=this.view.getItems(),i=this;return ie.filterCustom(e,function(r){if(r.parentId==null)return null;if(i.byId==null){i.byId={};for(var a=0;a<t.length;a++){var o=t[a];o.id!=null&&(i.byId[o.id]=o)}}return i.byId[r.parentId]})}getInitialCollapse(){return!1}onViewProcessData(e){return e=super.onViewProcessData(e),this.byId=null,ie.setIndents(e.Entities,function(t){return t.id},function(t){return t.parentId},this.getInitialCollapse()),e}onClick(e,t,i){if(super.onClick(e,t,i),e.isDefaultPrevented()||ie.toggleClick(e,t,i,this.view,function(d){return d.id}),!e.isDefaultPrevented()){var r=$(e.target);if(r.hasClass("check-box")){if(e.preventDefault(),this._readOnly)return;var a=r.hasClass("checked")||r.hasClass("partial"),o=this.itemAt(t),l=o.isSelected!==!a;this.view.beginUpdate();try{o.isSelected!==!a&&(o.isSelected=!a,this.view.updateItem(o.id,o),this.itemSelectedChanged(o)),l=this.setAllSubTreeSelected(o,o.isSelected)||l,this.updateSelectAll(),this.updateFlags()}finally{this.view.endUpdate()}l&&this.element.triggerHandler("change")}}}updateSelectAll(){pi.update(this,function(e){return e.isSelected})}updateFlags(){var e=this.view,t=e.getItems(),i=this.isThreeStateHierarchy();if(i){e.beginUpdate();try{for(var r=0;r<t.length;r++){var a=t[r];if(a.children==null||a.children.length===0){var o=this.getDescendantsSelected(a);o!==a.isAllDescendantsSelected&&(a.isAllDescendantsSelected=o,e.updateItem(a.id,a));continue}var l=this.allDescendantsSelected(a),d=l||this.anyDescendantsSelected(a);if(l!==a.isAllDescendantsSelected||d!==a.isSelected){var p=a.isSelected!==d;a.isAllDescendantsSelected=l,a.isSelected=d,e.updateItem(a.id,a),p&&this.itemSelectedChanged(a)}}}finally{e.endUpdate()}}}getDescendantsSelected(e){return!0}setAllSubTreeSelected(e,t){for(var i=!1,r=0;r<e.children.length;r++){var a=e.children[r];a.isSelected!==t&&(i=!0,a.isSelected=t,this.view.updateItem(a.id,a),this.itemSelectedChanged(a)),a.children.length>0&&(i=this.setAllSubTreeSelected(a,t)||i)}return i}allItemsSelected(){for(var e=0;e<this.rowCount();e++){var t=this.itemAt(e);if(!t.isSelected)return!1}return this.rowCount()>0}allDescendantsSelected(e){if(e.children.length>0)for(var t=0;t<e.children.length;t++){var i=e.children[t];if(!i.isSelected||!this.allDescendantsSelected(i))return!1}return!0}getDelimited(){return!!this.options.delimited}anyDescendantsSelected(e){if(e.children.length>0)for(var t=0;t<e.children.length;t++){var i=e.children[t];if(i.isSelected||this.anyDescendantsSelected(i))return!0}return!1}getColumns(){var e=this,t=[];return t.push({field:"text",name:"Kay\u0131t",width:80,format:we.treeToggle(function(){return e.view},function(i){return i.id},i=>{var r="check-box",a=i.item;if(a.hideCheckBox)return this.getItemText(i);var o=this.isThreeStateHierarchy();return a.isSelected&&(o&&!a.isAllDescendantsSelected?r+=" partial":r+=" checked"),this._readOnly&&(r+=" readonly"),'<span class="'+r+'"></span>'+this.getItemText(i)})}),t}getItemText(e){return Ud(e.value)}getSlickOptions(){var e=super.getSlickOptions();return e.forceFitColumns=!0,e}sortItems(){if(this.moveSelectedUp()){for(var e={},t=this.view.getItems(),i=0,r=0;r<t.length;r++){var a=t[r];e[a.id]=i++}t.sort(function(o,l){if(o.isSelected&&!l.isSelected)return-1;if(l.isSelected&&!o.isSelected)return 1;var d=zd.stringCompare(o.text,l.text);return d!==0?d:e[o.id]<e[l.id]?-1:e[o.id]>e[l.id]?1:0}),this.view.setItems(t,!0)}}moveSelectedUp(){return!1}get_readOnly(){return this._readOnly}set_readOnly(e){!!this._readOnly!=!!e&&(this._readOnly=!!e,this.view.refresh())}get_value(){for(var e=[],t=this.view.getItems(),i=0;i<t.length;i++)t[i].isSelected&&e.push(t[i].id);return e}get value(){return this.get_value()}set_value(e){var t={};if(e!=null){typeof e=="string"&&(e=e.split(",").map(d=>Kd(d)).filter(d=>d!=null));for(var i=0;i<e.length;i++)t[e[i]]=!0}this.view.beginUpdate();try{for(var r=this.view.getItems(),a=0;a<r.length;a++){var o=r[a],l=t[o.id];l!==o.isSelected&&(o.isSelected=l,this.view.updateItem(o.id,o))}this.updateSelectAll(),this.updateFlags(),this.sortItems()}finally{this.view.endUpdate()}}set value(e){this.set_value(e)}};hi=h([m.registerEditor("Serenity.CheckTreeEditor",[X,Z,R]),m.element("<div/>")],hi);var Lr=class extends hi{constructor(e,t){super(e,t);this.enableUpdateItems=!0,this.setCascadeFrom(this.options.cascadeFrom),this.updateItems(),jd.bindToChange("Lookup."+this.getLookupKey(),this.uniqueName,()=>this.updateItems())}updateItems(){this.enableUpdateItems&&super.updateItems()}getLookupKey(){return this.options.lookupKey}getButtons(){var e;return(e=super.getButtons())!=null?e:this.options.hideSearch?null:[]}createToolbarExtensions(){super.createToolbarExtensions(),It.addQuickSearchInputCustom(this.toolbar.element,(e,t)=>{this.searchText=Select2.util.stripDiacritics(t||"").toUpperCase(),this.view.setItems(this.view.getItems(),!0)})}getSelectAllText(){return this.options.showSelectAll?super.getSelectAllText():null}cascadeItems(e){var t=this.get_cascadeValue();if(t==null||t==="")return Yt(this.get_cascadeField())?e:[];var i=t.toString(),r=this.get_cascadeField();return e.filter(a=>{var l;var o=(l=a[r])!=null?l:re.getPropertyValue(a,r);return o!=null&&o.toString()===i})}filterItems(e){var t=this.get_filterValue();if(t==null||t==="")return e;var i=t.toString(),r=this.get_filterField();return e.filter(a=>{var l;var o=(l=a[r])!=null?l:re.getPropertyValue(a,r);return o!=null&&o.toString()===i})}getLookupItems(e){return this.filterItems(this.cascadeItems(e.items))}getTreeItems(){var e=Hd(this.options.lookupKey),t=this.getLookupItems(e);return t.map(i=>{var r,a;return{id:((r=i[e.idField])!=null?r:"").toString(),text:((a=i[e.textField])!=null?a:"").toString(),source:i}})}onViewFilter(e){return super.onViewFilter(e)&&(Yt(this.searchText)||Select2.util.stripDiacritics(e.text||"").toUpperCase().indexOf(this.searchText)>=0)}moveSelectedUp(){return this.options.checkedOnTop}get_cascadeFrom(){return this.options.cascadeFrom}get cascadeFrom(){return this.get_cascadeFrom()}getCascadeFromValue(e){return w.getValue(e)}setCascadeFrom(e){if(Yt(e)){this.cascadeLink!=null&&(this.cascadeLink.set_parentID(null),this.cascadeLink=null),this.options.cascadeFrom=null;return}this.cascadeLink=new je(b,this,t=>{this.set_cascadeValue(this.getCascadeFromValue(t))}),this.cascadeLink.set_parentID(e),this.options.cascadeFrom=e}set_cascadeFrom(e){e!==this.options.cascadeFrom&&(this.setCascadeFrom(e),this.updateItems())}set cascadeFrom(e){this.set_cascadeFrom(e)}get_cascadeField(){var e;return(e=this.options.cascadeField)!=null?e:this.options.cascadeFrom}get cascadeField(){return this.get_cascadeField()}set_cascadeField(e){this.options.cascadeField=e}set cascadeField(e){this.set_cascadeField(e)}get_cascadeValue(){return this.options.cascadeValue}get cascadeValue(){return this.get_cascadeValue()}set_cascadeValue(e){this.options.cascadeValue!==e&&(this.options.cascadeValue=e,this.value=[],this.updateItems())}set cascadeValue(e){this.set_cascadeValue(e)}get_filterField(){return this.options.filterField}get filterField(){return this.get_filterField()}set_filterField(e){this.options.filterField=e}set filterField(e){this.set_filterField(e)}get_filterValue(){return this.options.filterValue}get filterValue(){return this.get_filterValue()}set_filterValue(e){this.options.filterValue!==e&&(this.options.filterValue=e,this.value=null,this.updateItems())}set filterValue(e){this.set_filterValue(e)}};Lr=h([m.registerEditor("Serenity.CheckLookupEditor")],Lr);import{Authorization as Xd,endsWith as Hn,format as bs,getInstanceType as Cs,getTypeFullName as xs,LT as Un,replaceAll as Zd,resolveUrl as eu,Router as Gr,safeCast as jn,localText as Is,tryGetText as Kn}from"@serenity-is/corelib/q";var Ar=class extends N{constructor(e,t){super(e,t);this.element.addClass("route-handler").on("handleroute."+this.uniqueName,(i,r)=>this.handleRoute(r))}handleRoute(e){if(!e.handled){if(e.route==="new"){e.handled=!0,this.addButtonClick();return}var t=jQuery.active,i=e.route.split("/");if(i.length===2&&i[0]==="edit")e.handled=!0,this.editItem(decodeURIComponent(i[1]));else if(i.length===2&&i[1]==="new")e.handled=!0,this.editItemOfType(i[0],null);else if(i.length===3&&i[1]==="edit")e.handled=!0,this.editItemOfType(i[0],decodeURIComponent(i[2]));else return;jQuery.active>t&&e.handled&&e.index>=0&&e.index<e.parts.length-1&&$(document).one("ajaxStop",()=>{setTimeout(()=>Gr.resolve("#"+e.parts.join("/+/")),1)})}}usePager(){return!0}createToolbarExtensions(){this.createIncludeDeletedButton(),this.createQuickSearchInput()}getInitialTitle(){return this.getDisplayName()}getLocalTextPrefix(){var e=super.getLocalTextPrefix();return e!=null||this.getRowDefinition()?e:this.getEntityType()}getEntityType(){if(this._entityType!=null)return this._entityType;var e=this.attrs(qe);if(e.length===1)return this._entityType=e[0].value;var t=xs(Cs(this)),i=t.indexOf(".");return i>=0&&(t=t.substring(i+1)),Hn(t,"Grid")?t=t.substr(0,t.length-4):Hn(t,"SubGrid")&&(t=t.substr(0,t.length-7)),this._entityType=t,this._entityType}getDisplayName(){if(this._displayName!=null)return this._displayName;var e=this.attrs(De);return e.length>=1?(this._displayName=e[0].displayName,this._displayName=Un.getDefault(this._displayName,this._displayName)):(this._displayName=Kn(this.getLocalTextDbPrefix()+"EntityPlural"),this._displayName==null&&(this._displayName=this.getEntityType())),this._displayName}getItemName(){if(this._itemName!=null)return this._itemName;var e=this.attrs(Pe);return e.length>=1?(this._itemName=e[0].value,this._itemName=Un.getDefault(this._itemName,this._itemName)):(this._itemName=Kn(this.getLocalTextDbPrefix()+"EntitySingular"),this._itemName==null&&(this._itemName=this.getEntityType())),this._itemName}getAddButtonCaption(){return bs(Is("Controls.EntityGrid.NewButton"),this.getItemName())}getButtons(){var e=[];return e.push({title:this.getAddButtonCaption(),cssClass:"add-button",icon:"fa-plus-circle text-green",hotkey:"alt+n",onClick:()=>{this.addButtonClick()},disabled:()=>!this.hasInsertPermission()||this.readOnly}),e.push(this.newRefreshButton(!0)),e.push(rt.createToolButton(this)),e}newRefreshButton(e){return{title:e?null:Is("Controls.EntityGrid.RefreshButton"),hint:e?Is("Controls.EntityGrid.RefreshButton"):null,icon:"fa-refresh text-blue",cssClass:"refresh-button",onClick:()=>{this.refresh()}}}addButtonClick(){this.editItem(new Object)}editItem(e){this.createEntityDialog(this.getItemType(),t=>{var i=jn(t,Re);if(i!=null){i.load(e,()=>{i.dialogOpen(this.openDialogsAsPanel)});return}throw new Error(bs("{0} doesn't implement IEditDialog!",xs(Cs(t))))})}editItemOfType(e,t){if(e===this.getItemType()){this.editItem(t);return}this.createEntityDialog(e,i=>{var r=jn(i,Re);if(r!=null){r.load(t,()=>r.dialogOpen(this.openDialogsAsPanel));return}throw new Error(bs("{0} doesn't implement IEditDialog!",xs(Cs(i))))})}getService(){if(this._service!=null)return this._service;var e=this.attrs(Fe);return e.length>=1?this._service=e[0].value:this._service=Zd(this.getEntityType(),".","/"),this._service}getViewOptions(){var e=super.getViewOptions();return e.url=eu("~/Services/"+this.getService()+"/List"),e}getItemType(){return this.getEntityType()}routeDialog(e,t){Gr&&Gr.dialog&&Gr.dialog(this.element,t.element,()=>{var i="";return e!==this.getItemType()&&(i=e+"/"),t!=null&&t.entityId!=null?i+="edit/"+t.entityId.toString():i+="new",i})}getInsertPermission(){var e;return(e=this.getRowDefinition())==null?void 0:e.insertPermission}hasInsertPermission(){var e=this.getInsertPermission();return e==null||Xd.hasPermission(this.getInsertPermission())}transferDialogReadOnly(e){this.readOnly&&w.setReadOnly(e,!0)}initDialog(e){xe.bindToDataChange(e,this,(t,i)=>{this.subDialogDataChange()},!0),this.transferDialogReadOnly(e),this.routeDialog(this.getItemType(),e)}initEntityDialog(e,t){if(e===this.getItemType()){this.initDialog(t);return}xe.bindToDataChange(t,this,(i,r)=>{this.subDialogDataChange()},!0),this.transferDialogReadOnly(t),this.routeDialog(e,t)}createEntityDialog(e,t){var i=this.getDialogTypeFor(e),r=b.create({type:i,options:this.getDialogOptionsFor(e),init:a=>{this.initEntityDialog(e,a),t&&t(a)}});return r}getDialogOptions(){return{}}getDialogOptionsFor(e){return e===this.getItemType()?this.getDialogOptions():{}}getDialogTypeFor(e){return e===this.getItemType()?this.getDialogType():ht.get(e)}getDialogType(){if(this._dialogType!=null)return this._dialogType;var e=this.attrs(st);return e.length>=1?this._dialogType=e[0].value:this._dialogType=ht.get(this.getEntityType()),this._dialogType}};Ar=h([m.registerClass("Serenity.EntityGrid")],Ar);import{any as tu,Authorization as Ss,confirmDialog as Yn,endsWith as qr,Exception as iu,extend as St,format as Xn,getAttributes as ru,getFormData as su,getFormDataAsync as nu,getInstanceType as Ts,getTypeFullName as au,isArray as ou,isEmptyOrNull as Xt,localText as J,LT as lu,notifySuccess as du,replaceAll as uu,safeCast as pu,ScriptData as cu,serviceCall as mi,startsWith as hu,tryGetText as mu,validatorAbortHandler as Zn}from"@serenity-is/corelib/q";var Ae=class extends Q{constructor(e){super(e);this.useAsync()?this.initAsync():this.initSync()}internalInit(){this.initPropertyGrid(),this.initLocalizationGrid()}initSync(){this.propertyItemsData=this.getPropertyItemsData(),this.internalInit(),this.afterInit()}initAsync(){return _e(this,null,function*(){this.propertyItemsData=yield this.getPropertyItemsDataAsync(),this.internalInit(),this.afterInit()})}afterInit(){}useAsync(){return!1}destroy(){this.propertyGrid&&(this.propertyGrid.destroy(),this.propertyGrid=null),this.localizationGrid&&(this.localizationGrid.destroy(),this.localizationGrid=null),this.undeleteButton=null,this.applyChangesButton=null,this.deleteButton=null,this.saveAndCloseButton=null,this.editButton=null,this.cloneButton=null,this.toolbar=null,super.destroy()}get_entity(){return this.entity}set_entity(e){this.entity=e||new Object}get_entityId(){return this.entityId}set_entityId(e){this.entityId=e}getEntityNameFieldValue(){var e;return((e=this.get_entity()[this.getNameProperty()])!=null?e:"").toString()}getEntityTitle(){var i;if(this.isEditMode()){var e=this.isViewMode()||this.readOnly||!this.hasSavePermission()?J("Controls.EntityDialog.ViewRecordTitle"):J("Controls.EntityDialog.EditRecordTitle"),t=(i=this.getEntityNameFieldValue())!=null?i:"";return Xn(e,this.getEntitySingular(),Xt(t)?"":" ("+t+")")}else return Xn(J("Controls.EntityDialog.NewRecordTitle"),this.getEntitySingular())}updateTitle(){this.dialogTitle=this.getEntityTitle()}isCloneMode(){return!1}isEditMode(){return this.get_entityId()!=null&&!this.isCloneMode()}isDeleted(){if(this.get_entityId()==null)return!1;var e=this.getIsDeletedProperty();if(e)return!!this.get_entity()[e];var t=this.get_entity()[this.getIsActiveProperty()];return t==null?!1:t<0}isNew(){return this.get_entityId()==null}isNewOrDeleted(){return this.isNew()||this.isDeleted()}getDeleteOptions(e){return{}}deleteHandler(e,t){mi(e)}doDelete(e){var t=this,i={EntityId:this.get_entityId()},r={service:this.getService()+"/Delete",request:i,onSuccess:l=>{t.onDeleteSuccess(l),e!=null&&e(l),t.element.triggerHandler("ondatachange",[{entityId:i.EntityId,entity:this.entity,type:"delete"}])}},a=this.getDeleteOptions(e),o=St(r,a);this.deleteHandler(o,e)}onDeleteSuccess(e){}attrs(e){return ru(Ts(this),e,!0)}getRowDefinition(){return null}getEntityType(){if(this._entityType!=null)return this._entityType;var e=this.attrs(qe);if(e.length===1)return this._entityType=e[0].value;var t=au(Ts(this)),i=t.indexOf(".");return i>=0&&(t=t.substring(i+1)),qr(t,"Dialog")||qr(t,"Control")?t=t.substr(0,t.length-6):qr(t,"Panel")&&(t=t.substr(0,t.length-5)),this._entityType=t}getFormKey(){if(this._formKey!=null)return this._formKey;var e=this.attrs(fe);return e.length>=1?this._formKey=e[0].value:this._formKey=this.getEntityType()}getLocalTextDbPrefix(){var e;return this._localTextDbPrefix!=null?this._localTextDbPrefix:(this._localTextDbPrefix=(e=this.getLocalTextPrefix())!=null?e:"",this._localTextDbPrefix.length>0&&!qr(this._localTextDbPrefix,".")&&(this._localTextDbPrefix="Db."+this._localTextDbPrefix+"."),this._localTextDbPrefix)}getLocalTextPrefix(){var e=this.getRowDefinition();if(e)return e.localTextPrefix;var t=this.attrs(Me);return t.length>=1?t[0].value:this.getEntityType()}getEntitySingular(){if(this._entitySingular!=null)return this._entitySingular;var e=this.attrs(Pe);if(e.length>=1)this._entitySingular=e[0].value,this._entitySingular=lu.getDefault(this._entitySingular,this._entitySingular);else{var t=mu(this.getLocalTextDbPrefix()+"EntitySingular");t==null&&(t=this.getEntityType()),this._entitySingular=t}return this._entitySingular}getNameProperty(){var i,r;if(this._nameProperty!=null)return this._nameProperty;var e=this.getRowDefinition();if(e)return this._nameProperty=(i=e.nameProperty)!=null?i:"";var t=this.attrs(Ot);return t.length>=1?this._nameProperty=(r=t[0].value)!=null?r:"":this._nameProperty="Name"}getIdProperty(){var i,r;if(this._idProperty!=null)return this._idProperty;var e=this.getRowDefinition();if(e)return this._idProperty=(i=e.idProperty)!=null?i:"";var t=this.attrs(We);return t.length===1?this._idProperty=(r=t[0].value)!=null?r:"":this._idProperty="ID"}getIsActiveProperty(){var i,r;if(this._isActiveProperty!=null)return this._isActiveProperty;var e=this.getRowDefinition();if(e)return this._isActiveProperty=(i=e.isActiveProperty)!=null?i:"";var t=this.attrs(Je);return t.length===1?this._isActiveProperty=(r=t[0].value)!=null?r:"":this._isActiveProperty=""}getIsDeletedProperty(){var e;return(e=this.getRowDefinition())==null?void 0:e.isDeletedProperty}getService(){if(this._service!=null)return this._service;var e=this.attrs(Fe);return e.length>=1?this._service=e[0].value:this._service=uu(this.getEntityType(),".","/"),this._service}load(e,t,i){var r=()=>{if(e==null){this.loadResponse({}),t&&t();return}var o=typeof e;if(o==="string"||o==="number"){var l=e;this.loadById(l,function(p){t&&window.setTimeout(t,0)},null);return}var d=e||new Object;this.loadResponse({Entity:d}),t&&t()};if(i==null){r();return}try{r()}catch(o){var a=iu.wrap(o);i(a)}}loadNewAndOpenDialog(e){this.loadResponse({}),this.dialogOpen(e)}loadEntityAndOpenDialog(e,t){this.loadResponse({Entity:e}),this.dialogOpen(t)}loadResponse(e){e=e||{},this.onLoadingData(e);var t=e.Entity||new Object;this.beforeLoadEntity(t),this.loadEntity(t),this.set_entity(t),this.afterLoadEntity()}loadEntity(e){var t=this.getIdProperty();t!=null&&this.set_entityId(e[t]),this.set_entity(e),this.propertyGrid!=null&&(this.propertyGrid.set_mode(this.isEditMode()?2:1),this.propertyGrid.load(e))}beforeLoadEntity(e){this.localizationPendingValue=null,this.localizationLastValue=null}afterLoadEntity(){this.updateInterface(),this.updateTitle()}loadByIdAndOpenDialog(e,t){this.loadById(e,i=>window.setTimeout(()=>this.dialogOpen(t),0),()=>{this.element.is(":visible")||this.element.remove()})}onLoadingData(e){}getLoadByIdOptions(e,t){return{}}getLoadByIdRequest(e){var t={};return t.EntityId=e,t}reloadById(){this.loadById(this.get_entityId())}loadById(e,t,i){var r={service:this.getService()+"/Retrieve",blockUI:!0,request:this.getLoadByIdRequest(e),onSuccess:l=>{this.loadResponse(l),t&&t(l)},onCleanup:()=>{this.validator!=null&&Zn(this.validator)}},a=this.getLoadByIdOptions(e,t),o=St(r,a);this.loadByIdHandler(o,t,i)}loadByIdHandler(e,t,i){var r=mi(e);i&&r.fail(i)}initLocalizationGrid(){var e=this.byId("PropertyGrid");if(!(e.length<=0)){var t=this.getPropertyGridOptions();this.initLocalizationGridCommon(t)}}initLocalizationGridCommon(e){var t=this.byId("PropertyGrid");if(tu(e.items,p=>p.localizable===!0)){var i=$("<div/>").attr("id",this.idPrefix+"LocalizationGrid").hide().insertAfter(t);e.idPrefix=this.idPrefix+"Localization_";var r=[];for(var a of e.items){var o=null;if(a.localizable===!0){var l=St({},a);l.oneWay=!0,l.readOnly=!0,l.required=!1,l.defaultValue=null,r.push(l),o==null&&(o=this.getLangs());for(var d of o)l=St({},a),l.name=d[0]+"$"+l.name,l.title=d[1],l.cssClass=[l.cssClass,"translation"].join(" "),l.insertable=!0,l.updatable=!0,l.oneWay=!1,l.required=!1,l.localizable=!1,l.defaultValue=null,r.push(l)}}e.items=r,this.localizationGrid=new W(i,e).init(null),i.addClass("s-LocalizationGrid")}}isLocalizationMode(){return this.localizationButton!=null&&this.localizationButton.hasClass("pressed")}isLocalizationModeAndChanged(){if(!this.isLocalizationMode())return!1;var e=this.getLocalizationGridValue();return JSON.stringify(this.localizationLastValue)!=JSON.stringify(e)}localizationButtonClick(){if(!(this.isLocalizationMode()&&!this.validateForm())){if(this.isLocalizationModeAndChanged()){var e=this.getLocalizationGridValue();this.localizationLastValue=e,this.localizationPendingValue=e}this.localizationButton.toggleClass("pressed"),this.updateInterface(),this.isLocalizationMode()&&this.loadLocalization()}}getLanguages(){return Ae.defaultLanguageList!=null?Ae.defaultLanguageList()||[]:[]}getLangs(){var e=this.getLanguages(),t=pu(e,Array);return(t==null||t.length===0||t[0]==null||!ou(t[0]))&&(t=Array.prototype.slice.call(e.map(function(i){return[i.item1,i.item2]}))),t}loadLocalization(){if(this.localizationLastValue==null&&this.isNew()){this.localizationGrid.load({}),this.setLocalizationGridCurrentValues(),this.localizationLastValue=this.getLocalizationGridValue();return}if(this.localizationLastValue!=null){this.localizationGrid.load(this.localizationLastValue),this.setLocalizationGridCurrentValues();return}var e={service:this.getService()+"/Retrieve",blockUI:!0,request:{EntityId:this.get_entityId(),ColumnSelection:"keyOnly",IncludeColumns:["Localizations"]},onSuccess:t=>{var i=St(new Object,this.get_entity());if(t.Localizations)for(var r of Object.keys(t.Localizations)){var a=t.Localizations[r];for(var o of Object.keys(a))i[r+"$"+o]=a[o]}this.localizationGrid.load(i),this.setLocalizationGridCurrentValues(),this.localizationPendingValue=null,this.localizationLastValue=this.getLocalizationGridValue()}};mi(e)}setLocalizationGridCurrentValues(){var e={};this.localizationGrid.enumerateItems((t,i)=>{t.name.indexOf("$")<0&&i.element.is(":input")&&(e[t.name]=this.byId(t.name).val(),i.element.val(e[t.name]))}),this.localizationGrid.enumerateItems((t,i)=>{var r=t.name.indexOf("$");if(r>=0&&i.element.is(":input")){var a=e[t.name.substr(r+1)];a!=null&&a.length>0&&i.element.attr("title",a).attr("placeholder",a)}})}getLocalizationGridValue(){var e={};this.localizationGrid.save(e);for(var t of Object.keys(e))t.indexOf("$")<0&&delete e[t];return e}getPendingLocalizations(){if(this.localizationPendingValue==null)return null;var e={},t=this.getIdProperty(),i=this.getLangs();for(var r of i){var a=r[0],o={};t!=null&&(o[t]=this.get_entityId());var l=a+"$";for(var d of Object.keys(this.localizationPendingValue))hu(d,l)&&(o[d.substr(l.length)]=this.localizationPendingValue[d]);e[a]=o}return e}initPropertyGrid(){var e=this.byId("PropertyGrid");if(!(e.length<=0)){var t=this.getPropertyGridOptions();this.propertyGrid=new W(e,t).init(null),this.element.closest(".ui-dialog").hasClass("s-Flexify")&&this.propertyGrid.element.children(".categories").flexHeightOnly(1)}}getPropertyItems(){var e;return((e=this.propertyItemsData)==null?void 0:e.items)||[]}getPropertyItemsData(){var e=this.getFormKey();return this.getFormKey===Ae.prototype.getFormKey&&this.getPropertyItems!==Ae.prototype.getPropertyItems&&!cu.canLoad("Form."+e)?{items:this.getPropertyItems(),additionalItems:[]}:Xt(e)?{items:[],additionalItems:[]}:su(e)}getPropertyItemsDataAsync(){return _e(this,null,function*(){var e=this.getFormKey();return Xt(e)?{items:[],additionalItems:[]}:yield nu(e)})}getPropertyGridOptions(){return{idPrefix:this.idPrefix,items:this.getPropertyItems(),mode:1,localTextPrefix:"Forms."+this.getFormKey()+".",useCategories:!0}}validateBeforeSave(){return!0}getSaveOptions(e){var t={};return t.service=this.getService()+"/"+(this.isEditMode()?"Update":"Create"),t.onSuccess=i=>{this.onSaveSuccess(i),e&&e(i);var r=this.isEditMode()?"update":"create",a=t.request==null?null:t.request.Entity,o=this.isEditMode()?this.get_entityId():i==null?null:i.EntityId,l={type:r,entity:a,entityId:o};this.element.triggerHandler("ondatachange",[l])},t.onCleanup=()=>{this.validator&&Zn(this.validator)},t.request=this.getSaveRequest(),t}getSaveEntity(){var e=new Object;if(this.propertyGrid!=null&&this.propertyGrid.save(e),this.isEditMode()){var t=this.getIdProperty();t!=null&&e[t]==null&&(e[t]=this.get_entityId())}return e}getSaveRequest(){var e=this.getSaveEntity(),t={};if(t.Entity=e,this.isEditMode()){var i=this.getIdProperty();i!=null&&(t.EntityId=this.get_entityId())}return this.localizationPendingValue!=null&&(t.Localizations=this.getPendingLocalizations()),t}onSaveSuccess(e){}save_submitHandler(e){var t=this.getSaveOptions(e);this.saveHandler(t,e)}save(e){return _t.submit(this.byId("Form"),()=>this.validateBeforeSave(),()=>this.save_submitHandler(e))}saveHandler(e,t){mi(e)}initToolbar(){super.initToolbar(),this.toolbar&&(this.saveAndCloseButton=this.toolbar.findButton("save-and-close-button"),this.applyChangesButton=this.toolbar.findButton("apply-changes-button"),this.deleteButton=this.toolbar.findButton("delete-button"),this.undeleteButton=this.toolbar.findButton("undo-delete-button"),this.editButton=this.toolbar.findButton("edit-button"),this.cloneButton=this.toolbar.findButton("clone-button"),this.localizationButton=this.toolbar.findButton("localization-button"))}showSaveSuccessMessage(e){du(J("Controls.EntityDialog.SaveSuccessMessage"),"",null)}getToolbarButtons(){var e=[];return e.push({title:J("Controls.EntityDialog.SaveButton"),cssClass:"save-and-close-button",icon:"fa-check-circle text-purple",hotkey:"alt+s",onClick:()=>{this.save(t=>{this.dialogClose()})},visible:()=>!this.isDeleted()&&!this.isViewMode(),disabled:()=>!this.hasSavePermission()||this.readOnly}),e.push({title:"",hint:J("Controls.EntityDialog.ApplyChangesButton"),cssClass:"apply-changes-button",icon:"fa-clipboard-check text-purple",hotkey:"alt+a",onClick:()=>{this.save(t=>{if(this.isEditMode()){var i=t.EntityId;i==null&&(i=this.get_entityId()),this.loadById(i)}else this.loadById(t.EntityId);this.showSaveSuccessMessage(t)})},visible:()=>!this.isDeleted()&&!this.isViewMode(),disabled:()=>!this.hasSavePermission()||this.readOnly}),e.push({title:J("Controls.EntityDialog.DeleteButton"),cssClass:"delete-button",icon:"fa-trash-o text-red",hotkey:"alt+x",onClick:()=>{Yn(J("Controls.EntityDialog.DeleteConfirmation"),()=>{this.doDelete(()=>this.dialogClose())})},visible:()=>this.isEditMode()&&!this.isDeleted()&&!this.isViewMode(),disabled:()=>!this.hasDeletePermission()||this.readOnly}),e.push({title:J("Controls.EntityDialog.UndeleteButton"),cssClass:"undo-delete-button",onClick:()=>{this.isDeleted()&&Yn(J("Controls.EntityDialog.UndeleteConfirmation"),()=>{this.undelete(()=>this.loadById(this.get_entityId()))})},visible:()=>this.isEditMode()&&this.isDeleted()&&!this.isViewMode(),disabled:()=>!this.hasDeletePermission()||this.readOnly}),this.useViewMode()&&e.push({title:J("Controls.EntityDialog.EditButton"),cssClass:"edit-button",icon:"fa-edit",onClick:()=>{this.isEditMode()&&(this.editClicked=!0,this.updateInterface(),this.updateTitle())},visible:()=>this.isViewMode(),disabled:()=>!this.hasSavePermission()||this.readOnly}),e.push({title:J("Controls.EntityDialog.LocalizationButton"),cssClass:"localization-button",onClick:()=>this.localizationButtonClick()}),e.push({title:J("Controls.EntityDialog.CloneButton"),cssClass:"clone-button",icon:"fa-clone",onClick:()=>{if(this.isEditMode()){var t=this.getCloningEntity();b.create({type:Ts(this),init:i=>xe.bubbleDataChange(xe.cascade(i,this.element),this,!0).loadEntityAndOpenDialog(t,null)})}},visible:()=>!1,disabled:()=>!this.hasInsertPermission()||this.readOnly}),e}getCloningEntity(){var e=new Object;e=St(e,this.get_entity());var t=this.getIdProperty();Xt(t)||delete e[t];var i=this.getIsActiveProperty();Xt(i)||delete e[i];var r=this.getIsDeletedProperty();return Xt(r)||delete e[r],e}updateInterface(){w.setContainerReadOnly(this.byId("Form"),!1);var e=this.isLocalizationMode(),t=this.hasSavePermission(),i=this.isViewMode(),r=this.readOnly;if(this.toolbar.updateInterface(),this.tabs!=null&&Gi.setDisabled(this.tabs,"Log",this.isNewOrDeleted()),this.propertyGrid!=null&&this.propertyGrid.element.toggle(!e),this.localizationGrid!=null&&this.localizationGrid.element.toggle(e),this.localizationButton!=null&&(this.localizationButton.toggle(this.localizationGrid!=null),this.localizationButton.find(".button-inner").text(this.isLocalizationMode()?J("Controls.EntityDialog.LocalizationBack"):J("Controls.EntityDialog.LocalizationButton"))),e){this.toolbar!=null&&this.toolbar.findButton("tool-button").not(".localization-hidden").addClass(".localization-hidden").hide(),this.localizationButton&&this.localizationButton.show();return}this.toolbar.findButton("localization-hidden").removeClass("localization-hidden").show(),(!t||i||r)&&w.setContainerReadOnly(this.byId("Form"),!0)}getUndeleteOptions(e){return{}}undeleteHandler(e,t){mi(e)}undelete(e){var t={};t.service=this.getService()+"/Undelete";var i={};i.EntityId=this.get_entityId(),t.request=i,t.onSuccess=o=>{e&&e(o),this.element.triggerHandler("ondatachange",[{entityId:this.get_entityId(),entity:this.entity,type:"undelete"}])};var r=this.getUndeleteOptions(e),a=St(t,r);this.undeleteHandler(a,e)}get readOnly(){return this.get_readOnly()}set readOnly(e){this.set_readOnly(e)}get_readOnly(){return!!this._readonly}set_readOnly(e){!!this._readonly!=!!e&&(this._readonly=!!e,this.updateInterface(),this.updateTitle())}getInsertPermission(){var e;return(e=this.getRowDefinition())==null?void 0:e.insertPermission}getUpdatePermission(){var e;return(e=this.getRowDefinition())==null?void 0:e.updatePermission}getDeletePermission(){var e;return(e=this.getRowDefinition())==null?void 0:e.deletePermission}hasDeletePermission(){var e=this.getDeletePermission();return e==null||Ss.hasPermission(e)}hasInsertPermission(){var e=this.getInsertPermission();return e==null||Ss.hasPermission(e)}hasUpdatePermission(){var e=this.getUpdatePermission();return e==null||Ss.hasPermission(e)}hasSavePermission(){return this.isNew()?this.hasInsertPermission():this.hasUpdatePermission()}isViewMode(){return this.useViewMode()&&this.isEditMode()&&!this.editClicked}useViewMode(){return!1}getFallbackTemplate(){return`<div class="s-DialogContent">
    <div id="~_Toolbar" class="s-DialogToolbar">
    </div>
    <div class="s-Form">
        <form id="~_Form" action="">
            <div class="fieldset">
                <div id="~_PropertyGrid"></div>
                <div class="clear"></div>
            </div>
        </form> 
    </div>
</div>`}};Ae=h([m.registerClass("Serenity.EntityDialog",[Re,R])],Ae);import{postToService as gu,serviceCall as fu,trimToNull as ea}from"@serenity-is/corelib/q";var ta;(e=>{let c=class extends Q{constructor(r){super(r);r.reportKey&&this.loadReport(r.reportKey)}createPropertyGrid(){this.propertyGrid&&(this.byId("PropertyGrid").html("").attr("class",""),this.propertyGrid=null),this.propertyGrid=new W(this.byId("PropertyGrid"),{idPrefix:this.idPrefix,useCategories:!0,items:this.propertyItems}).init(null)}loadReport(r){fu({service:"Report/Retrieve",request:{ReportKey:r},onSuccess:a=>{var l;this.reportKey=(l=a.ReportKey)!=null?l:r,this.propertyItems=a.Properties||[],this.dialogTitle=a.Title,this.createPropertyGrid();var o=a.InitialSettings;o==null&&(o=new Object),this.propertyGrid.load(o),this.toolbar.findButton("print-preview-button").toggle(!a.IsDataOnlyReport),this.toolbar.findButton("export-pdf-button").toggle(!a.IsDataOnlyReport),this.toolbar.findButton("export-docx-button").toggle(!a.IsDataOnlyReport),this.dialogOpen(null)}})}executeReport(r,a){if(this.validateForm()){var o=new Object;this.propertyGrid.save(o),gu({service:"Report/Execute",request:{ReportKey:this.reportKey,DesignId:"Default",ExportType:a,Parameters:o},target:r})}}getToolbarButtons(){var r=[];return r.push({title:"\xD6nizleme",cssClass:"print-preview-button",onClick:()=>{this.executeReport("_blank",null)}}),r.push({title:"PDF",cssClass:"export-pdf-button",onClick:()=>{this.executeReport("","Pdf")}}),r.push({title:"Excel",cssClass:"export-xlsx-button",onClick:()=>{this.executeReport("","Xlsx")}}),r.push({title:"Word",cssClass:"export-docx-button",onClick:()=>{this.executeReport("","Docx")}}),r}};c=h([m.registerClass("Serenity.Reporting.ReportDialog")],c),e.ReportDialog=c;let n=class extends b{constructor(i){super(i),$(".report-link").click(a=>this.reportLinkClick(a)),$("div.line").click(a=>this.categoryClick(a));var r=this;new te($("#QuickSearchInput"),{onSearch:function(a,o,l){r.updateMatchFlags(o),l(!0)}})}updateMatchFlags(i){var r=$("#ReportList").find("li").removeClass("non-match");if(i=ea(i),i==null){r.children("ul").hide(),r.show().removeClass("expanded");return}for(var a=i.replace(","," ").split(" "),o=0;o<a.length;o++)a[o]=ea(Select2.util.stripDiacritics(a[o]).toUpperCase());var l=r.filter(".report-item");l.each(function(g,v){var O;for(var f=$(v),y=Select2.util.stripDiacritics(((O=f.text())!=null?O:"").toUpperCase()),C=0;C<a.length;C++){var S=a[C];if(S!=null&&y.indexOf(S)===-1){f.addClass("non-match");break}}});var d=l.not(".non-match"),p=d.parents("li").add(d),u=r.not(p);u.hide().addClass("non-match"),p.show(),p.length<=100&&(r.children("ul").show(),r.addClass("expanded"))}categoryClick(i){var r=$(i.target).closest("li");r.hasClass("expanded")?(r.find("ul").hide("fast"),r.removeClass("expanded"),r.find("li").removeClass("expanded")):(r.addClass("expanded"),r.children("ul").show("fast"),r.children("ul").children("li").length===1&&!r.children("ul").children("li").hasClass("expanded")&&r.children("ul").children("li").children(".line").click())}reportLinkClick(i){i.preventDefault();var r=new c({reportKey:$(i.target).data("key")})}};n=h([m.registerClass("Serenity.Reporting.ReportPage")],n),e.ReportPage=n})(ta||(ta={}));var Wr=class{};Wr=h([m.registerClass("Serenity.ScriptContext")],Wr);var Jr=class{};Jr=h([m.registerInterface("Serenity.IAsyncInit")],Jr);var Mr;(a=>{function c(o,l){return o.getWidget(l)}a.getWidget=c,a.getWidgetName=b.getWidgetName;function e(o){return typeof o.originalEvent!="undefined"}a.hasOriginalEvent=e;function t(o,l){o.change(l)}a.change=t;function i(o,l){o.changeSelect2(l)}a.changeSelect2=i;function r(o){return o.getGridField()}a.getGridField=r})(Mr||(Mr={}));var $r=class extends b{constructor(e,t){var d,p,u,g,v,f,y;super(e,t);var i=(u=new google.m)!=null?u:s.LatLng((d=this.options.latitude)!=null?d:0,(p=this.options.longitude)!=null?p:0),r=new Object;if(r.center=i,r.mapTypeId=(g=this.options.mapTypeId)!=null?g:"roadmap",r.zoom=(v=this.options.zoom)!=null?v:15,r.zoomControl=!0,this.map=new google.maps.Map(e[0],r),this.options.markerTitle!=null){var a=new Object,o=this.options.markerLatitude;o==null&&(o=(f=this.options.latitude)!=null?f:0);var l=this.options.markerLongitude;l==null&&(l=(y=this.options.longitude)!=null?y:0),a.position=new google.maps.LatLng(o,l),a.map=this.map,a.title=this.options.markerTitle,a.animation=2,new google.maps.Marker(a)}ve.executeOnceWhenShown(e,()=>{google.maps.event.trigger(this.map,"resize",[]),this.map.setCenter(i)})}get_map(){return this.map}};$r=h([m.registerEditor("Serenity.GoogleMap",[]),m.element("<div/>")],$r);import{isEmptyOrNull as ia,isValue as yu,safeCast as vu,serviceCall as ra,localText as bu,trimToNull as Cu}from"@serenity-is/corelib/q";var zr=class extends b{constructor(e,t){super(e,t);this.pageSize=50;var i=this.emptyItemText();i!=null&&e.attr("placeholder",i),e.select2(this.getSelect2Options()),e.attr("type","text"),e.on("change."+this.uniqueName,(r,a)=>{(Mr.hasOriginalEvent(r)||!a)&&_t.getValidator(e)!=null&&e.valid()})}emptyItemText(){var e=this.element.attr("placeholder");return e==null&&(e=bu("Controls.SelectEditor.EmptyItemText")),e}getService(){throw new Error("Not implemented!")}query(e,t){var i={blockUI:!1,service:this.getService()+"/List",request:e,onSuccess:function(r){t(r)}};this.executeQuery(i)}executeQuery(e){ra(e)}queryByKey(e,t){var i={blockUI:!1,service:this.getService()+"/Retrieve",request:{EntityId:e},onSuccess:function(r){t(r.Entity)}};this.executeQueryByKey(i)}executeQueryByKey(e){ra(e)}getItemKey(e){return null}getItemText(e){return null}getTypeDelay(){return 200}getSelect2Options(){var e=this.emptyItemText(),t=0;return{minimumResultsForSearch:10,placeHolder:ia(e)?null:e,allowClear:yu(e),query:i=>{var r={ContainsText:Cu(i.term),Skip:(i.page-1)*this.pageSize,Take:this.pageSize+1};t!==0&&window.clearTimeout(t);var a=$(this.element).data("select2");a&&a.search&&a.search.removeClass("select2-active").parent().removeClass("select2-active"),t=window.setTimeout(()=>{a&&a.search.addClass("select2-active").parent().addClass("select2-active"),this.query(r,o=>{i.callback({results:o.Entities.slice(0,this.pageSize).map(l=>({id:this.getItemKey(l),text:this.getItemText(l),source:l})),more:o.Entities.length>=this.pageSize})})},this.getTypeDelay())},initSelection:(i,r)=>{var a=i.val();if(ia(a)){r(null);return}this.queryByKey(a,o=>{r(o==null?null:{id:this.getItemKey(o),text:this.getItemText(o),source:o})})}}}addInplaceCreate(e){var t=this;$("<a><b/></a>").addClass("inplace-button inplace-create").attr("title",e).insertAfter(this.element).click(function(i){t.inplaceCreateClick(i)}),this.get_select2Container().add(this.element).addClass("has-inplace-button")}inplaceCreateClick(e){}get_select2Container(){return this.element.prevAll(".select2-container")}get_value(){return vu(this.element.select2("val"),String)}get value(){return this.get_value()}set_value(e){if(e!==this.get_value()){var t=this.element;t.select2("val",e),t.data("select2-change-triggered",!0);try{t.triggerHandler("change",[!0])}finally{t.data("select2-change-triggered",!1)}}}set value(e){this.set_value(e)}};zr=h([m.registerEditor("Serenity.Select2AjaxEditor",[P]),m.element('<input type="hidden" />')],zr);export{oe as BaseEditorFiltering,xt as BaseFiltering,Mi as BooleanEditor,qt as BooleanFiltering,Ut as BooleanFormatter,Rs as CaptureOperationType,je as CascadedWidgetLink,gi as CategoryAttribute,Lr as CheckLookupEditor,hi as CheckTreeEditor,_r as CheckboxFormatter,rt as ColumnPickerDialog,GC as ColumnSelection,kt as ColumnsKeyAttribute,WC as Criteria,fi as CssClassAttribute,N as DataGrid,V as DateEditor,At as DateFiltering,ge as DateFormatter,G as DateTimeEditor,Wt as DateTimeFiltering,Dr as DateTimeFormatter,er as DateYearEditor,Ie as DecimalEditor,gr as DecimalFiltering,m as Decorators,yi as DefaultValueAttribute,Ue as DialogExtensions,st as DialogTypeAttribute,ht as DialogTypeRegistry,De as DisplayNameAttribute,vt as EditorFiltering,vi as EditorOptionAttribute,bi as EditorTypeAttribute,Fi as EditorTypeAttributeBase,mt as EditorTypeRegistry,w as EditorUtils,nt as ElementAttribute,ji as EmailAddressEditor,Ft as EmailEditor,Ae as EntityDialog,Ar as EntityGrid,qe as EntityTypeAttribute,Rt as EnumEditor,fr as EnumFiltering,ke as EnumFormatter,z as EnumKeyAttribute,He as EnumTypeRegistry,Be as FileDownloadFormatter,ai as FileUploadEditor,$t as FilterDialog,zt as FilterDisplayBar,k as FilterOperators,Mt as FilterPanel,ae as FilterStore,Ze as FilterWidgetBase,at as FilterableAttribute,Jt as FilteringTypeRegistry,Bi as Flexify,ot as FlexifyAttribute,fe as FormKeyAttribute,Fr as FormatterTypeRegistry,Ci as GeneratedCodeAttribute,$r as GoogleMap,Rr as GridRadioSelectionMixin,Er as GridRowSelectionMixin,pi as GridSelectAllButtonHelper,It as GridUtils,xi as HiddenAttribute,Ii as HintAttribute,ne as HtmlContentEditor,ir as HtmlNoteContentEditor,rr as HtmlReportContentEditor,Jr as IAsyncInit,Ee as IBooleanValue,ye as IDialog,Y as IDoubleValue,Re as IEditDialog,Xe as IFiltering,X as IGetEditValue,it as IInitializeColumn,Ct as IQuickFiltering,R as IReadOnly,Z as ISetEditValue,Wp as ISlickFormatter,P as IStringValue,Ve as IValidateRequired,We as IdPropertyAttribute,lr as ImageUploadEditor,Si as InsertableAttribute,Dt as IntegerEditor,yr as IntegerFiltering,Je as IsActivePropertyAttribute,Pe as ItemNameAttribute,ve as LazyLoadHelper,Me as LocalTextPrefixAttribute,Vt as LookupEditor,ri as LookupEditorBase,vr as LookupFiltering,sr as MaskedEditor,Ti as MaxLengthAttribute,lt as MaximizableAttribute,jt as MinuteFormatter,Lt as MultipleFileUploadEditor,dr as MultipleImageUploadEditor,Ot as NamePropertyAttribute,Le as NumberFormatter,ki as OneWayAttribute,$e as OptionAttribute,dt as OptionsTypeAttribute,ut as PanelAttribute,Wi as PasswordEditor,Oi as PlaceholderAttribute,gt as PopupMenuButton,Qi as PopupToolButton,Bs as PrefixedContext,ft as PropertyDialog,W as PropertyGrid,ti as PropertyGridMode,Vr as PropertyItemSlickConverter,qi as PropertyPanel,q as QuickFilterBar,te as QuickSearchInput,Xi as RadioButtonEditor,wi as ReadOnlyAttribute,nr as Recaptcha,be as ReflectionOptionsSetter,re as ReflectionUtils,ta as Reporting,_i as RequiredAttribute,pt as ResizableAttribute,ct as ResponsiveAttribute,AC as RetrieveColumnSelection,Wr as ScriptContext,zr as Select2AjaxEditor,L as Select2Editor,Ke as SelectEditor,Fe as ServiceAttribute,Qt as ServiceLookupEditor,ni as ServiceLookupEditorBase,br as ServiceLookupFiltering,we as SlickFormatting,Qr as SlickHelper,Ht as SlickPager,ie as SlickTreeHelper,se as StringEditor,Cr as StringFiltering,xe as SubDialogHelper,qC as SummaryType,Gi as TabsExtensions,Q as TemplatedDialog,wt as TemplatedPanel,B as TemplatedWidget,Ji as TextAreaEditor,Hi as TimeEditor,A as Toolbar,Br as TreeGridMixin,Ki as URLEditor,Di as UpdatableAttribute,Te as UploadHelper,Ne as UrlFormatter,As as VX,_t as ValidationHelper,Mr as WX,b as Widget,pn as datePickerIconSvg,_a as reactPatch};
//# sourceMappingURL=index.js.map
